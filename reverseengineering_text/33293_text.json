{
    "title": "Retrieve the address of a peer to peer video stream from cheap WiFi camera drone",
    "link": "https://reverseengineering.stackexchange.com/questions/33293/retrieve-the-address-of-a-peer-to-peer-video-stream-from-cheap-wifi-camera-drone",
    "content": "I recently picked up a Chinese WiFi drone from which I recovered the electronic modules.\nI would like to use the module allowing video transmission via Wifi for other projects. So I first tried with the official application (Bigben Fly) but it has not been maintained for a long time, so it is no longer functional on new versions of Android...\nI have already looked at similar questions on the forum but they are not as precise as mine, in fact I decompiled the apk of the app with jadx and I found this code which at first glance corresponds to what I'm looking for. The app seems to use a P2P system to the address 172.16.0.1 or 172.16.0.2, which corresponds to the IP address obtained when I connect to the drone via Wifi. However using nmap I find that no ports are open on the module.\n<pre><code>package com.yijian.auvilink.network;\n\nimport android.content.Context;\nimport android.os.Bundle;\nimport android.os.Handler;\nimport android.os.Message;\nimport android.text.TextUtils;\nimport android.util.Log;\nimport com.yijian.auvilink.bean.MyDeviceInfo;\nimport com.yijian.auvilink.network.g;\nimport com.yijian.auvilink.utils.t;\nimport p2ptran.sdk.p2ptransdk;\n\n/* loaded from: /tmp/jadx-16086265272476680384.dex */\npublic class CameraItem implements Runnable {\n    static final /* synthetic */ boolean b;\n    private t A;\n    private Context c;\n    private String i;\n    private String j;\n    private String l;\n    private String m;\n    private int o;\n    private String p;\n    private Handler d = new Handler();\n    private Handler e = new Handler() { // from class: com.yijian.auvilink.network.CameraItem.1\n        @Override // android.os.Handler\n        public void handleMessage(Message message) {\n            super.handleMessage(message);\n        }\n    };\n    private String f = null;\n    private String g = null;\n    private Handler h = null;\n    private boolean k = false;\n    private int n = 0;\n    private boolean q = false;\n    private boolean r = true;\n    private Thread s = null;\n    c a = new c(100000);\n    private boolean z = false;\n    private int v = 0;\n\n    /* renamed from: u, reason: collision with root package name */\n    private int f61u = 0;\n    private int t = 0;\n    private q w = new q();\n    private n x = new n();\n    private o y = new o();\n\n    static {\n        b = !CameraItem.class.desiredAssertionStatus();\n    }\n\n    public CameraItem(Context context) {\n        this.o = 1;\n        this.c = context;\n        this.A = t.a(this.c);\n        this.o = 1;\n    }\n\n    public int a() {\n        return this.o;\n    }\n\n    public int b() {\n        return this.n;\n    }\n\n    public String c() {\n        return this.i;\n    }\n\n    public String d() {\n        return this.j;\n    }\n\n    public boolean e() {\n        return this.k;\n    }\n\n    public String f() {\n        return this.l;\n    }\n\n    public int a(String str) {\n        this.m = str;\n        return 0;\n    }\n\n    public int b(String str) {\n        this.p = str;\n        return 0;\n    }\n\n    public String g() {\n        return this.m;\n    }\n\n    public String h() {\n        return this.p;\n    }\n\n    public void a(int i) {\n        this.w.a(i);\n        this.x.a(i);\n    }\n\n    /* JADX WARN: Multi-variable type inference failed */\n    private int u() {\n        int i;\n        int P2PReaderGetFrame = p2ptransdk.P2PReaderGetFrame(this.v);\n        if (P2PReaderGetFrame == 0) {\n            return 0;\n        }\n        if (p2ptransdk.P2PFrameGetUserData(P2PReaderGetFrame) == 0) {\n            int P2PFrameGetLength = p2ptransdk.P2PFrameGetLength(P2PReaderGetFrame);\n            switch (p2ptransdk.P2PFrameGetMsg(P2PReaderGetFrame)) {\n                case 1:\n                    p2ptransdk.P2PClientSetAddr(this.f61u, \"172.16.10.1-6800\");\n                    break;\n                case 4:\n                    p2ptransdk.P2PFrameGetData(P2PReaderGetFrame, this.a.a, P2PFrameGetLength);\n                    this.a.e();\n                    switch (this.a.a()) {\n                        case 1:\n                            this.n = 0;\n                            this.o = 1;\n                            a(0, this.i, 1);\n                            break;\n                        case 2:\n                            this.n = 1;\n                            this.o = 1;\n                            a(1, this.i, 1);\n                            break;\n                        case 3:\n                            this.n = 0;\n                            this.o = 3;\n                            a(0, this.i, 1);\n                            com.yijian.auvilink.utils.a.a(\"CameraItem\", \"CLIENT_SYS_CONNECT=\" + Integer.toString(this.n));\n                            break;\n                        case 4:\n                            this.n = 1;\n                            this.o = 3;\n                            a(1, this.i, 1);\n                            break;\n                    }\n                case 5:\n                    p2ptransdk.P2PFrameGetData(P2PReaderGetFrame, this.a.a, P2PFrameGetLength);\n                    this.a.e();\n                    if (this.a.a() == 2) {\n                        this.n = 2;\n                        a(2, this.i, 0);\n                        Log.d(\"P2PFrameGetData\", \"密码错误  \" + this.o + \" === \" + this.n);\n                        break;\n                    } else {\n                        short b2 = this.a.b();\n                        short b3 = this.a.b();\n                        this.a.b();\n                        this.a.b();\n                        com.yijian.auvilink.utils.a.e(\"CameraItem\", \"Capability:\" + ((int) b2) + \",\" + ((int) b3));\n                        break;\n                    }\n                case 6:\n                    p2ptransdk.P2PFrameGetData(P2PReaderGetFrame, this.a.a, P2PFrameGetLength);\n                    this.a.e();\n                    this.a.b();\n                    this.a.b();\n                    break;\n            }\n            p2ptransdk.P2PReaderFreeFrame(P2PReaderGetFrame);\n            return 1;\n        }\n        int P2PFrameGetLength2 = p2ptransdk.P2PFrameGetLength(P2PReaderGetFrame);\n        int P2PFrameGetMsg = p2ptransdk.P2PFrameGetMsg(P2PReaderGetFrame);\n        c cVar = new c(P2PFrameGetLength2);\n        switch (P2PFrameGetMsg) {\n            case 2001:\n                p2ptransdk.P2PFrameGetData(P2PReaderGetFrame, cVar.a, P2PFrameGetLength2);\n                String c = cVar.c(64);\n                String c2 = cVar.c(64);\n                String c3 = cVar.c(64);\n                int a2 = cVar.a();\n                int a3 = cVar.a();\n                if (P2PFrameGetLength2 < 204) {\n                    i = 0;\n                } else {\n                    i = cVar.a();\n                }\n                MyDeviceInfo.Instant().setResult(c + \"\", c2 + \"\", c3 + \"\", a2 + \" MB\", a3 + \" MB\", i + \"%\");\n                this.e.post(new Runnable() { // from class: com.yijian.auvilink.network.CameraItem.6\n                    @Override // java.lang.Runnable\n                    public void run() {\n                        de.greenrobot.event.c.a().d(new com.yijian.auvilink.a.a(\"2000\"));\n                    }\n                });\n                break;\n            case 2003:\n                p2ptransdk.P2PFrameGetData(P2PReaderGetFrame, cVar.a, P2PFrameGetLength2);\n                short b4 = cVar.b();\n                int b5 = cVar.b();\n                if (b5 <= 1000) {\n                    String c4 = cVar.c(24);\n                    g.a[] aVarArr = new g.a[b5];\n                    if (b5 == 0) {\n                        if (b4 == -1) {\n                            this.d.post(new Runnable() { // from class: com.yijian.auvilink.network.CameraItem.7\n                                @Override // java.lang.Runnable\n                                public void run() {\n                                    de.greenrobot.event.c.a().d(new com.yijian.auvilink.a.a(com.yijian.auvilink.mainapp.a.ad));\n                                }\n                            });\n                        } else {\n                            this.d.post(new Runnable() { // from class: com.yijian.auvilink.network.CameraItem.8\n                                @Override // java.lang.Runnable\n                                public void run() {\n                                    de.greenrobot.event.c.a().d(new com.yijian.auvilink.a.a(com.yijian.auvilink.mainapp.a.ac));\n                                }\n                            });\n                        }\n                        return -1;\n                    }\n                    com.yijian.auvilink.utils.a.a(\"count---result-camera\", b5 + \"+\");\n                    for (int i2 = 0; i2 < b5; i2++) {\n                        aVarArr[i2] = new g.a();\n                        aVarArr[i2].e = new int[4];\n                        aVarArr[i2].e[0] = cVar.a();\n                        aVarArr[i2].e[1] = cVar.a();\n                        aVarArr[i2].e[2] = cVar.a();\n                        aVarArr[i2].e[3] = cVar.a();\n                        int a4 = cVar.a();\n                        int a5 = cVar.a();\n                        int a6 = cVar.a();\n                        int a7 = cVar.a();\n                        int a8 = cVar.a();\n                        int[] iArr = new int[7];\n                        p2ptransdk.HL2Time(a4, a5, iArr);\n                        aVarArr[i2].b = new g.b(iArr);\n                        p2ptransdk.HL2Time(a6, a7, iArr);\n                        aVarArr[i2].c = new g.b(iArr);\n                        aVarArr[i2].d = a8;\n                        aVarArr[i2].a = aVarArr[i2].b.a + \"-\" + aVarArr[i2].b.b + \"-\" + aVarArr[i2].b.c + \" \" + String.format(\"%02d:%02d:%02d\", Integer.valueOf(aVarArr[i2].b.d), Integer.valueOf(aVarArr[i2].b.e), Integer.valueOf(aVarArr[i2].b.f));\n                    }\n                    g.a().a(c4, b4, b5, aVarArr);\n                    this.d.post(new Runnable() { // from class: com.yijian.auvilink.network.CameraItem.9\n                        @Override // java.lang.Runnable\n                        public void run() {\n                            de.greenrobot.event.c.a().d(new com.yijian.auvilink.a.a(\"com.auvilink.getreplay.success\"));\n                        }\n                    });\n                    break;\n                }\n                break;\n            case 2019:\n                p2ptransdk.P2PFrameGetData(P2PReaderGetFrame, cVar.a, P2PFrameGetLength2);\n                int a9 = cVar.a();\n                if (a9 != -1) {\n                    c(1001, a9);\n                    this.d.post(new Runnable() { // from class: com.yijian.auvilink.network.CameraItem.12\n                        @Override // java.lang.Runnable\n                        public void run() {\n                            de.greenrobot.event.c.a().d(new com.yijian.auvilink.a.a(\"2019\"));\n                        }\n                    });\n                    break;\n                }\n                break;\n            case 2021:\n                p2ptransdk.P2PFrameGetData(P2PReaderGetFrame, cVar.a, P2PFrameGetLength2);\n                int a10 = cVar.a();\n                if (a10 != -1) {\n                    c(1002, a10);\n                    this.d.post(new Runnable() { // from class: com.yijian.auvilink.network.CameraItem.13\n                        @Override // java.lang.Runnable\n                        public void run() {\n                            de.greenrobot.event.c.a().d(new com.yijian.auvilink.a.a(\"2021\"));\n                        }\n                    });\n                    break;\n                }\n                break;\n            case 2023:\n                p2ptransdk.P2PFrameGetData(P2PReaderGetFrame, cVar.a, P2PFrameGetLength2);\n                final int a11 = cVar.a();\n                this.d.post(new Runnable() { // from class: com.yijian.auvilink.network.CameraItem.2\n                    @Override // java.lang.Runnable\n                    public void run() {\n                        com.yijian.auvilink.a.a aVar = new com.yijian.auvilink.a.a(\"2023\");\n                        Bundle bundle = new Bundle();\n                        bundle.putInt(\"resule\", a11);\n                        aVar.a(bundle);\n                        de.greenrobot.event.c.a().d(aVar);\n                    }\n                });\n                break;\n            case 2025:\n                p2ptransdk.P2PFrameGetData(P2PReaderGetFrame, cVar.a, P2PFrameGetLength2);\n                cVar.b();\n                final byte c5 = cVar.c();\n                cVar.c();\n                c(1001, -1);\n                this.d.post(new Runnable() { // from class: com.yijian.auvilink.network.CameraItem.4\n                    @Override // java.lang.Runnable\n                    public void run() {\n                        com.yijian.auvilink.a.a aVar = new com.yijian.auvilink.a.a(\"2019\");\n                        Bundle bundle = new Bundle();\n                        bundle.putInt(\"mode\", c5);\n                        aVar.a(bundle);\n                        de.greenrobot.event.c.a().d(aVar);\n                    }\n                });\n                break;\n            case 2027:\n                p2ptransdk.P2PFrameGetData(P2PReaderGetFrame, cVar.a, P2PFrameGetLength2);\n                if (cVar.a() != -1) {\n                    this.d.post(new Runnable() { // from class: com.yijian.auvilink.network.CameraItem.3\n                        @Override // java.lang.Runnable\n                        public void run() {\n                            de.greenrobot.event.c.a().d(new com.yijian.auvilink.a.a(\"1006\"));\n                        }\n                    });\n                    break;\n                }\n                break;\n            case 2047:\n                p2ptransdk.P2PFrameGetData(P2PReaderGetFrame, cVar.a, P2PFrameGetLength2);\n                final int a12 = cVar.a();\n                this.d.post(new Runnable() { // from class: com.yijian.auvilink.network.CameraItem.5\n                    @Override // java.lang.Runnable\n                    public void run() {\n                        com.yijian.auvilink.a.a aVar = new com.yijian.auvilink.a.a(\"2047\");\n                        Bundle bundle = new Bundle();\n                        bundle.putInt(\"resule\", a12);\n                        aVar.a(bundle);\n                        de.greenrobot.event.c.a().d(aVar);\n                    }\n                });\n                break;\n            case com.yijian.auvilink.mainapp.a.K /* 20017 */:\n                this.d.post(new Runnable() { // from class: com.yijian.auvilink.network.CameraItem.11\n                    @Override // java.lang.Runnable\n                    public void run() {\n                        de.greenrobot.event.c.a().d(new com.yijian.auvilink.a.a(\"20017\"));\n                    }\n                });\n                break;\n            case com.yijian.auvilink.mainapp.a.M /* 20019 */:\n                com.yijian.auvilink.a.a aVar = new com.yijian.auvilink.a.a(\"20019\");\n                p2ptransdk.P2PFrameGetData(P2PReaderGetFrame, cVar.a, P2PFrameGetLength2);\n                Bundle bundle = new Bundle();\n                bundle.putByte(\"state\", cVar.a[0]);\n                aVar.a(bundle);\n                de.greenrobot.event.c.a().d(aVar);\n                break;\n            case com.yijian.auvilink.mainapp.a.G /* 20023 */:\n                this.d.post(new Runnable() { // from class: com.yijian.auvilink.network.CameraItem.10\n                    @Override // java.lang.Runnable\n                    public void run() {\n                        de.greenrobot.event.c.a().d(new com.yijian.auvilink.a.a(\"20023\"));\n                    }\n                });\n                break;\n        }\n        p2ptransdk.P2PReaderFreeFrame(P2PReaderGetFrame);\n        return 1;\n    }\n\n    private void c(int i, int i2) {\n        Message message = new Message();\n        message.what = i;\n        message.obj = Integer.valueOf(i2);\n        this.h.sendMessage(message);\n    }\n\n    /* loaded from: /tmp/jadx-16086265272476680384.dex */\n    public class a {\n        public String a;\n        public int b;\n\n        public a() {\n        }\n    }\n\n    public void a(int i, String str, int i2) {\n        a aVar = new a();\n        aVar.a = str;\n        aVar.b = i2;\n        Message message = new Message();\n        message.what = i;\n        message.obj = aVar;\n        this.h.sendMessage(message);\n    }\n\n    /* loaded from: /tmp/jadx-16086265272476680384.dex */\n    public class b {\n        public String a = new String();\n        public String b = new String();\n        public String c = new String();\n\n        public b() {\n        }\n    }\n\n    public void a(int i, String str, String str2, String str3) {\n    }\n\n    @Override // java.lang.Runnable\n    public void run() {\n        while (!this.r) {\n            try {\n                if (u() <= 0) {\n                    Thread.sleep(10L);\n                }\n            } catch (InterruptedException e) {\n            }\n        }\n        this.q = false;\n    }\n\n    public int a(String str, String str2, String str3, Handler handler, String str4, boolean z, String str5) {\n        if (!TextUtils.isEmpty(str)) {\n            this.h = handler;\n            this.i = str;\n            this.m = str2;\n            this.p = str3;\n            this.j = str4;\n            this.k = z;\n            this.l = str5;\n        }\n        return 0;\n    }\n\n    public void i() {\n        this.v = p2ptransdk.P2PCreateReader();\n        this.f61u = p2ptransdk.P2PCreateClient(this.v, 100, 100, 3600000, 0);\n        this.t = p2ptransdk.P2PCreateSearchSession(this.v, this.i);\n        p2ptransdk.P2PClientLogin(this.f61u, \"112.74.197.198-6000\", this.i, \"admin\", this.p);\n        this.w.a();\n        this.x.a();\n        this.q = true;\n        this.r = false;\n        this.s = new Thread(this);\n        this.s.start();\n    }\n\n    private void a(int i, int i2, String str) {\n        com.yijian.auvilink.a.a aVar = new com.yijian.auvilink.a.a(com.yijian.auvilink.mainapp.a.af);\n        Bundle bundle = new Bundle();\n        bundle.putInt(\"onlineNums\", i);\n        bundle.putInt(\"maxNums\", i2);\n        bundle.putString(\"deviceId\", str);\n        aVar.a(bundle);\n        de.greenrobot.event.c.a().d(aVar);\n    }\n\n    public void j() {\n    }\n\n    public int k() {\n        if (this.f61u != 0) {\n            this.r = true;\n            try {\n                this.s.join();\n                while (this.q) {\n                    Thread.sleep(1L);\n                }\n            } catch (InterruptedException e) {\n            }\n            if (!b && this.f61u == 0) {\n                throw new AssertionError();\n            }\n            this.w.b();\n            this.x.b();\n            p2ptransdk.P2PClientLogout(this.f61u);\n            p2ptransdk.P2PDeleteObject(this.t);\n            p2ptransdk.P2PDeleteObject(this.f61u);\n            p2ptransdk.P2PDeleteObject(this.v);\n            this.z = true;\n        }\n        return 0;\n    }\n\n    /* JADX INFO: Access modifiers changed from: package-private */\n    public int a(String str, String str2) {\n        this.f = str;\n        this.g = str2;\n        return 0;\n    }\n\n    /* JADX INFO: Access modifiers changed from: package-private */\n    public String l() {\n        return this.f;\n    }\n\n    /* JADX INFO: Access modifiers changed from: package-private */\n    public String m() {\n        return this.g;\n    }\n\n    public int n() {\n        if (this.f61u != 0) {\n            p2ptransdk.P2PClientReconnect(this.f61u, 10000, 10000);\n        }\n        return 0;\n    }\n\n    public int a(int i, int i2, int i3, h hVar) {\n        if (this.f61u == 0) {\n            return 0;\n        }\n        return this.w.a(this.f61u, i, i2, i3, hVar);\n    }\n\n    public int a(int i, int i2) {\n        return this.w.c();\n    }\n\n    public int a(int i, int i2, int i3) {\n        return this.y.a(this.f61u, i, i2, i3);\n    }\n\n    public int o() {\n        return this.y.a();\n    }\n\n    public int b(int i, int i2, int i3, h hVar) {\n        this.x.a(this.f61u, i, i2, i3, hVar);\n        return 0;\n    }\n\n    public int b(int i, int i2) {\n        this.x.c();\n        return 0;\n    }\n\n    public void p() {\n        this.w.e();\n    }\n\n    public void q() {\n        this.w.d();\n    }\n\n    public int a(int i, int i2, byte[] bArr, int i3) {\n        if (this.f61u == 0) {\n            return 1;\n        }\n        p2ptransdk.P2PClientSend(this.f61u, i, i2, bArr, i3);\n        return 0;\n    }\n\n    /* JADX INFO: Access modifiers changed from: package-private */\n    public int a(int[] iArr, int i, int i2) {\n        d dVar = new d(64);\n        if (iArr == null) {\n            dVar.a(0);\n            dVar.a(0);\n            dVar.a(0);\n            dVar.a(0);\n        } else {\n            dVar.a(iArr[0]);\n            dVar.a(iArr[1]);\n            dVar.a(iArr[2]);\n            dVar.a(iArr[3]);\n        }\n        dVar.a(i);\n        dVar.a(i2);\n        a(com.yijian.auvilink.mainapp.a.x, 100, dVar.a, dVar.b);\n        return 0;\n    }\n\n    /* JADX INFO: Access modifiers changed from: package-private */\n    public int r() {\n        a(com.yijian.auvilink.mainapp.a.z, 100, (byte[]) null, 0);\n        return 0;\n    }\n\n    /* JADX INFO: Access modifiers changed from: package-private */\n    public int s() {\n        a(com.yijian.auvilink.mainapp.a.B, 100, (byte[]) null, 0);\n        return 0;\n    }\n\n    public boolean t() {\n        return this.z;\n    }\n}\n</code></pre>\nSo I hope that some people here are familiar with this type of communication protocol and could guide me to successfully obtain the video stream in the same way as the application.\n",
    "votes": "0",
    "answers": 0,
    "views": "28",
    "tags": [
        "android",
        "java",
        "protocol",
        "communication"
    ],
    "user": "Romain M.",
    "time": "Oct 28, 2024 at 11:05",
    "comments": [],
    "answers_data": []
}