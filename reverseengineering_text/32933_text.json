{
    "title": "Help extracting ubifs from a NAND dump (W29N02GV)",
    "link": "https://reverseengineering.stackexchange.com/questions/32933/help-extracting-ubifs-from-a-nand-dump-w29n02gv",
    "content": "I have extracted the router NAND (W29N02GV) firmware via xgpro. Tried to extract the ubifs but unable to, I'm not sure what is wrong.\n\nboot log:\n<pre><code>HuaWei StartCode 2012.02 (V300R018C00 Nov 13 2017 - 10:57:25)\n\nNAND:  Nand ID: 0xEF 0xDA 0x90 0x95 0x04 0x00 0x00 0x00\nECC Match pagesize:2K, oobzie:64, ecctype:4bit\nNand(Hardware): 256 MiB\nstartcode select the uboot to load\nthe high RAM is :8080103c\nstartcode uboot boot count:-1\nuse the main slave_param area from flash, the RAM data is not OK!!!\nUse the UbootA to load first\nUse the UbootA to load success\n\n\nU-Boot 2017.07 (V300R019C00 Jan 07 2022 - 11:33:36 +0800 V3), Build: jenkins-ONT_V300R019C00_Oversea_Compile_sign_uboot_953302B0B7E346518CDDE1BAE61D9D23-1\n\nDRAM:  256 MiB\nBoot From NAND flash\nChip Type is SD5116T\nNAND:  Special Nand id table Version 1.23\nNand ID: 0xEF 0xDA 0x90 0x95 0x04 0x00 0x00 0x00\nECC Match pagesize:2K, oobzie:64, ecctype:4bit\nNand(Hardware): Block:128KB Page:2KB Chip:268435456B OOB:64B ECC:4bit\n256 MiB\n256 MiB\nUsing default environment\n\nIn:    serial\nOut:   serial\nErr:   serial\nNet:   PHY power down !!!\nMbist flag = 0x0, ddr totoal size = 0x10000000\n[common/pon_chip_v3/main.c__4359]::CRC:0x3d80a8b4, Magic1:0x5a5a5a5a, Magic2:0xa5a5a5a5, count:0, CommitedArea:0x0, Active:0x0, RunFlag:0x0\nStart from main system(0x0)!\nCRC:0x3d80a8b4, Magic1:0x5a5a5a5a, Magic2:0xa5a5a5a5, count:1, CommitedArea:0x0, Active:0x0, RunFlag:0x0\nUBI: attaching mtd1\nubi0: scanning is finished\nubi0: attached mtd1 (name \"mtd=1\", size 255 MiB)\nubi0: PEB size: 131072 bytes (128 KiB), LEB size: 126976 bytes\nubi0: min./max. I/O unit sizes: 2048/2048, sub-page size 2048\nubi0: VID header offset: 2048 (aligned 2048), data offset: 4096\nubi0: good PEBs: 2040, bad PEBs: 0, corrupted PEBs: 0\nubi0: user volume: 15, internal volumes: 1, max. volumes count: 128\nubi0: max/mean erase counter: 33/20, WL threshold: 4096, image sequence number: 957459587\nubi0: available PEBs: 36, total reserved PEBs: 2004, PEBs reserved for bad PEB handling: 40\nMain area (A) is OK!\nCRC:0x93e83925, Magic1:0x5a5a5a5a, Magic2:0xa5a5a5a5, count:1, CommitedArea:0x0, Active:0x0, RunFlag:0x0\nLoading file 'doublecore' to addr 0x85a00000...\n** File not found doublecore **\nUnmounting UBIFS volume file_system!\nUnmount ubifs success!\nBootcmd:ubi read 0x80907f6c kernelA 0x1bb2c0; bootm 0x80907fc0\nBootArgs:noalign mem=247M flashsize=0x10000000 console=ttyAMA1,115200 ubi.mtd=1 root=/dev/mtdblock11 rootfstype=squashfs mtdparts=hinand:0x100000(startcode),0xff00000(ubifs),-(reserved) pcie0_sel=x1 maxcpus=2 l2_cache=l2x0 coherent_pool=4M user_debug=0x1f panic=1 skb_priv=192 debug_ll=on\nU-boot Start from NORMAL Mode!\n## Booting kernel from Legacy Image at 80907fc0 ...\n   Image Name:   Linux-3.10.53-HULK2\n   Image Type:   ARM Linux Kernel Image (uncompressed)\n   Data Size:    1815084 Bytes = 1.7 MiB\n   Load Address: 80e08000\n   Entry Point:  80e08000\n\nMatch the dtb file index : 3!\n   Memory Start: 80900000\n   XIP Kernel Image ... OK\n   kernel loaded at 0x80908000, end = 0x80ac03ca\n\nStarting kernel ...\n\nUart base = 0x1010F000\ndtb addr = 0x80F633D8\nUncompressing Linux... done, booting the kernel.\nBooting Linux on physical CPU 0x0\nInitializing cgroup subsys cpuset\nInitializing cgroup subsys cpu\nInitializing cgroup subsys cpuacct\nLinux version 3.10.53-HULK2 (ci@SZXRTOSCI10000) (gcc version 4.7.1 (SDK V100R005C00SPC030B050) ) #1 SMP Fri Apr 13 19:54:43 CST 2018\nCPU: ARMv7 Processor [414fc091] revision 1 (ARMv7), cr=18c53c7d\nCPU: PIPT / VIPT nonaliasing data cache, VIPT aliasing instruction cache\nMachine: Hisilicon A9, model: HISI-CA9\nskbuff priv len is 192.\nMemory policy: ECC disabled, Data cache writealloc\nOn node 0 totalpages: 63232\nfree_area_init_node: node 0, pgdat c04a7340, node_mem_map c0667800\n  Normal zone: 618 pages used for memmap\n  Normal zone: 0 pages reserved\n  Normal zone: 63232 pages, LIFO batch:15\n[dts]:cpu type is 5115\nPERCPU: Embedded 7 pages/cpu @c08d6000 s7488 r8192 d12992 u32768\npcpu-alloc: s7488 r8192 d12992 u32768 alloc=8*4096\npcpu-alloc: [0] 0 [0] 1 [0] 2 [0] 3\nBuilt 1 zonelists in Zone order, mobility grouping on.  Total pages: 62614\nKernel command line: noalign mem=247M flashsize=0x10000000 console=ttyAMA1,115200 ubi.mtd=1 root=/dev/mtdblock11 rootfstype=squashfs mtdparts=hinand:0x100000(startcode),0xff00000(ubifs),-(reserved) pcie0_sel=x1 maxcpus=2 l2_cache=l2x0 coherent_pool=4M user_debug=0x1f panic=1 skb_priv=192 debug_ll=on\nPID hash table entries: 1024 (order: 0, 4096 bytes)\nDentry cache hash table entries: 32768 (order: 5, 131072 bytes)\nInode-cache hash table entries: 16384 (order: 4, 65536 bytes)\nallocated 505856 bytes of page_cgroup\nplease try 'cgroup_disable=memory' option if you don't want memory cgroups\nMemory: 247MB = 247MB total\nMemory: 244628k/244628k available, 8300k reserved, 0K highmem\nVirtual kernel memory layout:\n    vector  : 0xffff0000 - 0xffff1000   (   4 kB)\n    fixmap  : 0xffe00000 - 0xfffe0000   (1920 kB)\n    vmalloc : 0xcf800000 - 0xff000000   ( 760 MB)\n    lowmem  : 0xc0000000 - 0xcf700000   ( 247 MB)\n    modules : 0xbf000000 - 0xc0000000   (  16 MB)\n      .text : 0xc0008000 - 0xc04350e0   (4277 kB)\n      .init : 0xc0436000 - 0xc0462d40   ( 180 kB)\n      .data : 0xc0464000 - 0xc04ab3c8   ( 285 kB)\n       .bss : 0xc04ab3c8 - 0xc04d4108   ( 164 kB)\nSLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=4, Nodes=1\nHierarchical RCU implementation.\nNR_IRQS:512\nsched_clock: 32 bits at 100MHz, resolution 10ns, wraps every 42949ms\n[DTS][LED]-->WARN:Cannot find led info in dtb,make sure there is no led on board\nCalibrating delay loop... 1594.16 BogoMIPS (lpj=7970816)\npid_max: default: 32768 minimum: 301\nSecurity Framework initialized\nMount-cache hash table entries: 512\nInitializing cgroup subsys memory\nInitializing cgroup subsys devices\nInitializing cgroup subsys freezer\nInitializing cgroup subsys net_cls\nInitializing cgroup subsys blkio\nInitializing cgroup subsys net_prio\nCPU: Testing write buffer coherency: ok\nSetting up static identity map for 0xc0318498 - 0xc03184cc\nSD511x chip id:0x51162100\nsd511x_core_reset cpu : 1  mask=200\nCPU1: Booted secondary processor\nBrought up 2 CPUs\nSMP: Total of 2 processors activated (3188.32 BogoMIPS).\nCPU: All CPU(s) started in SVC mode.\nNET: Registered protocol family 16\nDMA: preallocated 4096 KiB pool for atomic coherent allocations\nL310 cache controller enabled\nl2x0: 16 ways, CACHE_ID 0x410000c9, AUX_CTRL 0x02450001, Cache size: 524288 B\nbio: create slab <bio-0> at 0\nSwitching to clocksource arm,sp804\ncfg80211: Calling CRDA to update world regulatory domain\nNET: Registered protocol family 2\nTCP established hash table entries: 2048 (order: 2, 16384 bytes)\nTCP bind hash table entries: 2048 (order: 3, 32768 bytes)\nTCP: Hash tables configured (established 2048 bind 2048)\nTCP: reno registered\nUDP hash table entries: 256 (order: 1, 12288 bytes)\nUDP-Lite hash table entries: 256 (order: 1, 12288 bytes)\nNET: Registered protocol family 1\nPCI: CLS 0 bytes, default 64\nsquashfs: version 4.0 (2009/01/31) Phillip Lougher\njffs2: version 2.2. © 2001-2006 Red Hat, Inc.\nfuse init (API version 7.22)\nmsgmni has been set to 477\nio scheduler noop registered\nio scheduler deadline registered\nio scheduler cfq registered (default)\nbrd: module loaded\nmtdoops: mtd device (mtddev=name/number) must be supplied\nSpi id table Version 1.22\nSpecial nand id table Version 1.33\nHisilicon Nand Flash Controller V301 Device Driver, Version 1.10\nNand ID: 0xEF 0xDA 0x90 0x95 0x04 0x00 0x00 0x00\nNand(Hardware): Block:128KB Page:2KB Chip:256MB OOB:64B ECC:4bit\nNAND device: Manufacturer ID: 0xef, Chip ID: 0xda (Winbond W29N02GV), 256MiB, page size: 2048, OOB size: 64\nNAND_ECC_NONE selected by board driver. This is not recommended!\n3 cmdlinepart partitions found on MTD device hinand\nCreating 3 MTD partitions on \"hinand\":\n0x000000000000-0x000000100000 : \"startcode\"\n0x000000100000-0x000010000000 : \"ubifs\"\n0x000010000000-0x000010000000 : \"reserved\"\nmtd: partition \"reserved\" is out of reach -- disabled\nsoftdog: Software Watchdog Timer: 0.08 initialized. soft_noboot=0 soft_margin=60 sec soft_panic=0 (nowayout=0)\nTCP: cubic registered\nNET: Registered protocol family 17\nThumbEE CPU extension supported.\nmapp kbox ddrram_address=0,                     ddrram_size=0 fail[WARNNING]:Kbox device descriptor struct kbox_dev_des             Intialization Failed\nkbox: init ddrram fail ret=-99\nkbox: load OK\nUBI: attaching mtd1 to ubi0\nUBI: scanning is finished\nUBI: attached mtd1 (name \"ubifs\", size 255 MiB) to ubi0\nUBI: PEB size: 131072 bytes (128 KiB), LEB size: 126976 bytes\nUBI: min./max. I/O unit sizes: 2048/2048, sub-page size 2048\nUBI: VID header offset: 2048 (aligned 2048), data offset: 4096\nUBI: good PEBs: 2040, bad PEBs: 0, corrupted PEBs: 0\nUBI: user volume: 15, internal volumes: 1, max. volumes count: 128\nUBI: max/mean erase counter: 33/20, WL threshold: 512, image sequence number: 957459587\nUBI: available PEBs: 36, total reserved PEBs: 2004, PEBs reserved for bad PEB handling: 40\nUBI: background thread \"ubi_bgt0d\" started, PID 320\nWarning: unable to open an initial console.\nsquashfs_cache_init: sqcachesize=8.\nVFS: Mounted root (squashfs filesystem) readonly on device 31:11.\nFreeing unused kernel memory: 176K (c0436000 - c0462000)\n******** Total Boot time: 2184 ms, uncompress initrd cost 0 ms ********\nSerial: 8250/16550 driver, 4 ports, IRQ sharing disabled\n1010e000.uart: ttyAMA0 at MMIO 0x1010e000 (irq = 77) is a 16550A\n</code></pre>\nFiles:\n<pre><code>ls -l\n-rw-r--r-- 1 1048576 May  1 21:01 1startcode.bin\n-rwxr--r-- 1 267386880 May  1 23:59 2ubifs.BIN\n-rwxr--r-- 1 8388608 May  2 00:04 3reserved.BIN\n-rwxr--r-- 1 276824064 May  1 17:25 HS8247W.BIN\n-rwxr--r-- 1 276824064 May  1 17:21 W29N02GVSIAA@TSOP48.BIN\n</code></pre>\nExtract:\n<pre><code>ubireader_extract_files HS8247W.BIN \nUBI_File Warning: end_offset - start_offset length is not block aligned, could mean missing data\nubireader_extract_files 2ubifs.BIN \nUBI_File Warning: end_offset - start_offset length is not block aligned, could mean missing data.\nUBI Fatal: Less than 2 layout blocks found.\n</code></pre>\nbinwalk:\n<pre><code>binwalk HS8247W.BIN \n\nDECIMAL       HEXADECIMAL     DESCRIPTION\n--------------------------------------------------------------------------------\n98466         0x180A2         CRC32 polynomial table, little endian\n100510        0x1889E         CRC32 polynomial table, little endian\n101712        0x18D50         CRC32 polynomial table, little endian\n1081344       0x108000        UBI erase count header, version: 1, EC: 0x0, VID header offset: 0x800, data offset: 0x1000\n\n\nbinwalk -y ubifs HS8247W.BIN \n\nDECIMAL       HEXADECIMAL     DESCRIPTION\n--------------------------------------------------------------------------------\n73805952      0x4663080       UBIFS filesystem master node, CRC: 0xEF0A21B9, highest inode: 66, commit number: 63\n73808064      0x46638C0       UBIFS filesystem master node, CRC: 0xCB98EAEA, highest inode: 66, commit number: 63\n73810176      0x4664100       UBIFS filesystem master node, CRC: 0xBD7EE1FF, highest inode: 66, commit number: 64\n73812288      0x4664940       UBIFS filesystem master node, CRC: 0xB14E14E2, highest inode: 66, commit number: 64\n73814400      0x4665180       UBIFS filesystem master node, CRC: 0x3B1B53EB, highest inode: 66, commit number: 65\n73816512      0x46659C0       UBIFS filesystem master node, CRC: 0x372BA6F6, highest inode: 66, commit number: 65\n73818624      0x4666200       UBIFS filesystem master node, CRC: 0x3DB34991, highest inode: 66, commit number: 66\n73820736      0x4666A40       UBIFS filesystem master node, CRC: 0x3183BC8C, highest inode: 66, commit number: 66\n73822848      0x4667280       UBIFS filesystem master node, CRC: 0x20393568, highest inode: 66, commit number: 67\n73824960      0x4667AC0       UBIFS filesystem master node, CRC: 0xEC9E85CB, highest inode: 66, commit number: 68\n73827072      0x4668300       UBIFS filesystem master node, CRC: 0xE0AE70D6, highest inode: 66, commit number: 68\n73829184      0x4668B40       UBIFS filesystem master node, CRC: 0xE29587B0, highest inode: 66, commit number: 69\n93405312      0x5914080       UBIFS filesystem master node, CRC: 0xCB98EAEA, highest inode: 66, commit number: 63\n93407424      0x59148C0       UBIFS filesystem master node, CRC: 0xC7A81FF7, highest inode: 66, commit number: 63\n93409536      0x5915100       UBIFS filesystem master node, CRC: 0xB14E14E2, highest inode: 66, commit number: 64\n93411648      0x5915940       UBIFS filesystem master node, CRC: 0xA51F0BC5, highest inode: 66, commit number: 64\n93413760      0x5916180       UBIFS filesystem master node, CRC: 0x372BA6F6, highest inode: 66, commit number: 65\n93415872      0x59169C0       UBIFS filesystem master node, CRC: 0x13B96DA5, highest inode: 66, commit number: 65\n93417984      0x5917200       UBIFS filesystem master node, CRC: 0x3183BC8C, highest inode: 66, commit number: 66\n93420096      0x5917A40       UBIFS filesystem master node, CRC: 0x25D2A3AB, highest inode: 66, commit number: 66\n93422208      0x5918280       UBIFS filesystem master node, CRC: 0x2C09C075, highest inode: 66, commit number: 67\n93424320      0x5918AC0       UBIFS filesystem master node, CRC: 0xE0AE70D6, highest inode: 66, commit number: 68\n93426432      0x5919300       UBIFS filesystem master node, CRC: 0xF4FF6FF1, highest inode: 66, commit number: 68\n93428544      0x5919B40       UBIFS filesystem master node, CRC: 0xF6C49897, highest inode: 66, commit number: 69\n143282304     0x88A5080       UBIFS filesystem superblock node, CRC: 0xACB725AE, flags: 0x0, min I/O unit size: 2048, erase block size: 126976, erase block count: 166, max erase blocks: 1024, format version: 4, compression type: lzo\n143822976     0x8929080       UBIFS filesystem superblock node, CRC: 0x3D42921F, flags: 0x0, min I/O unit size: 2048, erase block size: 126976, erase block count: 1058, max erase blocks: 1058, format version: 4, compression type: lzo\n154230912     0x9316080       UBIFS filesystem master node, CRC: 0x99550E76, highest inode: 184268, commit number: 740\n154233024     0x93168C0       UBIFS filesystem master node, CRC: 0x2DB33D44, highest inode: 184275, commit number: 741\n154235136     0x9317100       UBIFS filesystem master node, CRC: 0x921F617, highest inode: 184275, commit number: 741\n154237248     0x9317940       UBIFS filesystem master node, CRC: 0x94230F0D, highest inode: 184275, commit number: 742\n154239360     0x9318180       UBIFS filesystem master node, CRC: 0xDFF6E2A1, highest inode: 184314, commit number: 743\n154241472     0x93189C0       UBIFS filesystem master node, CRC: 0xDDC57ABF, highest inode: 184501, commit number: 744\n154243584     0x9319200       UBIFS filesystem master node, CRC: 0x8FABE3EC, highest inode: 184724, commit number: 745\n154245696     0x9319A40       UBIFS filesystem master node, CRC: 0xD2679171, highest inode: 184939, commit number: 746\n159232128     0x97DB080       UBIFS filesystem master node, CRC: 0xBDC7C525, highest inode: 184268, commit number: 740\n159234240     0x97DB8C0       UBIFS filesystem master node, CRC: 0x921F617, highest inode: 184275, commit number: 741\n159236352     0x97DC100       UBIFS filesystem master node, CRC: 0x511030A, highest inode: 184275, commit number: 741\n159238464     0x97DC940       UBIFS filesystem master node, CRC: 0x9813FA10, highest inode: 184275, commit number: 742\n159240576     0x97DD180       UBIFS filesystem master node, CRC: 0xC797089B, highest inode: 184314, commit number: 743\n159242688     0x97DD9C0       UBIFS filesystem master node, CRC: 0xD1F58FA2, highest inode: 184501, commit number: 744\n159244800     0x97DE200       UBIFS filesystem master node, CRC: 0x9BFAFCCB, highest inode: 184724, commit number: 745\n159246912     0x97DEA40       UBIFS filesystem master node, CRC: 0xCA067B4B, highest inode: 184939, commit number: 746\n</code></pre>\nAny clue?\n",
    "votes": "0",
    "answers": 0,
    "views": "165",
    "tags": [
        "firmware-analysis",
        "dump"
    ],
    "user": "Tiago Conceição",
    "time": "May 3, 2024 at 16:28",
    "comments": [],
    "answers_data": []
}