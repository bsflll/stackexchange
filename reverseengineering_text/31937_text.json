{
    "title": "Radare2: How to Create a Custom Scripted Panel?",
    "link": "https://reverseengineering.stackexchange.com/questions/31937/radare2-how-to-create-a-custom-scripted-panel",
    "content": "TLDR: How do I get a panel in radare2 to correctly show the output of a radare2 command piped to an external script?\ne.g. <pre><code>afvd | python var_displayer.py</code></pre>\n\nThis is my current view. Multiple panels, using radare2's <pre><code>v</code></pre> command. Note the <pre><code>afvd</code></pre> and RegisterRefs (<pre><code>drr</code></pre>) panels.\n\n\n\nI love RegisterRefs (<pre><code>drr</code></pre>) because it shows values at addresses. I love <pre><code>afvd</code></pre> because it shows all var values.\nProblem: <pre><code>afvd</code></pre> only shows var values as decimal.\nSometimes, it makes more sense to see it as hex.\nSometimes, it makes more sense to see it as ASCII.\nI want to create something like <pre><code>afvdr</code></pre> that shows var values in different formats + refstr, like <pre><code>drr</code></pre> does for registers.\nI want to replace my current <pre><code>afvd</code></pre> panel with this new tool.\n\nWhat do I have so far?\n\nI know that if I take a var's value (e.g. <pre><code>var_8h</code></pre> = <pre><code>4287356032</code></pre>) and run the r2 command <pre><code>? <expr></code></pre>, it will evaluate the expression and show me different representations!\n\n\n\nI developed a python script, called <pre><code>var_displayer.py</code></pre> that will read the output from <pre><code>avfd</code></pre> and calculate and neatly display the <pre><code>hex</code></pre> and <pre><code>string</code></pre> representations the same as the <pre><code>? <expr></code></pre> command would. I run it within r2 using <pre><code>afvd | python scripts/var_displayer.py</code></pre>. Here's the output:\n\n\n\nThis is awesome! I don't have the dereference functionality (treat var value as an address and show the value underlying), which would be useful like <pre><code>drr</code></pre>, but this is great for me!\nHowever, a problem occurs when I try to replace the <pre><code>afvd</code></pre> panel with <pre><code>afvd | python scripts/var_displayer.py</code></pre>.\n\n\n\nNote how the panel only shows the output of <pre><code>afvd</code></pre>, and note how the string generated by my python script is awkwardly appended to the entire radare2 panels output in the bottom left.\nMy python script builds the output string in one variable named <pre><code>output_string</code></pre> and then outputs this string with a call to <pre><code>sys.stdout.write(out_string)</code></pre>. Unfortunately, radare2 doesn't seem to expect this for a panel's display.\n\nTHANKS FOR READING SO FAR!!!\nMy Questions Are:\n\nIs it possible to configure a radare2 panel to neatly show the output of an external script/program?\nIs there a better way to achieve the evaluate functionality (<pre><code>? <expr></code></pre>) and dereference evaluate functionality (<pre><code>drr</code></pre> refstr column) for vars that is native to radare2?\n\nI'm falling in love with radare2 for it's customizability and elegance and slick CLI feel, but I'm pretty surprised to find custom script --> panel is not working. I feel like there must be a way to achieve this that I haven't figured out yet.\n",
    "votes": "2",
    "answers": 0,
    "views": "76",
    "tags": [
        "debugging",
        "radare2",
        "python",
        "script",
        "visualization"
    ],
    "user": "Khalid",
    "time": "Jun 4, 2023 at 15:11",
    "comments": [],
    "answers_data": []
}