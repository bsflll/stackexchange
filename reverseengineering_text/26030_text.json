{
    "title": "IDA/HexRays: how do I retrieve the memory address associated with a given line of decompiled code?",
    "link": "https://reverseengineering.stackexchange.com/questions/26030/ida-hexrays-how-do-i-retrieve-the-memory-address-associated-with-a-given-line-o",
    "content": "I'm trying to programmatically link decompiled code generated by HexRays with the disassembly code of a given binary by mapping memory addresses between the two. The mapping exists, as I can see view it through IDA on a case by case basis (see the line of decompiled code in green, associated with the memory address in gold, which lets me reference the disassembly. Clicking through different decompiled source lines links to different memory addresses/sets of disassembly lines). But I can't find any way to get at these associations via scripting (IDC, IDAPython, etc) or via the command line. This strikes me as strange, as I can't imagine that this functionality hasn't been sought out or used before.\nMy end goal is to be able to read in a set of decompiled code line numbers, then return all the lines of disassembly which map to those decompiled code lines.\nThanks!\n",
    "votes": "2",
    "answers": 1,
    "views": "2k",
    "tags": [
        "ida",
        "decompilation",
        "disassemblers",
        "hexrays"
    ],
    "user": "TFD",
    "time": "Oct 2, 2020 at 15:55",
    "comments": [],
    "answers_data": [
        {
            "content": "In <pre><code>hexrays.hpp</code></pre>, <pre><code>citem_t</code></pre> is the base class for both <pre><code>cinsn_t</code></pre> (\"instructions\", such as <pre><code>for</code></pre> loops, <pre><code>if</code></pre> statements, etc.) and <pre><code>cexpr_t</code></pre> (\"expressions\", such as addition, memory dereference, function calls, etc.) <pre><code>citem_t</code></pre> has a field <pre><code>ea_t ea;</code></pre>. That field stores the address of the corresponding line in the assembly language (unless it's <pre><code>BADADDR</code></pre>, in which case, the decompiler machinery lost track of the address).\nTo accomplish your goal specifically, you're going to want to get your hands on the <pre><code>cinsn_t</code></pre> objects on certain lines in the decompilation listing. Here are three separate ideas for how to accomplish this:\n\nGrab the function body directly out of the <pre><code>cfunc_t</code></pre> and process it yourself;\nUse a <pre><code>ctree_visitor_t</code></pre> object to visit all <pre><code>cinsn_t</code></pre> objects within the decompilation listing;\nCall <pre><code>kernwin.hpp::read_selection</code></pre> to get a selection of lines within the decompilation listing (there will be some work to do in mapping these back to positions within the decompiled function body).\n",
            "votes": "3",
            "user": "Rolf Rolles",
            "time": "Oct 4, 2020 at 19:21",
            "is_accepted": false,
            "comments": [
                {
                    "user": "TFD",
                    "text": "<span class=\"comment-copy\">Thanks a ton for your detailed help! I'll give this a shot tomorrow morning.</span>",
                    "time": null
                }
            ]
        }
    ]
}