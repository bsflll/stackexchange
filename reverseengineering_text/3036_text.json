{
    "title": "Differences in memory dumps of executable data",
    "link": "https://reverseengineering.stackexchange.com/questions/3036/differences-in-memory-dumps-of-executable-data",
    "content": "I'm comparing memory dumps in python with diStorm and volatility and try to analyze for given MemoryDumps (the 'dump' and the 'truth') whenever or not there was process injection.\nMainly I try to match processes and vads in to dumps to each other to compare them, but i get quiet a lot of white noise (false positives).\nHere is a log I received comparing two clean memory dumps only by comparing modules (notepad and calc):\n<pre><code>[10:08:13] Loading  'D:\notepad.zip'\n[10:08:36] Loading  'D:\\calc.zip'\n[10:08:59] No match found for #208 \"calc.exe\"!\n[10:08:59] 01/17    matching \"csrss.exe\"\n[10:09:08] 02/17    matching \"VBoxTray.exe\"\n[10:09:18] 03/17    matching \"svchost.exe\"\n[10:12:51] 04/17    matching \"ctfmon.exe\"\n[10:12:55] 05/17    matching \"VBoxService.exe\"\n[10:13:24] 06/17    matching \"smss.exe\"\n[10:13:25] 07/17    matching \"explorer.exe\"\n[10:14:39] Module difference @ 0x772fb186   \"\\WINDOWS\\system32\\shlwapi.dll\"\nSUB AL, 0x77                    SUB AL, 0x77\nPOP ESP                         MOV DL, 0x14\nDB 0x15                         DB 0xbd\nDB 0x2d\n[10:14:39] Module difference @ 0x772fb817   \"\\WINDOWS\\system32\\shlwapi.dll\"\nXOR [EAX], EAX                  XOR [EAX], EAX\nADD [EAX], AL                   DB 0x0\nDB 0x0                          DB 0xbd\n[10:14:39] Module difference @ 0x77fb5e17   \"\\WINDOWS\\system32\ntdll.dll\"\nADD [ECX+0x0], AH               ADD [EDI+0x0], CH\nINS BYTE [ES:EDI], DX           DB 0x74\n[10:14:39] Module difference @ 0x77fb5e1f   \"\\WINDOWS\\system32\ntdll.dll\"\nADD [EBP+0x0], AH               ADD [ECX+0x0], AH\nDB 0x78                         DB 0x64\n[10:14:39] Module difference @ 0x77fb5e27   \"\\WINDOWS\\system32\ntdll.dll\"\nADD [EAX], AL                   ADD [EAX+0x0], BH\nDB 0x0                          DB 0x65\nDB 0x73\n[10:14:41] 08/17    matching \"spoolsv.exe\"\n[10:15:24] 10/17    matching \"svchost.exe\"\n[10:15:47] 11/17    matching \"msmsgs.exe\"\n[10:16:06] 12/17    matching \"svchost.exe\"\n[10:16:38] 13/17    matching \"svchost.exe\"\n[10:17:08] 14/17    matching \"winlogon.exe\"\n[10:18:03] 15/17    matching \"services.exe\"\n[10:18:19] 16/17    matching \"lsass.exe\"\n[10:19:15] Module difference @ 0x74414320   \"\\WINDOWS\\system32\\samsrv.dll\"\nADD [EAX], AL                   JO 0x743bffb4\nADD [EAX], AL                   ADC AL, 0xc\nADD [EAX], AL                   OR AL, 0xde\nADD [EAX], AL                   INTO\n[10:19:15] Module difference @ 0x74414546   \"\\WINDOWS\\system32\\samsrv.dll\"\nADD [EAX], AL                   ADD [EAX], AL\nADD [EAX], AL                   DB 0xff\nADD [EAX], AL                   DB 0xff\nDB 0x0                          DB 0xff\n[10:19:16] Module difference @ 0x76f411bf   \"\\WINDOWS\\system32\\wldap32.dll\"\nADD [EAX], AL                   ADD AL, CH\nDB 0x3e                         JAE 0x76f2000f\nDB 0xc\n[10:19:17] Module difference @ 0x77cff169   \"\\WINDOWS\\system32\\rpcrt4.dll\"\nDB 0x3                          MOV AL, [0x49ff5965]\nDB 0x35\nDB 0xa1\nIN AL, 0x3a\n[10:19:20] 17/17    matching \"System\"\n</code></pre>\nIf i try ans also compare the executable image of the process I recieve even more noise\n<pre><code>[12:10:13] 01/17    matching \"csrss.exe\"\n[12:10:22] Instruction missmatch @ 0x5302db (13)\nADD [EAX-0x671ea561], CH        ADD AL, CH\nRETF                            AND AL, 0x98\nAND ECX, 0x2b0003               CWDE\n[12:10:22] Instruction missmatch @ 0x53033b (6)\nADD [EBP+0x0], AH               ADD [EBX+0x0], DH\n[12:10:22] Instruction missmatch @ 0x5304c7 (9)\nADD [EAX], AH                   ADD AL, CH\nADC EAX, 0x95d8bc65             ADD [EAX], AL\nTEST AL, 0xe1                   ADD [EAX], AL\n[12:10:22] Instruction missmatch @ 0x53065d (2)\nADD [EBX], AL                   ADD [EAX+EAX], AL\n[12:10:22] Instruction missmatch @ 0x5307bb (6)\nADD [EBX+0x0], DH               ADD AL, CH\n[12:10:22] Instruction missmatch @ 0x5307c5 (7)\nADD [EAX+EAX-0x439c6800], AH    ADD [ECX+0x0], BL\n[12:10:22] Instruction missmatch @ 0x530864 (1)\nSTD                             FLD DWORD [EAX]\n[12:10:22] Instruction missmatch @ 0x53086d (4)\nADD [EAX+EAX+0x18], AL          ADD [EDX+0x60551800], AL\n[12:10:22] Instruction missmatch @ 0x53096c (13)\nCMP [EBP+0x65], CH              MOV AL, [0x70e18a84]\nMOV ESP, 0xe1a895d8             LOOPZ 0x530072\nADD EAX, 0xd0000300             ADD EAX, [EAX]\n</code></pre>\nEach dump has been created on the same Windows XP VM.\nAny idea on how to filter that noise? Would be thankful for any hint and sorry for my bad english.\n",
    "votes": "5",
    "answers": 1,
    "views": "560",
    "tags": [
        "executable",
        "memory"
    ],
    "user": "Nordwald",
    "time": "Nov 14, 2013 at 11:21",
    "comments": [
        {
            "user": "Stolas",
            "text": "Sounds like you want to disable ASLR. Have a look at: stackoverflow.com/questions/9560993/â€¦\n",
            "time": null
        }
    ],
    "answers_data": [
        {
            "content": "Unfortunately, certain factors are in play that will make it incredibly hard to filter. Specifically, everything from the calling convention windows uses to function prologs to space in said prologues to allow hot patching, etc...Windows' Application Binary Interface (ABI) is incorporated in every execution on the box. Naturally, this means you wont be able to filter it out, as several instructions are fairly common.\nIf you're merely trying to diff binaries to see how similar they are, the main one i would suggest is SSDEEP found in this answer\n",
            "votes": "2",
            "user": "Community",
            "time": "Apr 13, 2017 at 12:49",
            "is_accepted": true,
            "comments": []
        }
    ]
}