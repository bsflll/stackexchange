{
    "title": "Radare2: How to Create a Custom Scripted Panel?",
    "link": "https://reverseengineering.stackexchange.com/questions/31937/radare2-how-to-create-a-custom-scripted-panel",
    "content": "<html><body><div class=\"s-prose js-post-body\" itemprop=\"text\">\n <p>\n  <strong>\n   TLDR: How do I get a panel in radare2 to correctly show the output of a radare2 command piped to an external script?\n  </strong>\n </p>\n <p>\n  <strong>\n   e.g.\n   <code>\n    afvd | python var_displayer.py\n   </code>\n  </strong>\n </p>\n <ul>\n  <li>\n   This is my current view. Multiple panels, using radare2's\n   <code>\n    v\n   </code>\n   command. Note the\n   <code>\n    afvd\n   </code>\n   and RegisterRefs (\n   <code>\n    drr\n   </code>\n   ) panels.\n  </li>\n </ul>\n <p>\n  <a href=\"https://i.sstatic.net/lw7Vq.png\" rel=\"nofollow noreferrer\">\n   <img alt=\"enter image description here\" src=\"https://i.sstatic.net/lw7Vq.png\"/>\n  </a>\n </p>\n <ul>\n  <li>\n   I love RegisterRefs (\n   <code>\n    drr\n   </code>\n   ) because it shows values at addresses. I love\n   <code>\n    afvd\n   </code>\n   because it shows all var values.\n  </li>\n  <li>\n   <strong>\n    Problem:\n    <code>\n     afvd\n    </code>\n    only shows var values as decimal.\n   </strong>\n  </li>\n  <li>\n   Sometimes, it makes more sense to see it as hex.\n  </li>\n  <li>\n   Sometimes, it makes more sense to see it as ASCII.\n  </li>\n  <li>\n   <strong>\n    I want to create something like\n    <code>\n     afvdr\n    </code>\n    that shows var values in different formats + refstr,\n   </strong>\n   like\n   <code>\n    drr\n   </code>\n   does for registers.\n  </li>\n  <li>\n   I want to replace my current\n   <code>\n    afvd\n   </code>\n   panel with this new tool.\n  </li>\n </ul>\n <p>\n  What do I have so far?\n </p>\n <ul>\n  <li>\n   I know that if I take a var's value (e.g.\n   <code>\n    var_8h\n   </code>\n   =\n   <code>\n    4287356032\n   </code>\n   ) and run the r2 command\n   <code>\n    ? <expr>\n   </code>\n   , it will evaluate the expression and show me different representations!\n  </li>\n </ul>\n <p>\n  <a href=\"https://i.sstatic.net/zatfH.png\" rel=\"nofollow noreferrer\">\n   <img alt=\"enter image description here\" src=\"https://i.sstatic.net/zatfH.png\"/>\n  </a>\n </p>\n <ul>\n  <li>\n   I developed a python script, called\n   <code>\n    var_displayer.py\n   </code>\n   that will read the output from\n   <code>\n    avfd\n   </code>\n   and calculate and neatly display the\n   <code>\n    hex\n   </code>\n   and\n   <code>\n    string\n   </code>\n   representations the same as the\n   <code>\n    ? <expr>\n   </code>\n   command would. I run it within r2 using\n   <code>\n    afvd | python scripts/var_displayer.py\n   </code>\n   . Here's the output:\n  </li>\n </ul>\n <p>\n  <a href=\"https://i.sstatic.net/YByld.png\" rel=\"nofollow noreferrer\">\n   <img alt=\"enter image description here\" src=\"https://i.sstatic.net/YByld.png\"/>\n  </a>\n </p>\n <ul>\n  <li>\n   This is awesome! I don't have the dereference functionality (treat var value as an address and show the value underlying), which would be useful like\n   <code>\n    drr\n   </code>\n   , but this is great for me!\n  </li>\n  <li>\n   However, a problem occurs when I try to replace the\n   <code>\n    afvd\n   </code>\n   panel with\n   <code>\n    afvd | python scripts/var_displayer.py\n   </code>\n   .\n  </li>\n </ul>\n <p>\n  <a href=\"https://i.sstatic.net/QcrI5.png\" rel=\"nofollow noreferrer\">\n   <img alt=\"enter image description here\" src=\"https://i.sstatic.net/QcrI5.png\"/>\n  </a>\n </p>\n <ul>\n  <li>\n   Note how the panel only shows the output of\n   <code>\n    afvd\n   </code>\n   , and note how the string generated by my python script is awkwardly appended to the entire radare2 panels output in the bottom left.\n  </li>\n  <li>\n   My python script builds the output string in one variable named\n   <code>\n    output_string\n   </code>\n   and then outputs this string with a call to\n   <code>\n    sys.stdout.write(out_string)\n   </code>\n   .\n   <strong>\n    Unfortunately, radare2 doesn't seem to expect this for a panel's display.\n   </strong>\n  </li>\n </ul>\n <p>\n  THANKS FOR READING SO FAR!!!\n </p>\n <p>\n  <strong>\n   My Questions Are:\n  </strong>\n </p>\n <ol>\n  <li>\n   <strong>\n    Is it possible to configure a radare2 panel to neatly show the output of an external script/program?\n   </strong>\n  </li>\n  <li>\n   <strong>\n    Is there a better way to achieve the evaluate functionality (\n    <code>\n     ? <expr>\n    </code>\n    ) and dereference evaluate functionality (\n    <code>\n     drr\n    </code>\n    refstr column) for vars that is native to radare2?\n   </strong>\n  </li>\n </ol>\n <p>\n  I'm falling in love with radare2 for it's customizability and elegance and slick CLI feel, but I'm pretty surprised to find custom script --> panel is not working. I feel like there must be a way to achieve this that I haven't figured out yet.\n </p>\n</div>\n</body></html>",
    "votes": "2",
    "answers": 0,
    "views": "76",
    "tags": [
        "debugging",
        "radare2",
        "python",
        "script",
        "visualization"
    ],
    "user": "Khalid",
    "time": "Jun 4, 2023 at 15:11",
    "comments": [],
    "answers_data": []
}