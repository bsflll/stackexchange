{
    "title": "How to retrieve generically memory reads of an input and determine all relevant offsets?",
    "link": "https://reverseengineering.stackexchange.com/questions/23367/how-to-retrieve-generically-memory-reads-of-an-input-and-determine-all-relevant",
    "content": "<html><body><div class=\"s-prose js-post-body\" itemprop=\"text\">\n <p>\n  I would like to record all memory read operations that are performed by an application on a given input file, to help infer which specific parts of an input are relevant for the specific execution that opens the input.\n </p>\n <p>\n  I'm trying to achieve this for Windows applications, whereas the applications itself can be\n  <code>\n   x86\n  </code>\n  or\n  <code>\n   x64\n  </code>\n  , and the input is not of a specific format (e.g. solution should not only work with\n  <code>\n   JPG\n  </code>\n  , but also\n  <code>\n   PNG\n  </code>\n  or\n  <code>\n   XYZ\n  </code>\n  ). The solution is intended to work for applications without access to the source code (binaries only, no symbols).\n </p>\n <p>\n  <strong>\n   An example\n  </strong>\n </p>\n <p>\n  Input\n  <code>\n   foo.bar\n  </code>\n  :\n </p>\n <ul>\n  <li>\n   Input file is\n   <code>\n    100\n   </code>\n   bytes long, binary format.\n  </li>\n </ul>\n <p>\n  Program n:\n </p>\n <ul>\n  <li>\n   <p>\n    Can be called like\n    <code>\n     > Program.exe foo.bar\n    </code>\n    , or through\n    <kbd>\n     File\n    </kbd>\n    >\n    <kbd>\n     Open\n    </kbd>\n    >\n    <kbd>\n     foo.bar\n    </kbd>\n   </p>\n  </li>\n  <li>\n   <p>\n    Opens foo.bar and parses offsets\n    <code>\n     x\n    </code>\n    ,\n    <code>\n     y\n    </code>\n    , and\n    <code>\n     z\n    </code>\n    and does something with it (e.g. convert to something else, output somewhere, do some arithmetic with it and return result, etc.). For input\n    <code>\n     foo.bar2\n    </code>\n    , the offsets that are worked with might be different.\n   </p>\n  </li>\n </ul>\n <p>\n  <strong>\n   Potential problems I can think of:\n  </strong>\n </p>\n <ul>\n  <li>\n   <p>\n    If the developer uses something like\n    <code>\n     fseek (SetFilePointer?)\n    </code>\n    , they would go directly to the relevant offset within the input. However, in many cases it might be more likely to open the whole input/file and then go to offsets based on other specific values within that input by using something like\n    <code>\n     offset_n+34\n    </code>\n    .\n   </p>\n  </li>\n  <li>\n   <p>\n    There are multiple methods how an input file can be opened or accessed by an application (\n    <code>\n     OpenFile\n    </code>\n    ,\n    <code>\n     CreateFileA/W\n    </code>\n    ,\n    <code>\n     MapViewOfFile\n    </code>\n    ,\n    <code>\n     OpenFileMappingA\n    </code>\n    , etc.)\n   </p>\n  </li>\n  <li>\n   <p>\n    Speed might be an issue if there are many read operations (however, in my case I don't care too much about performance).\n   </p>\n  </li>\n </ul>\n <p>\n  As per my current understanding, what I could do as a start is to:\n </p>\n <p>\n  1) Research the specific Windows APIs for file opening/handling\n </p>\n <p>\n  2) Set a breakpoint on them and retrieve the parameters\n </p>\n <p>\n  3) From here on, how can I determine or map the specific offsets within an input and the program access on it?\n </p>\n <p>\n  Is there any script or tool that already does something like this, e.g. by relying on WinDbg or DBI frameworks like DynamoRIO or PIN?\n </p>\n <p>\n  If not, I'd really appreciate if someone can point me towards specific resources or key words that would help me in better understand how to approach this problem and come up with a pratical solution. Any help would be much appreciated.\n </p>\n</div>\n</body></html>",
    "votes": "3",
    "answers": 0,
    "views": "86",
    "tags": [
        "debugging",
        "dynamic-analysis"
    ],
    "user": "MmM",
    "time": "Mar 1, 2020 at 17:59",
    "comments": [
        {
            "user": "macro_controller",
            "text": "<html><body><span class=\"comment-copy\">\n I think a general concept you are talking about called\n <code>\n  taint analysis\n </code>\n .\n</span>\n</body></html>",
            "time": null
        }
    ],
    "answers_data": []
}