{
    "title": "Radare2 - \"/c pointer; offset\" command not giving expected response to search instances of the same pair of similar instructions",
    "link": "https://reverseengineering.stackexchange.com/questions/27316/radare2-c-pointer-offset-command-not-giving-expected-response-to-search-in",
    "content": "<html><body><div class=\"s-prose js-post-body\" itemprop=\"text\">\n <p>\n  I am trying to find an offset IOSURFACEROOTUSERCLIENT_VTAB from an iOS kext(IOSurface) using radare2 and there is a need to use the command\n  <code>\n   \"/c pointer; offset\"\n  </code>\n  as per the instructions in this\n  <a href=\"https://gist.github.com/uroboro/2cc054e1bc995232a4919044eae29967\" rel=\"nofollow noreferrer\">\n   <em>\n    <strong>\n     gist\n    </strong>\n   </em>\n  </a>\n  . On performing the command the expected out put is a list of locations where the specific instruction occurs.\n </p>\n <p>\n  But when i try to run, the previous commands do work as expected. Except for the above command which gives the following output:\n </p>\n <pre><code>[0xfffffff00688b0d4]> \"/c 0xfffffff007622000; 0x898\"\nUsage: /c   Search for crypto materials\n| /ca                 Search for AES keys expanded in memory\n| /cc[algo] [digest]  Find collisions (bruteforce block length values until given checksum is found)\n| /cd                 Search for ASN1/DER certificates\n| /cr                 Search for ASN1/DER private keys (RSA and ECC)\n</code></pre>\n <p>\n  I'm getting the same response when the double quotes are dropped.\n </p>\n <p>\n  Please help me understand what is wrong here, or if the format for radare2 has changed over the course of time or if I missed something.\n </p>\n <p>\n  I did read the radare2 docs and but could not find any format in this form:\n  <code>\n   \"/c pointer; offset\"\n  </code>\n </p>\n <p>\n  Thanks!\n </p>\n</div>\n</body></html>",
    "votes": "1",
    "answers": 1,
    "views": "136",
    "tags": [
        "radare2",
        "ios",
        "kernel",
        "offset"
    ],
    "user": "iSeeker",
    "time": "Mar 29, 2021 at 5:18",
    "comments": [
        {
            "user": "Paweł Łukasik",
            "text": "<html><body><span class=\"comment-copy\">\n try dropping the \"\" ?\n</span>\n</body></html>",
            "time": null
        },
        {
            "user": "iSeeker",
            "text": "<html><body><span class=\"comment-copy\">\n @PawełŁukasik Tried already, but didnt work. Getting the same response as above.\n</span>\n</body></html>",
            "time": null
        },
        {
            "user": "iSeeker",
            "text": "<html><body><span class=\"comment-copy\">\n @PawełŁukasik Is there something else that i am missing here? I am a new to reversing. Please help me learn.\n</span>\n</body></html>",
            "time": null
        },
        {
            "user": "Paweł Łukasik",
            "text": "<html><body><span class=\"comment-copy\">\n what version are you running?\n</span>\n</body></html>",
            "time": null
        },
        {
            "user": "iSeeker",
            "text": "<html><body><span class=\"comment-copy\">\n @PawełŁukasik On running\n <code>\n  brew info radare2\n </code>\n , it seems the version is\n <code>\n  radare2: stable 5.1.1 (bottled), HEAD\n </code>\n</span>\n</body></html>",
            "time": null
        }
    ],
    "answers_data": [
        {
            "content": "<html><body><div class=\"s-prose js-post-body\" itemprop=\"text\">\n <p>\n  The\n  <a href=\"https://gist.github.com/uroboro/2cc054e1bc995232a4919044eae29967\" rel=\"nofollow noreferrer\">\n   gist\n  </a>\n  contains some old (create 3 yrs ago) r2 instructions and according to, also outdated, r2 book, it looks like\n  <a href=\"https://radare.gitbooks.io/radare2book/content/search_bytes/intro.html\" rel=\"nofollow noreferrer\">\n   <code>\n    /c\n   </code>\n   command\n  </a>\n  was responsible for \"search for asm code matching the given string\". Currently (\n  <code>\n   radare2 5.2.0-git 26093 @ linux-x86-64 git.5.1.1\n  </code>\n  ) the similar instruction could be one from\n  <code>\n   /a\n  </code>\n  group\n </p>\n <pre><code>Usage: /a[?] [arg]  Search for assembly instructions matching given properties\n| /a push rbp           Assemble given instruction and search the bytes\n| /a1 [number]          Find valid assembly generated by changing only the nth byte\n| /aI                   Search for infinite loop instructions (jmp $$)\n| /aa mov eax           Linearly find aproximated assembly (case insensitive strstr)\n| /ac mov eax           Same as /aa, but case-sensitive\n| /ad[/*j] push;mov     Match ins1 followed by ins2 in linear disasm\n| /ad/ ins1;ins2        Search for regex instruction 'ins1' followed by regex 'ins2'\n| /ad/a instr           Search for every byte instruction that matches regexp 'instr'\n| /ae esil              Search for esil expressions matching substring\n| /af[l] family         Search for instruction of specific family (afl=list\n| /ai[j] 0x300 [0x500]  Find all the instructions using that immediate (in range)\n| /al                   Same as aoml, list all opcodes\n| /am opcode            Search for specific instructions of specific mnemonic\n| /ao instr             Search for instruction 'instr' (in all offsets)\n| /as[l] ([type])       Search for syscalls (See /at swi and /af priv)\n| /at[l] ([type])       Search for instructions of given type  \n</code></pre>\n <p>\n  It looks like especially\n  <code>\n   /ad/\n  </code>\n  should work as it can find sections of code where two instructions are following each other matching some regexp.\n </p>\n <p>\n  Based on this I think the following should work for you:\n </p>\n <pre><code>[0x00000000]>\"/ad/ 0xfffffff007622000;0x898\"\n</code></pre>\n</div>\n</body></html>",
            "votes": "1",
            "user": "Paweł Łukasik",
            "time": "Apr 28, 2021 at 7:48",
            "is_accepted": true,
            "comments": [
                {
                    "user": "iSeeker",
                    "text": "<span class=\"comment-copy\">I tried /ad/ with quotes, but resulted in error <code>Error: /ci : Invalid range</code>. So I dropped the quotes and it gave a bunch of locations. But not as expected in the gist, and is a longer list. I created a pastebin for it: <a href=\"https://pastebin.com/zwfJMSnM\" rel=\"nofollow noreferrer\">pastebin.com/zwfJMSnM</a>. I am not clear how to proceed with this.</span>",
                    "time": null
                },
                {
                    "user": "Paweł Łukasik",
                    "text": "<span class=\"comment-copy\">without the quotes will find only the first bytes in the command. it should works with the quotes. Try w/o space between first and second value. I'm running this locally on some values that I know are consecutive and it works as expected <a href=\"https://ibb.co/KjzD9nY\" rel=\"nofollow noreferrer\">ibb.co/KjzD9nY</a></span>",
                    "time": null
                },
                {
                    "user": "iSeeker",
                    "text": "<span class=\"comment-copy\">Sorry for the delayed response, I was positive for the virus and was away. This worked as you said, with quotes but without the space. Thank you very much for your help! and I will accept this as the answer. I humbly suggest that you perform the edit on your answer so that it is clear to others who may look for this.</span>",
                    "time": null
                }
            ]
        }
    ]
}