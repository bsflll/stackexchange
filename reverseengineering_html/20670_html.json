{
    "title": "What methods exist for adding new windows form controls into compiled assembly using dnSpy?",
    "link": "https://reverseengineering.stackexchange.com/questions/20670/what-methods-exist-for-adding-new-windows-form-controls-into-compiled-assembly-u",
    "content": "<html><body><div class=\"s-prose js-post-body\" itemprop=\"text\">\n <p>\n  I am trying to add another button into windows form using dnSpy. Is it possible to add another?\n  <a href=\"https://i.sstatic.net/EehrI.png\" rel=\"nofollow noreferrer\">\n   <img alt=\"\" src=\"https://i.sstatic.net/EehrI.png\"/>\n  </a>\n </p>\n <p>\n  I want the end result be like this one.\n  <a href=\"https://i.sstatic.net/qpqLs.png\" rel=\"nofollow noreferrer\">\n   <img alt=\"enter image description here\" src=\"https://i.sstatic.net/qpqLs.png\"/>\n  </a>\n </p>\n <p>\n  Any help will be highly appreciated.Thanks\n </p>\n</div>\n</body></html>",
    "votes": "0",
    "answers": 1,
    "views": "774",
    "tags": [
        "c#",
        "visual-basic"
    ],
    "user": "Cloud Automation",
    "time": "Mar 10, 2019 at 16:30",
    "comments": [
        {
            "user": "Paweł Łukasik",
            "text": "<html><body><span class=\"comment-copy\">\n Of course it is possible.\n</span>\n</body></html>",
            "time": null
        },
        {
            "user": "dingo_kinznerhook",
            "text": "<html><body><span class=\"comment-copy\">\n It would be better to rephrase the question to ask specifically for the information you're looking for. For example, the title could be \"What methods exist for adding new windows form controls into compiled assembly using dnSpy?\" If you ask, \"is it possible to do X\" most likely the answer will be yes.\n</span>\n</body></html>",
            "time": null
        }
    ],
    "answers_data": [
        {
            "content": "<html><body><div class=\"s-prose js-post-body\" itemprop=\"text\">\n <p>\n  Yes, it is possible!\n </p>\n <p>\n  You'll have to do some trial and error for positioning though.\n </p>\n <p>\n  <a href=\"https://i.sstatic.net/8Ta0V.png\" rel=\"nofollow noreferrer\">\n   <img alt=\"Example form\" src=\"https://i.sstatic.net/8Ta0V.png\"/>\n  </a>\n </p>\n <p>\n  Adding in a new control is fairly easy. We essentially need to do what the designer usually automatically does for us and create the new control and set up its properties ourselves. Luckily, we can use the button that's already there as a template.\n </p>\n <p>\n  First order of business is declaring our new button. Right click inside the class and hit \"Edit Class\" to open the code editor. Scroll down to the bottom where the variables are declared and declare our new button like so:\n </p>\n <pre><code>public Button button2;\n</code></pre>\n <p>\n  Once that's done, you should be able to find the designer auto-generated\n  <code>\n   InitializeComponent()\n  </code>\n  method for the form you want to modify. This is the function that does the initial setup for our form. it'll look something like this:\n </p>\n <pre><code>private void InitializeComponent()\n    {\n        this.button1 = new Button();\n        base.SuspendLayout();\n        this.button1.Location = new Point(189, 45);\n        this.button1.Name = \"button1\";\n        this.button1.Size = new Size(170, 53);\n        this.button1.TabIndex = 0;\n        this.button1.Text = \"ADD ANOTHER LIKE ME\";\n        this.button1.UseVisualStyleBackColor = true;\n        base.AutoScaleDimensions = new SizeF(6f, 13f);\n        base.AutoScaleMode = AutoScaleMode.Font;\n        base.ClientSize = new Size(563, 329);\n        base.Controls.Add(this.button1);\n        base.Name = \"Form1\";\n        this.Text = \"Form1\";\n        base.ResumeLayout(false);\n    }\n</code></pre>\n <p>\n  We can copy and paste the creation code for the button that already exists in this case and replace \"button1\" with \"button2\". You'll probably want to change the tab index too.\n </p>\n <pre><code>private void InitializeComponent()\n    {\n        this.button1 = new Button();\n        this.button2 = new Button();\n        base.SuspendLayout();\n        this.button1.Location = new Point(189, 45);\n        this.button1.Name = \"button1\";\n        this.button1.Size = new Size(170, 53);\n        this.button1.TabIndex = 0;\n        this.button1.Text = \"ADD ANOTHER LIKE ME\";\n        this.button1.UseVisualStyleBackColor = true;\n\n        this.button2.Location = new Point(189, 145);\n        this.button2.Name = \"button2\";\n        this.button2.Size = new Size(170, 53);\n        this.button2.TabIndex = 1;\n        this.button2.Text = \"I am Added\";\n        this.button2.UseVisualStyleBackColor = true;\n\n        base.AutoScaleDimensions = new SizeF(6f, 13f);\n        base.AutoScaleMode = AutoScaleMode.Font;\n        base.ClientSize = new Size(563, 329);\n        base.Controls.Add(this.button1);\n        base.Name = \"Form1\";\n        this.Text = \"Form1\";\n        base.ResumeLayout(false);\n    }\n</code></pre>\n <p>\n  Then, to get your button to actually appear, you'll need to add the line\n  <code>\n   base.Controls.Add(this.button2);\n  </code>\n  under\n  <code>\n   base.Controls.Add(this.button1);\n  </code>\n  .\n </p>\n <p>\n  We're not done yet, as our new button will have the exact same properties as the original if we leave it like this, and will appear in the same place with the same text. Replacing the text is easy, simply change the value of\n  <code>\n   this.button2.Text\n  </code>\n  to your desired value. The position will take a little trial and error.\n </p>\n <p>\n  You'll need to edit this line:\n </p>\n <pre><code>this.button2.Location = new Point(189, 45);\n</code></pre>\n <p>\n  Here, the first argument of\n  <code>\n   Point\n  </code>\n  is the button's X position and the second is the button's Y position. To move the button downwards as seen in your question, you'll need to increase the Y position. How much you need to increase it depends on where you want the new button to be.\n </p>\n <p>\n  To save and test your changes, go to\n  <code>\n   File -> Save Module\n  </code>\n  . Your final code should look something like this:\n </p>\n <pre><code>// Token: 0x02000002 RID: 2\npublic class Form1 : Form\n{\n    // Token: 0x06000001 RID: 1\n    public Form1()\n    {\n        this.InitializeComponent();\n    }\n\n    // Token: 0x06000002 RID: 2\n    protected override void Dispose(bool disposing)\n    {\n        if (disposing && this.components != null)\n        {\n            this.components.Dispose();\n        }\n        base.Dispose(disposing);\n    }\n\n    // Token: 0x06000003 RID: 3\n    private void InitializeComponent()\n    {\n        this.button1 = new Button();\n        this.button2 = new Button();\n        base.SuspendLayout();\n        this.button1.Location = new Point(189, 45);\n        this.button1.Name = \"button1\";\n        this.button1.Size = new Size(170, 53);\n        this.button1.TabIndex = 0;\n        this.button1.Text = \"ADD ANOTHER LIKE ME\";\n        this.button1.UseVisualStyleBackColor = true;\n        this.button2.Location = new Point(189, 145);\n        this.button2.Name = \"button2\";\n        this.button2.Size = new Size(170, 53);\n        this.button2.TabIndex = 1;\n        this.button2.Text = \"I am Added\";\n        this.button2.UseVisualStyleBackColor = true;\n        base.AutoScaleDimensions = new SizeF(6f, 13f);\n        base.AutoScaleMode = AutoScaleMode.Font;\n        base.ClientSize = new Size(563, 329);\n        base.Controls.Add(this.button1);\n        base.Controls.Add(this.button2);\n        base.Name = \"Form1\";\n        this.Text = \"Form1\";\n        base.ResumeLayout(false);\n    }\n\n    // Token: 0x04000001 RID: 1\n    private IContainer components;\n\n    // Token: 0x04000002 RID: 2\n    private Button button1;\n\n    public Button button2;\n}\n</code></pre>\n <p>\n  and my final form looked like this:\n  <a href=\"https://i.sstatic.net/gSFPS.png\" rel=\"nofollow noreferrer\">\n   <img alt=\"Final form\" src=\"https://i.sstatic.net/gSFPS.png\"/>\n  </a>\n </p>\n <p>\n  I hope this helped!\n </p>\n</div>\n</body></html>",
            "votes": "2",
            "user": "Jill Nesbit",
            "time": "Feb 22, 2019 at 20:10",
            "is_accepted": true,
            "comments": [
                {
                    "user": "Cloud Automation",
                    "text": "<span class=\"comment-copy\">Which version of DnSpy you are using?. My DeCompiled code looks completely different. Your answer is technically correct but not working for me. If you have time can you help me with that?.</span>",
                    "time": null
                }
            ]
        }
    ]
}