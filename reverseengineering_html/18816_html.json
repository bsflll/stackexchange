{
    "title": "What is the format of this binary file?",
    "link": "https://reverseengineering.stackexchange.com/questions/18816/what-is-the-format-of-this-binary-file",
    "content": "<html><body><div class=\"s-prose js-post-body\" itemprop=\"text\">\n <p>\n  I have a binary file that I found on a 3D printer that is used to program a dsPIC30F5011 microcontroller. It is responsible for some basic data encryption. The only problem is, I am not sure how this file is formatted.\n </p>\n <p>\n  It is raw binary, not like an Intel HEX file or anything. Here's a few sample lines:\n </p>\n <hr/>\n <p>\n  0C4230050037600010E0801802003B21\n </p>\n <p>\n  0C424001F02C1A00370004BE6011B819\n </p>\n <p>\n  0C42506B09200982CF0200390882CFE0\n </p>\n <p>\n  0C42600441B06942520E003208003BDD\n </p>\n <hr/>\n <p>\n  For the first line:\n </p>\n <p>\n  So the first byte (0x0C) is the length of the data.\n </p>\n <p>\n  The next two bytes (0x4230) is the address (I believe it is twice the address, I'll explain that further down)\n </p>\n <p>\n  Then is the data (length 0x0C in this case)  - 050037600010E0801802003Bh\n </p>\n <p>\n  The last two bytes are a Checksum  - 2's complement of the lower byte of the sum of all bytes (length through end of data).\n </p>\n <hr/>\n <p>\n  The reason I believe the address listed is twice the address desired is in the\n  <a href=\"http://ww1.microchip.com/downloads/en/DeviceDoc/70102J.pdf\" rel=\"nofollow noreferrer\">\n   Programming Manual\n  </a>\n  the Intel Hex format says:\n </p>\n <blockquote>\n  <p>\n   â€¢ AAAA - is a four-digit hexadecimal address\n  representing the starting address of the data\n  record. Format is high byte first followed by low\n  byte. The address is doubled because this format\n  only supports 8-bits. Divide the value by two to\n  find the real device address.\n  </p>\n </blockquote>\n <p>\n  In fact, this format closely matches the Intel HEX format, although it isn't in ASCII format, nor does it use valid record types.\n </p>\n <p>\n  In addition, the last few commands in the file reference address 0x0008 - 0x01FF. Dividing this by 2 gives us 0x0004 - 0x00FF, which according to the\n  <a href=\"http://ww1.microchip.com/downloads/en/DeviceDoc/70116J.pdf\" rel=\"nofollow noreferrer\">\n   datasheet\n  </a>\n  is the interrupt vector locations.\n </p>\n <p>\n  I have been poking at this for ages, and I can't seem to understand how this is actually translated to the MCU. For one thing, the addresses all increment in 16 byte increments, despite the fact that there is only 12 bytes of data in that line.\n </p>\n <p>\n  If anyone can make any sense out of this, I feel like I am at wit's end on this one.\n </p>\n <p>\n  <a href=\"https://drive.google.com/file/d/1WJcVrc11UX7Ps2JL9Y1RhsXNqdPd-4TJ/view?usp=sharing\" rel=\"nofollow noreferrer\">\n   Here's the full file (42 KB)\n  </a>\n </p>\n <p>\n  And here's some more hex if you don't feel like downloading the file:\n </p>\n <pre><code>0C4210889FBE8A9FBE0105780100E077\n0C422004003508003C0000E0200032E3\n0C4230050037600010E0801802003B21\n0C424001F02C1A00370004BE6011B819\n0C42506B09200982CF0200390882CFE0\n0C42600441B06942520E003208003BDD\n0C42708281716101648904D10884D34B\n0C42808B05E80442E8F9FF3A0500371E\n0C429008044489844C8B05E90442E9D1\n0C42A0FBFF3A1B01070AF0A701F0A089\n0C42B04F05BE4F04BE000006889FBEF4\n0C42C08A9FBE8C1F783801073F013335\n0C42D003866C6450E12E00326420E193\n0C42E03300326150E12F00326120E118\n0C42F0310032858555EB07B009002035\n0C430008042005003708044489844CA0\n0C43100A003106034387834B00015371\n0C432081815BF8FF330203BE0800A09F\n0C433008044489844CF6FF39C639DDCE\n0C43408301730100321300208904D1B6\n0C43500884D30998A30500320800A7D8\n0C43600300A08904D10884D38B05E879\n0C43708904D10884D30001EB0281D243\n0C4380E4000701F0A10CF0A701F0A080\n0C43901701376420E11901320801BE5A\n0C43A00200BEF7FF376120E11401327B\n0C43B06000B8F3FF3700002001F82780\n0C43C0F0FF3704002010013703F0A2CA\n0C43D0889FBE8A9FBE8C1F78F30007F8\n0C43E0FA00336450E14F00326420E129\n0C43F052003203826C07003B0905D02C\n0C44000306D0820F540C065D02003948\n0C44100200328901780306788582558D\n0C442004003D0003FD8103FD8502EA5D\n0C44308B8542840F7202003B6000107C\n0C4440E080186011B80005EB7A28E15C\n0C44500A0039060078C75DDDF707B2EE\n0C44608780752D00378281710A017879\n0C44706105608180D10080D38502E9E5\n0C4480F9FF3B06044087844802003B23\n0C4490600414E0841C0988A3070032BB\n0C44A08A81718281716101648904D1FC\n0C44B00884D38B05E81700370978A3B7\n</code></pre>\n</div>\n</body></html>",
    "votes": "2",
    "answers": 1,
    "views": "420",
    "tags": [
        "binary-analysis",
        "firmware",
        "memory",
        "pic"
    ],
    "user": "user3397540",
    "time": "Jul 16, 2018 at 21:15",
    "comments": [],
    "answers_data": [
        {
            "content": "<html><body><div class=\"s-prose js-post-body\" itemprop=\"text\">\n <p>\n  As you found, the binary format is similar to the Intelhex format, even if that is text.\n </p>\n <p>\n  One important thing to note is that the program space is addressed in 16 bit words, but stores only 24 bits of resulting 32 bit words. The topmost byte is a \"phantom byte\" as the documentation calls it. When read, it is always zero.\n </p>\n <p>\n  All \"records\" are 16 bytes long.\n </p>\n <ul>\n  <li>\n   The first byte is the length of the data.\n  </li>\n  <li>\n   The next two bytes in big-endian are the byte address of the data. The actual address in the program space is only the half of this value, as each program space word is 16 bits wide.\n  </li>\n  <li>\n   There is no record type marker.\n  </li>\n  <li>\n   The actual data follow, as many as the first byte says. The values are in little-endian.  Since the program space stores only 24 bits, the phantom byte it is not included in the data.\n  </li>\n  <li>\n   The last byte is the checksum. You can look at it as the two's complement of the sum of the other bytes. But you could as well add it to this sum and the resulting byte shall be zero.\n  </li>\n </ul>\n <p>\n  This is an example in details:\n </p>\n <pre class=\"lang-none prettyprint-override\"><code>0C4230050037600010E0801802003B21\n</code></pre>\n <ul>\n  <li>\n   The first byte is\n   <code>\n    0C\n   </code>\n   , meaning there are 12 data bytes.\n  </li>\n  <li>\n   The address is\n   <code>\n    4230\n   </code>\n   , giving an address of 0x4230 / 2 = 0x2118.\n  </li>\n  <li>\n   The data bytes are\n   <code>\n    050037600010E0801802003B\n   </code>\n   , resulting in 8 program space words: 0x0005, 0x37, 0x0060, 0x10, 0x80E0, 0x18, 0x0002, 0x3B. The instruction codes are 0x370005, 0x100060, 0x1880E0, 0x3B0002.\n  </li>\n  <li>\n   <code>\n    21\n   </code>\n   is the checksum, and 0x0C + 0x42 + ... + 0x21 gives 0x300. Check.\n  </li>\n </ul>\n <p>\n  The linked complete file has few duplicate entries and some zero-data entries. Perhaps this comes from the build or conversion process.  However, it makes some sense.\n </p>\n <p>\n  This is part of the vector table:\n </p>\n <div class=\"s-table-container\">\n  <table class=\"s-table\">\n   <thead>\n    <tr>\n     <th>\n      Program flash address\n     </th>\n     <th>\n      Address in file\n     </th>\n     <th>\n      Data bytes\n     </th>\n     <th>\n      Program space value\n     </th>\n     <th>\n      Meaning\n     </th>\n    </tr>\n   </thead>\n   <tbody>\n    <tr>\n     <td>\n      0x0004\n     </td>\n     <td>\n      0x0008\n     </td>\n     <td>\n      <code>\n       00 04 00\n      </code>\n     </td>\n     <td>\n      0x000400\n     </td>\n     <td>\n      Reserved\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x0006\n     </td>\n     <td>\n      0x000c\n     </td>\n     <td>\n      <code>\n       66 24 00\n      </code>\n     </td>\n     <td>\n      0x002466\n     </td>\n     <td>\n      Oscillator Fail Trap Vector\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x0008\n     </td>\n     <td>\n      0x0010\n     </td>\n     <td>\n      <code>\n       90 24 00\n      </code>\n     </td>\n     <td>\n      0x002490\n     </td>\n     <td>\n      Address Error Trap Vector\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x000a\n     </td>\n     <td>\n      0x0014\n     </td>\n     <td>\n      <code>\n       ba 24 00\n      </code>\n     </td>\n     <td>\n      0x0024ba\n     </td>\n     <td>\n      Stack Error Trap Vector\n     </td>\n    </tr>\n   </tbody>\n  </table>\n </div>\n <p>\n  For another plausibility check I disassembled (by hand using the\n  <a href=\"https://ww1.microchip.com/downloads/en/DeviceDoc/70000157g.pdf\" rel=\"nofollow noreferrer\">\n   Programmer's Reference Manual\n  </a>\n  , there can be errors) the oscillator fail trap interrupt:\n </p>\n <div class=\"s-table-container\">\n  <table class=\"s-table\">\n   <thead>\n    <tr>\n     <th>\n      Program flash address\n     </th>\n     <th>\n      Address in file\n     </th>\n     <th>\n      Data bytes\n     </th>\n     <th>\n      Program space value\n     </th>\n     <th>\n      Assembly code\n     </th>\n    </tr>\n   </thead>\n   <tbody>\n    <tr>\n     <td>\n      0x2466\n     </td>\n     <td>\n      0x48cc\n     </td>\n     <td>\n      <code>\n       36 00 f8\n      </code>\n     </td>\n     <td>\n      0xf80036\n     </td>\n     <td>\n      push RCOUNT\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x2468\n     </td>\n     <td>\n      0x48d0\n     </td>\n     <td>\n      <code>\n       80 9f be\n      </code>\n     </td>\n     <td>\n      0xbe9f80\n     </td>\n     <td>\n      push.d w0\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x246a\n     </td>\n     <td>\n      0x48d4\n     </td>\n     <td>\n      <code>\n       82 9f be\n      </code>\n     </td>\n     <td>\n      0xbe9f82\n     </td>\n     <td>\n      push.d w2\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x246c\n     </td>\n     <td>\n      0x48d8\n     </td>\n     <td>\n      <code>\n       84 9f be\n      </code>\n     </td>\n     <td>\n      0xbe9f84\n     </td>\n     <td>\n      push.d w4\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x246e\n     </td>\n     <td>\n      0x48dc\n     </td>\n     <td>\n      <code>\n       86 9f be\n      </code>\n     </td>\n     <td>\n      0xbe9f86\n     </td>\n     <td>\n      push.d w6\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x2470\n     </td>\n     <td>\n      0x48e0\n     </td>\n     <td>\n      <code>\n       34 00 f8\n      </code>\n     </td>\n     <td>\n      0xf80034\n     </td>\n     <td>\n      push PSVPAG\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x2472\n     </td>\n     <td>\n      0x48e4\n     </td>\n     <td>\n      <code>\n       00 c0 b3\n      </code>\n     </td>\n     <td>\n      0xb3c000\n     </td>\n     <td>\n      mov.b #0, w0\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x2474\n     </td>\n     <td>\n      0x48e8\n     </td>\n     <td>\n      <code>\n       a0 01 88\n      </code>\n     </td>\n     <td>\n      0x8801a0\n     </td>\n     <td>\n      mov w0, PSVPAG\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x2476\n     </td>\n     <td>\n      0x48ec\n     </td>\n     <td>\n      <code>\n       00 00 fa\n      </code>\n     </td>\n     <td>\n      0xfa0000\n     </td>\n     <td>\n      lnk #0\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x2478\n     </td>\n     <td>\n      0x48f0\n     </td>\n     <td>\n      <code>\n       40 a7 a8\n      </code>\n     </td>\n     <td>\n      0xa8a740\n     </td>\n     <td>\n      bset 0x0740, #10\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x247a\n     </td>\n     <td>\n      0x48f4\n     </td>\n     <td>\n      <code>\n       80 20 a9\n      </code>\n     </td>\n     <td>\n      0xa92080\n     </td>\n     <td>\n      bclr NSTDIS, #4\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x247c\n     </td>\n     <td>\n      0x48f8\n     </td>\n     <td>\n      <code>\n       e0 02 20\n      </code>\n     </td>\n     <td>\n      0x2002e0\n     </td>\n     <td>\n      mov #0x002e, w0\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x247e\n     </td>\n     <td>\n      0x48fc\n     </td>\n     <td>\n      <code>\n       17 01 07\n      </code>\n     </td>\n     <td>\n      0x070117\n     </td>\n     <td>\n      rcall 0x26ae\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x2480\n     </td>\n     <td>\n      0x4900\n     </td>\n     <td>\n      <code>\n       00 80 fa\n      </code>\n     </td>\n     <td>\n      0xfa8000\n     </td>\n     <td>\n      ulnk\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x2482\n     </td>\n     <td>\n      0x4904\n     </td>\n     <td>\n      <code>\n       34 00 f9\n      </code>\n     </td>\n     <td>\n      0xf90034\n     </td>\n     <td>\n      pop PSVPAG\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x2484\n     </td>\n     <td>\n      0x4908\n     </td>\n     <td>\n      <code>\n       4f 03 be\n      </code>\n     </td>\n     <td>\n      0xbe034f\n     </td>\n     <td>\n      pop.d w6\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x2486\n     </td>\n     <td>\n      0x490c\n     </td>\n     <td>\n      <code>\n       4f 02 be\n      </code>\n     </td>\n     <td>\n      0xbe024f\n     </td>\n     <td>\n      pop.d w4\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x2488\n     </td>\n     <td>\n      0x4910\n     </td>\n     <td>\n      <code>\n       4f 01 be\n      </code>\n     </td>\n     <td>\n      0xbe014f\n     </td>\n     <td>\n      pop.d w2\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x248a\n     </td>\n     <td>\n      0x4914\n     </td>\n     <td>\n      <code>\n       4f 00 be\n      </code>\n     </td>\n     <td>\n      0xbe004f\n     </td>\n     <td>\n      pop.d w0\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x248c\n     </td>\n     <td>\n      0x4918\n     </td>\n     <td>\n      <code>\n       36 00 f9\n      </code>\n     </td>\n     <td>\n      0xf90036\n     </td>\n     <td>\n      pop RCOUNT\n     </td>\n    </tr>\n    <tr>\n     <td>\n      0x248e\n     </td>\n     <td>\n      0x491c\n     </td>\n     <td>\n      <code>\n       00 40 06\n      </code>\n     </td>\n     <td>\n      0x064000\n     </td>\n     <td>\n      retfie\n     </td>\n    </tr>\n   </tbody>\n  </table>\n </div>\n</div>\n</body></html>",
            "votes": "1",
            "user": "the busybee",
            "time": "Mar 5 at 13:59",
            "is_accepted": false,
            "comments": []
        }
    ]
}