{
    "title": "What is the meaning of this code generated by IDA Pro?",
    "link": "https://reverseengineering.stackexchange.com/questions/3597/what-is-the-meaning-of-this-code-generated-by-ida-pro",
    "content": "<html><body><div class=\"s-prose js-post-body\" itemprop=\"text\">\n <p>\n  Test platform is Linux 32 bit.\n </p>\n <p>\n  I use IDA Pro to disassembly the basename from coreutils 8.5\n compiled by gcc 4.6.3\n </p>\n <p>\n  Here is a code snippet generated by IDA Pro\n </p>\n <pre><code>           call    _i686_get_pc_thunk_bx                                 \n           add     ebx, 292Eh\n           sub     esp, 18h\n           mov     eax, ds:(__dso_handle_ptr - 804DFF4h[ebx]\n           test    eax, eax\n           jz      short loc_804B6F8\n           mov     eax, [eax]\n\n     loc_804B6DB:\n           mov     [esp+1Ch+var_14], eax\n           mov     eax, [esp+1Ch+arg_0]\n           mov     dword [esp+1Ch+var_18], 0\n           mov     [esp+1Ch+var_1C], eax\n           call    __cxa_atexit\n           add     esp, 18h\n           pop     ebx\n           retn\n\n     loc_804B6F8:\n           xor     eax, eax\n           jmp     short loc_804B6DB\n</code></pre>\n <p>\n  I don't understand this line:\n </p>\n <pre><code>mov     eax, ds:(__dso_handle_ptr - 804DFF4h[ebx]\n</code></pre>\n <p>\n  and after searching the code, I can only find this:\n </p>\n <pre><code>        __dso_handle    dd 0\n</code></pre>\n <p>\n  in the .data section.\n </p>\n <p>\n  So my questions are:\n </p>\n <ol>\n  <li>\n   What is the meaning of this line..?  Is it like a version checking stuff..?\n  </li>\n  <li>\n   Can I just safely remove this line without affecting the functionality of the code..?\n  </li>\n </ol>\n</div>\n</body></html>",
    "votes": "3",
    "answers": 1,
    "views": "2k",
    "tags": [
        "ida",
        "disassembly",
        "assembly",
        "disassemblers",
        "nasm"
    ],
    "user": "lllllllllllll",
    "time": "Feb 7, 2014 at 21:12",
    "comments": [
        {
            "user": "0xC0000022L",
            "text": "<html><body><span class=\"comment-copy\">\n You should\n <i>\n  really\n </i>\n add more context!\n</span>\n</body></html>",
            "time": null
        },
        {
            "user": "PhoeniX",
            "text": "<html><body><span class=\"comment-copy\">\n Can you please post at least the whole\n <code>\n  main\n </code>\n of basename?\n</span>\n</body></html>",
            "time": null
        },
        {
            "user": "lllllllllllll",
            "text": "<html><body><span class=\"comment-copy\">\n @ph0sec Thank you and I can modify the question later. But basically I modify my IDC scripts to directly generate nasm syntax asm, then this problem gone....\n</span>\n</body></html>",
            "time": null
        }
    ],
    "answers_data": [
        {
            "content": "<html><body><div class=\"s-prose js-post-body\" itemprop=\"text\">\n <p>\n  You are looking at binary that is compiled as position-independent code. The\n  <code>\n   call    _i686_get_pc_thunk_bx\n  </code>\n  and the following addition to\n  <code>\n   ebx\n  </code>\n  shows just that. If you take a look at the disassembly, you'll see that the address of the\n  <code>\n   add ebx, 292Eh\n  </code>\n  plus 0x292E will result in the first address of the GOT. That why in the next line, _dso_handle_ptr is addressed in such a \"funny\" way.\n </p>\n <p>\n  IDA however is nice enough to show you this in the disassembly as you would normally only see 0xSOMEADDR[ebx].\n </p>\n <p>\n  In terms of the second question: that line retrieves a global variable, puts it into\n  <code>\n   eax\n  </code>\n  and then checks if it is zero or not. So, you should not just \"delete\" that line since then the\n  <code>\n   test eax, eax\n  </code>\n  would use some old value of\n  <code>\n   eax\n  </code>\n  (which I am sure you will not like all that much).\n </p>\n</div>\n</body></html>",
            "votes": "8",
            "user": "sqrtsben",
            "time": "Feb 6, 2014 at 23:13",
            "is_accepted": true,
            "comments": []
        }
    ]
}