{
    "title": "LOG Urls that APK requests using smali",
    "link": "https://reverseengineering.stackexchange.com/questions/22307/log-urls-that-apk-requests-using-smali",
    "content": "<html><body><div class=\"s-prose js-post-body\" itemprop=\"text\">\n <p>\n  I have an APK that uses pinning. I am having an unbelievable time trying to remove the SSL pinning so i figure it might be easier to modify the smali files and recompile to log the LoadURL events.\n </p>\n <p>\n  Below is the method I am trying to log the URL it loads. I have tried to use\n </p>\n <p>\n  <code>\n   invoke-static {v0, v1}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I\n  </code>\n </p>\n <p>\n  but i get register errors in the Android studio logcat.  Any ideas or a better way to see what urls this APK is loading along with the POST request?\n </p>\n <pre><code>.method public run()V\n    .locals 3\n\n    sget v0, Landroid/os/Build$VERSION;->SDK_INT:I\n\n    const/16 v1, 0x12\n\n    if-le v0, v1, :cond_0\n\n    iget-object v0, p0, Lcom/gigya/socialize/android/GSWebBridge$6;->this$0:Lcom/gigya/socialize/android/GSWebBridge;\n\n    invoke-static {v0}, Lcom/gigya/socialize/android/GSWebBridge;->access$100(Lcom/gigya/socialize/android/GSWebBridge;)Landroid/webkit/WebView;\n\n    move-result-object v0\n\n    iget-object v1, p0, Lcom/gigya/socialize/android/GSWebBridge$6;->val$invocation:Ljava/lang/String;\n\n    new-instance v2, Lcom/gigya/socialize/android/GSWebBridge$6$1;\n\n    invoke-direct {v2, p0}, Lcom/gigya/socialize/android/GSWebBridge$6$1;-><init>(Lcom/gigya/socialize/android/GSWebBridge$6;)V\n\n    invoke-virtual {v0, v1, v2}, Landroid/webkit/WebView;->evaluateJavascript(Ljava/lang/String;Landroid/webkit/ValueCallback;)V\n\n    goto :goto_0\n\n    :cond_0\n    iget-object v0, p0, Lcom/gigya/socialize/android/GSWebBridge$6;->this$0:Lcom/gigya/socialize/android/GSWebBridge;\n\n    invoke-static {v0}, Lcom/gigya/socialize/android/GSWebBridge;->access$100(Lcom/gigya/socialize/android/GSWebBridge;)Landroid/webkit/WebView;\n\n    move-result-object v0\n\n    iget-object v1, p0, Lcom/gigya/socialize/android/GSWebBridge$6;->val$invocation:Ljava/lang/String;\n\n    invoke-virtual {v0, v1}, Landroid/webkit/WebView;->loadUrl(Ljava/lang/String;)V\n\n\n    :goto_0\n    return-void\n.end method\n</code></pre>\n <p>\n  Another example, I tried to add a simple log on 2 consts and it errors out as well and crashes\n </p>\n <pre><code>    move-result-object v1\n\n    const-string v2, \"/\"\n\n    const-string v3, \"\"\n\n    invoke-static {v2, v3}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I (this is the added line)\n\n\n    invoke-virtual {v1, v2, v3}, Ljava/lang/String;->replace(Ljava/lang/CharSequence;Ljava/lang/CharSequence;)Ljava/lang/String;\n\n    move-result-object v1\n\n    invoke-virtual {p1}, Landroid/net/Uri;->getEncodedQuery()Ljava/lang/String;\n\n    move-result-object p1\n</code></pre>\n <p>\n  In log cat I get the following error\n </p>\n <pre><code>2019-10-13 13:52:46.823 14636-14636/? W/dex2oat: Verification error in boolean com.gigya.socialize.android.GSWebBridge.handleUrl(android.webkit.WebView, java.lang.String)\n2019-10-13 13:52:46.823 14636-14636/? W/dex2oat: boolean com.gigya.socialize.android.GSWebBridge.handleUrl(android.webkit.WebView, java.lang.String) failed to verify: boolean com.gigya.socialize.android.GSWebBridge.handleUrl(android.webkit.WebView, java.lang.String): [0x29] Rejecting invocation, expected 1 argument registers, method signature has 2 or more\n2019-10-13 13:53:56.296 14703-14703/? W/System.err: a.b.c.f: The exception could not be delivered to the consumer because it has already canceled/disposed the flow or the exception has nowhere to go to begin with. Further reading: https://github.com/ReactiveX/RxJava/wiki/What's-different-in-2.0#error-handling | java.lang.VerifyError: Verifier rejected class com.gigya.socialize.android.GSWebBridge: boolean com.gigya.socialize.android.GSWebBridge.handleUrl(android.webkit.WebView, java.lang.String) failed to verify: boolean com.gigya.socialize.android.GSWebBridge.handleUrl(android.webkit.WebView, java.lang.String): [0x29] Rejecting invocation, expected 1 argument registers, method signature has 2 or more (declaration of 'com.gigya.socialize.android.GSWebBridge' appears in base.apk)\n2019-10-13 13:53:56.297 14703-14703/? W/System.err: Caused by: java.lang.VerifyError: Verifier rejected class com.gigya.socialize.android.GSWebBridge: boolean com.gigya.socialize.android.GSWebBridge.handleUrl(android.webkit.WebView, java.lang.String) failed to verify: boolean com.gigya.socialize.android.GSWebBridge.handleUrl(android.webkit.WebView, java.lang.String): [0x29] Rejecting invocation, expected 1 argument registers, method signature has 2 or more (declaration of 'com.gigya.socialize.android.GSWebBridge' appears in base.apk)\n2019-10-13 13:53:56.297 14703-14703/? W/System.err:     at com.gigya.socialize.android.GSWebBridge.attach(Unknown Source:0)\n2019-10-13 13:53:56.399 14703-14703/? E/AndroidRuntime: FATAL EXCEPTION: main\n</code></pre>\n <p>\n  Then the app crashes as well.\n </p>\n</div>\n</body></html>",
    "votes": "0",
    "answers": 1,
    "views": "1k",
    "tags": [
        "android"
    ],
    "user": "sitedude",
    "time": "Oct 16, 2019 at 7:07",
    "comments": [
        {
            "user": "FelisManulus",
            "text": "<html><body><span class=\"comment-copy\">\n You can try Charles or Fiddler if you just need to inspect the app's traffic. As regards the error, it's weird, provided you only added the single line with the\n <code>\n  Log.e\n </code>\n call.\n</span>\n</body></html>",
            "time": null
        }
    ],
    "answers_data": [
        {
            "content": "<html><body><div class=\"s-prose js-post-body\" itemprop=\"text\">\n <pre><code>2019-10-13 13:52:46.823 14636-14636/? W/dex2oat: Verification error\n</code></pre>\n <p>\n  Looks like\n  <code>\n   dex2oat\n  </code>\n  which is a DEX code compilation tool failed bytecode verification. At first in may seem odd this happens only at runtime, but keep in mind that Android preforms Just-in-time and Ahed-of-time compilation, and both tactics are performed on device.\n </p>\n <pre><code>com...GSWebBridge.handleUrl(android.webkit.WebView, java.lang.String): [0x29] Rejecting invocation, expected 1 argument registers, method signature has 2 or more\n</code></pre>\n <p>\n  I would guess that you called a function that expects two argument with only one arguments. That function does not appear in your snippet so it might indicate you edited some other code. Try to include the erroring function and the code that calls it so we can better understand what is going on.\n </p>\n <p>\n  Hope It helps!\n </p>\n</div>\n</body></html>",
            "votes": "1",
            "user": "Gal",
            "time": "May 2, 2020 at 12:51",
            "is_accepted": false,
            "comments": []
        }
    ]
}