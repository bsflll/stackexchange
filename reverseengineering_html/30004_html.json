{
    "title": "Getting rid of a custom Shell on a LiteOS based outdoor camera",
    "link": "https://reverseengineering.stackexchange.com/questions/30004/getting-rid-of-a-custom-shell-on-a-liteos-based-outdoor-camera",
    "content": "<html><body><div class=\"s-prose js-post-body\" itemprop=\"text\">\n <p>\n  I started reversing\n  <a href=\"https://es.aliexpress.com/item/4001151246566.html?gatewayAdapt=glo2esp&spm=a2g0o.9042311.0.0.5d8563c0ttw3sd\" rel=\"nofollow noreferrer\">\n   this camera\n  </a>\n  in order to get rid of the unwanted traffic it constantly does towards Chinese servers.\n  \n\n  I have a serial access to it thanks to an obvious UART port (bottom left in the picture).\n  \n\n  <a href=\"https://i.sstatic.net/EsaqL.jpg\" rel=\"nofollow noreferrer\">\n   <img alt=\"camera board\" src=\"https://i.sstatic.net/EsaqL.jpg\"/>\n  </a>\n  The camera is based on a\n  <em>\n   Hi3518\n  </em>\n  chip and runs\n  <code>\n   Huawei LiteOS 1.4.5\n  </code>\n  :\n </p>\n <pre><code>SPI Nor(cs 0) ID: 0xef 0x60 0x17\nBlock:64KB Chip:8MB Name:\"W25Q64FW\"\nSPI Nor total size: 8MB\n\n\n********hello Huawei LiteOS ARM926********\n\nversion : Huawei LiteOS V200R001C10B017\nopen-version : Huawei LiteOS 1.4.5\nbuild data : May  2 2018 19:06:05\n\n**********************************\n********Hello Huawei LiteOS********\n\nversion : Huawei LiteOS V200R001C10B017\nopen-version : Huawei LiteOS 1.4.5\nbuild data : May  2 2018 19:06:05\n\n********\nHuawei LiteOS # Spi Nor ID:0xEF 0x60 0x17 0x00 0x00 0x00 0x00 0x00\nSpi Nor Flash Info:\nName:\"W25Q64FW\" Size:8MB Block:64KB\nosal_proc_mkdir - parent is NULL! proc=0x80976bd0\n<6>Hisilicon Media Memory Zone Manager\n</code></pre>\n <p>\n  And once started it does not give a typical\n  <code>\n   /bin/sh\n  </code>\n  to the console, but instead a custom made\n  <em>\n   CLI\n  </em>\n  they call a\n  <em>\n   shell\n  </em>\n  .\nHere are the commands that this \"shell\" has:\n </p>\n <pre><code>Huawei LiteOS # help                                                            \n*******************shell commands:*************************                     \n                                                                                \nap_test       armbenv       arp           call          cat           cat_logmpp\n    cd            cp                                                            \ncpup          debug         dns           excInfo       findsym       format    \n    free          help                                                          \nhiddrs        himd          himm          hwi           i2c_read      i2c_write \n    ifconfig      lddrop                                                        \nlocal_alarm   ls            mclose        memcheck      mkdir         mopen     \n    mount         msgqueue                                                      \nnand_bad      netstat       ntpdate       partinfo      partition     ping      \n    pwd           readreg                                                       \nreset         rm            rmdir         sem           sendbps       shutdown  \n    sleep_device  ssp_read                                                      \nssp_write     sta_test      statfs        swtmr         sync          systeminfo\n    task          telnet                                                        \ntftp          touch         uart_close    uart_config   uart_read     uart_write\n    umount        uname                                                         \nwriteproc     writereg      \n</code></pre>\n <p>\n  Note those commands are functions from this custom\n  <em>\n   CLI\n  </em>\n  ,\n  <strong>\n   not\n  </strong>\n  actual\n  <em>\n   UNIX/Linux/busybox\n  </em>\n  commands.\n </p>\n <p>\n  Those are documented, as is the whole\n  <em>\n   LiteOS\n  </em>\n  SDK, in a pretty well put documentation available on their\n  <a href=\"https://github.com/LiteOS/LiteOS\" rel=\"nofollow noreferrer\">\n   Github\n  </a>\n  , but nothing really give access to the underlying Linux system, unlike many\n  <em>\n   Hi35xx\n  </em>\n  based devices, looks like their build is configured with this\n  <a href=\"https://github.com/LiteOS/LiteOS/blob/master/.config#L312\" rel=\"nofollow noreferrer\">\n   shell enabled\n  </a>\n  .\n </p>\n <p>\n  The most annoying thing is that they also seem to have disabled\n  <em>\n   U-Boot\n  </em>\n  access, even trying to brute force a keystroke during power up doesn't do anything. Nevertheless I think\n  <em>\n   U-Boot\n  </em>\n  is looking for something on the\n  <em>\n   SD-Card\n  </em>\n  as it initializes the\n  <em>\n   SD\n  </em>\n  slot when the camera is powered on with the reset button pressed:\n </p>\n <pre><code>Block:64KB Chip:8MB Name:\"W25Q64FW\"\nSPI Nor total size: 8MB\n\nEMMC/MMC/SD controller initialization.\nMMC/SD Card:\n    MID:         0x3\n    Read Block:  512 Bytes\n    Write Block: 512 Bytes\n    Chip Size:   60906M Bytes (High Capacity)\n    Name:        \"SD64G\"\n    Chip Type:   SD\n    Version:     2.0\n    Speed:       25000000Hz\n    Bus Width:   4bit\n    Boot Addr:   0 Bytes\nInterface:  MMC\n  Device 0: Vendor: Man 035344 Snr e2cf5b82 Rev: 8.5 Prod: SD64G\n            Type: Removable Hard Disk\n            Capacity: 60906.0 MB = 59.4 GB (124735488 x 512)\nPartition 1: Filesystem: FAT32 \"NO NAME    \"\n</code></pre>\n <p>\n  I tried to copy the obvious,\n  <code>\n   uImage\n  </code>\n  ,\n  <code>\n   update/uboot\n  </code>\n  etc... doesn't trigger anything.\n </p>\n <p>\n  I also tried to overflow the shell commands, messing with\n  <code>\n   /jffs0/etc/init.d/rcS\n  </code>\n  , nothing worked so far.\n </p>\n <p>\n  I'd be very happy with some fresh ideas I didn't try yet!\n </p>\n <p>\n  <strong>\n   Edit\n  </strong>\n </p>\n <p>\n  The flash serving as block device is a\n  <em>\n   W25Q64.W\n  </em>\n  , I dumped it using a brand new\n  <em>\n   CH341a\n  </em>\n  and a test clip, first time I did this, very cool. Now I have this dump but the\n  <code>\n   binwalk\n  </code>\n  analysis doesn't look promising:\n </p>\n <pre><code>\nDECIMAL       HEXADECIMAL     DESCRIPTION\n--------------------------------------------------------------------------------\n102060        0x18EAC         CRC32 polynomial table, little endian\n5767168       0x580000        JFFS2 filesystem, little endian\n6512540       0x635F9C        gzip compressed data, from Unix, last modified: 1970-01-01 00:00:00 (null date)\n6512780       0x63608C        JFFS2 filesystem, little endian\n6512968       0x636148        Zlib compressed data, compressed\n6513460       0x636334        Zlib compressed data, compressed\n6513640       0x6363E8        gzip compressed data, from Unix, last modified: 1970-01-01 00:00:00 (null date)\n[hundreds of lines of those]\n8257536       0x7E0000        JFFS2 filesystem, little endian\n</code></pre>\n <p>\n  Here's the entropy graph\n  <a href=\"https://i.sstatic.net/eFMS0.png\" rel=\"nofollow noreferrer\">\n   <img alt=\"binwalk entropy graph\" src=\"https://i.sstatic.net/eFMS0.png\"/>\n  </a>\n  which seems to indicate a huge chunk of the firmware is either encrypted of compressed.\n </p>\n</div>\n</body></html>",
    "votes": "1",
    "answers": 0,
    "views": "462",
    "tags": [
        "firmware",
        "hardware",
        "serial-communication"
    ],
    "user": "iMil",
    "time": "Feb 12, 2022 at 21:53",
    "comments": [
        {
            "user": "masterX244",
            "text": "<html><body><span class=\"comment-copy\">\n No way to pull a flash dump of the bootflash in some way? Boot log tells that there is some sort of SPI flash on the board. Post a pic of the board backside, too if possible\n</span>\n</body></html>",
            "time": null
        },
        {
            "user": "iMil",
            "text": "<html><body><span class=\"comment-copy\">\n Yes that's exact;y what I ordered, will update the post if I get further, thanks!\n</span>\n</body></html>",
            "time": null
        },
        {
            "user": "masterX244",
            "text": "<html><body><span class=\"comment-copy\">\n Picture of reverse side of the PCB should be quick to do though since you only need to unscrew the 4 corner screws and then make the picture of whats at the back of the board. Knowing if there is useful stuff there helps massively\n</span>\n</body></html>",
            "time": null
        },
        {
            "user": "tv athome",
            "text": "<html><body><span class=\"comment-copy\">\n would be interested if this goes any further as I'm working on a xshcam doorbell running the same OS (Huawei liteOs 1.4.6). Block:64KB Chip:8MB Name:\"W25Q64FW\" SPI Nor total size: 8MB Camera OV9732 I can Uboot but doesn't help if there are proprietary blobs for the drivers for camera module and wifi etc..\n</span>\n</body></html>",
            "time": null
        },
        {
            "user": "masterX244",
            "text": "<html><body><span class=\"comment-copy\">\n Linux kernels are usually compressed and get uncompressed by a small stub. Possible to share the flashdump? Also: JFFS2 allows compressed files, too.\n</span>\n</body></html>",
            "time": null
        }
    ],
    "answers_data": []
}