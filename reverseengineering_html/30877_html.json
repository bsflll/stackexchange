{
    "title": "Finding Correct Segment From An Address For Windows 3.1 EXE in IDA Pro",
    "link": "https://reverseengineering.stackexchange.com/questions/30877/finding-correct-segment-from-an-address-for-windows-3-1-exe-in-ida-pro",
    "content": "<html><body><div class=\"s-prose js-post-body\" itemprop=\"text\">\n <p>\n  We have an EXE that IDA pro lists the following segments:\n </p>\n <pre><code>Name    Start   End R   W   X   D   L   Align   Base    Type    Class   AD  es  ss  ds  fs  gs\ncseg01  00000000    0000EA50    ?   ?   ?   .   L   para    0000    public  CODE    16  FFFFFFFF    FFFFFFFF    5BD5    FFFFFFFF    FFFFFFFF\ncseg02  00000000    0000E020    ?   ?   ?   .   L   para    0EA5    public  CODE    16  FFFFFFFF    FFFFFFFF    5BD5    FFFFFFFF    FFFFFFFF\ncseg03  00000000    0000AE20    ?   ?   ?   .   L   para    1CA7    public  CODE    16  FFFFFFFF    FFFFFFFF    5BD5    FFFFFFFF    FFFFFFFF\ncseg04  00000000    0000EFD0    ?   ?   ?   .   L   para    2789    public  CODE    16  FFFFFFFF    FFFFFFFF    5BD5    FFFFFFFF    FFFFFFFF\ncseg05  00000000    0000EFB0    ?   ?   ?   .   L   para    3686    public  CODE    16  FFFFFFFF    FFFFFFFF    5BD5    FFFFFFFF    FFFFFFFF\ncseg06  00000000    0000EFF0    ?   ?   ?   .   L   para    4581    public  CODE    16  FFFFFFFF    FFFFFFFF    5BD5    FFFFFFFF    FFFFFFFF\ncseg07  00000000    00007550    ?   ?   ?   .   L   para    5480    public  CODE    16  FFFFFFFF    FFFFFFFF    5BD5    FFFFFFFF    FFFFFFFF\ndseg08  00000000    0000A4D0    ?   ?   ?   .   L   para    5BD5    public  DATA    16  FFFFFFFF    FFFFFFFF    5BD5    FFFFFFFF    FFFFFFFF\nCOMMDLG 00000000    00000004    ?   ?   ?   .   L   para    6622    public      16  FFFFFFFF    FFFFFFFF    FFFFFFFF    FFFFFFFF    FFFFFFFF\nPZOHDLL 00000000    00000011    ?   ?   ?   .   L   para    6623    public      16  FFFFFFFF    FFFFFFFF    FFFFFFFF    FFFFFFFF    FFFFFFFF\nKERNEL  00000000    00000023    ?   ?   ?   .   L   para    6625    public      16  FFFFFFFF    FFFFFFFF    FFFFFFFF    FFFFFFFF    FFFFFFFF\nGDI 00000000    0000003D    ?   ?   ?   .   L   para    6628    public      16  FFFFFFFF    FFFFFFFF    FFFFFFFF    FFFFFFFF    FFFFFFFF\nUSER    00000000    0000006D    ?   ?   ?   .   L   para    662C    public      16  FFFFFFFF    FFFFFFFF    FFFFFFFF    FFFFFFFF    FFFFFFFF\nWIN87EM 00000000    00000001    ?   ?   ?   .   L   para    6633    public      16  FFFFFFFF    FFFFFFFF    FFFFFFFF    FFFFFFFF    FFFFFFFF\nCSD_LOGO    00000000    00000001    ?   ?   ?   .   L   para    6634    public      16  FFFFFFFF    FFFFFFFF    FFFFFFFF    FFFFFFFF    FFFFFFFF\nX1WIN   00000000    00000003    ?   ?   ?   .   L   para    6635    public      16  FFFFFFFF    FFFFFFFF    FFFFFFFF    FFFFFFFF    FFFFFFFF\n</code></pre>\n <p>\n  If I have stack traces/etc, return addresses, or data addresses in format : how can I match up the segment address to the segment name in IDA Pro.\n </p>\n <p>\n  For example when this module loaded LoadModule returned HINSTANCE of 0x28A7. .\nI have two addresses I wanted to find in IDA:\n </p>\n <ol>\n  <li>\n   28df:69ca\n  </li>\n  <li>\n   28e7:246c\n  </li>\n </ol>\n <p>\n  Now in this case I search IDA for the address i.e. 69ca and manually find the matching segment based on knowledge of what I expect to be executing at that point.\n </p>\n <p>\n  However wonder what approach can be used to easily translate the segment address without needing to search i.e. 0x28df = cseg01 and 0x28e7 = cseg02.\n </p>\n <p>\n  There is an option to rebase based on address of first segment, but that doesn't seem to change anything (or I'm not using it correctly)\n  <a href=\"https://i.sstatic.net/61ZZX.png\" rel=\"nofollow noreferrer\">\n   <img alt=\"enter image description here\" src=\"https://i.sstatic.net/61ZZX.png\"/>\n  </a>\n </p>\n</div>\n</body></html>",
    "votes": "1",
    "answers": 1,
    "views": "159",
    "tags": [
        "ida",
        "windows",
        "ne"
    ],
    "user": "chentiangemalc",
    "time": "Sep 14, 2022 at 3:14",
    "comments": [],
    "answers_data": [
        {
            "content": "<html><body><div class=\"s-prose js-post-body\" itemprop=\"text\">\n <p>\n  Rebase does not help you in this case, because rebasing is meant to shift virtual addresses in flat mode or physical addresses of real-mode programs, but it does not apply to selectors of segmented protected mode programs. It is very likely that all segments of your programs get selectors spaced 8 apart, so if you got worked out that 28df is cseg01, the relation that 28e7 is cseg02 is expected. Likely the 2917 is the selector for the data segment. If you get a register dump along with the back trace, possibly you find DS=2917 to help you find the selector values of the code segments.\n </p>\n</div>\n</body></html>",
            "votes": "1",
            "user": "Michael Karcher",
            "time": "Sep 17, 2022 at 11:44",
            "is_accepted": true,
            "comments": []
        }
    ]
}