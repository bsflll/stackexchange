{
    "title": "Problem to hook a parameter with _thiscall function",
    "link": "https://reverseengineering.stackexchange.com/questions/30652/problem-to-hook-a-parameter-with-thiscall-function",
    "content": "<html><body><div class=\"s-prose js-post-body\" itemprop=\"text\">\n <p>\n  I have hooked correctly many games using detours without problems but now I have a problem with this __thiscall function:\n </p>\n <pre><code>.text:00488DA0 ; =============== S U B R O U T I N E =======================================\n.text:00488DA0\n.text:00488DA0 ; Attributes: bp-based frame\n.text:00488DA0\n.text:00488DA0 ; int __stdcall sub_488DA0(int, int, int, char, int, float, float, float, int)\n.text:00488DA0 sub_488DA0      proc near               ; CODE XREF: sub_4853C0+53↑p\n.text:00488DA0                                         ; sub_489270+43↓p ...\n.text:00488DA0\n.text:00488DA0 var_8           = dword ptr -8\n.text:00488DA0 var_4           = dword ptr -4\n.text:00488DA0 arg_0           = dword ptr  8\n.text:00488DA0 arg_4           = dword ptr  0Ch\n.text:00488DA0 arg_8           = dword ptr  10h\n.text:00488DA0 arg_C           = byte ptr  14h\n.text:00488DA0 arg_10          = dword ptr  18h\n.text:00488DA0 arg_14          = dword ptr  1Ch\n.text:00488DA0 arg_18          = dword ptr  20h\n.text:00488DA0 arg_1C          = dword ptr  24h\n.text:00488DA0 arg_20          = dword ptr  28h\n.text:00488DA0\n.text:00488DA0                 push    ebp\n.text:00488DA1                 mov     ebp, esp\n.text:00488DA3                 sub     esp, 8\n.text:00488DA6                 push    ebx\n.text:00488DA7                 mov     ebx, dword ptr [ebp+arg_C]\n.text:00488DAA                 push    esi\n.text:00488DAB                 mov     esi, ecx\n.text:00488DAD                 mov     [ebp+var_4], esi\n.text:00488DB0                 cmp     ebx, 0FFFFFFFFh\n.text:00488DB3                 jl      short loc_488DBD\n.text:00488DB5                 cmp     ebx, 400h\n.text:00488DBB                 jl      short loc_488DD9\n.text:00488DBD\n.text:00488DBD loc_488DBD:                             ; CODE XREF: sub_488DA0+13↑j\n.text:00488DBD                 cmp     [ebp+arg_10], 7\n.text:00488DC1                 jz      short loc_488DD9\n.text:00488DC3                 push    ebx             ; char\n.text:00488DC4                 push    offset a1startsoundBad ; \"^1StartSound: bad edictnum %i\"\n.text:00488DC9                 call    sub_426A40\n.text:00488DCE                 add     esp, 8\n.text:00488DD1                 pop     esi\n.text:00488DD2                 pop     ebx\n.text:00488DD3                 mov     esp, ebp\n.text:00488DD5                 pop     ebp\n.text:00488DD6                 retn    24h\n.text:00488DD9 ; ---------------------------------------------------------------------------\n\n.text:00488E22 etc.....\n\n.text:00489261 loc_489261:                             ; CODE XREF: sub_488DA0+BA↑j\n.text:00489261                                         ; sub_488DA0+D5↑j ...\n.text:00489261                 pop     edi\n.text:00489262                 pop     esi\n.text:00489263                 pop     ebx\n.text:00489264                 mov     esp, ebp\n.text:00489266                 pop     ebp\n.text:00489267                 retn    24h\n.text:00489267 sub_488DA0      endp\n</code></pre>\n <p>\n  here IDA pseudocode:\n </p>\n <pre><code>void __thiscall sub_488DA0(char *this, int a2, int a3, int a4, int a5, int a6, float a7, float a8, float a9, int a10)\n</code></pre>\n <p>\n  here my code:\n </p>\n <pre><code>typedef void(__fastcall *HookFileWolfram) (char * pThis, void * EDX, int a2, int a3, int a4, int a5, int a6, float a7, float a8, float a9, int a10);\nvoid  __fastcall HookWeaponFileSubWolfram(char * pThis, void * EDX, int a2, int a3, int a4, int a5, int a6, float a7, float a8, float a9, int a10)\n{\n    HookFileWolfram originalFunction = (HookFileWolfram)AddressOfHookSoundFunction;\n\n    LF::Log_Update(\"Print values: pThis: \" + SC::To_String(pThis) + \" a2: \" + SC::To_String(a2));\n\n    return originalFunction(pThis,EDX,a2,a3,a4,a5,a6,a7,a8,a9,a10);\n}\n</code></pre>\n <p>\n  and here the output:\n </p>\n <pre><code>  18/07/2022 08:32:43.860  Print values: pThis: 2O/ a2: 1143863296\n  18/07/2022 08:32:42.420  Print values: pThis: G/ a2: 0\n</code></pre>\n <p>\n  I need to detect correctly the parameter pThis.\n </p>\n <p>\n  Can you please let me known a way to detect the pThis parameter ?\n </p>\n <p>\n  Thank you !\n </p>\n</div>\n</body></html>",
    "votes": "1",
    "answers": 0,
    "views": "121",
    "tags": [
        "ida",
        "c++",
        "function-hooking"
    ],
    "user": "user3449922",
    "time": "Jul 18, 2022 at 7:13",
    "comments": [],
    "answers_data": []
}