{
    "title": "Disassembled Java class file differs from Source",
    "link": "https://reverseengineering.stackexchange.com/questions/15479/disassembled-java-class-file-differs-from-source",
    "content": "<html><body><div class=\"s-prose js-post-body\" itemprop=\"text\">\n <p>\n  While trying to understand a behavior of TestNG I found my self disassembling the .class files. During that, I accidentally noticed that the official binary differs from the one built manually from source and from the source itself.\n </p>\n <p>\n  The reason I disassembled the binaries was just to prove that the binary really lacks local variable tables (and for fun), since I was unable inspecting local variables.\n </p>\n <ul>\n  <li>\n   Project:\n   <a href=\"https://github.com/cbeust/testng.git\" rel=\"nofollow noreferrer\">\n    https://github.com/cbeust/testng.git\n   </a>\n  </li>\n  <li>\n   Artifact Version / Tag: 6.11\n  </li>\n  <li>\n   Source File:\n   <a href=\"https://github.com/cbeust/testng/blob/6.11/src/main/java/org/testng/TestNG.java\" rel=\"nofollow noreferrer\">\n    <code>\n     TestNG.java\n    </code>\n   </a>\n   (Official Repository)\n  </li>\n  <li>\n   Class File:\n   <a href=\"https://repo.maven.apache.org/maven2/org/testng/testng/6.11/testng-6.11.jar\" rel=\"nofollow noreferrer\">\n    <code>\n     TestNG.class\n    </code>\n    in testng-6.11.jar\n   </a>\n   (repo.maven.apache.org)\n  </li>\n  <li>\n   Used JDK: OpenJDK 1.8.0 131\n  </li>\n </ul>\n <p>\n  I built the source from the project repository at Tag 6.11. using Gradle.\n </p>\n <p>\n  In the first place I inspected both using\n  <code>\n   javap -l -p TestNG.class\n  </code>\n  , writing the output into two separate files and diffing the resulting descriptions. So far so good.\n </p>\n <p>\n  Then, for fun, I disassembled both class files using these commands:\n </p>\n <pre><code>javap -c -p /tmp/TestNG.mvn.class > /tmp/TestNG.mvn.java\njavap -c -p /tmp/TestNG.mine.class > /tmp/TestNG.mine.java\n</code></pre>\n <p>\n  Then I diffed both and accidently found the private field\n  <code>\n   m_executionListeners\n  </code>\n  to be missing.\n </p>\n <pre><code>--- /tmp/TestNG.mvn.java      2017-06-03 23:12:16.005211337 +0200\n+++ /tmp/TestNG.mine.java     2017-06-03 23:12:08.245208191 +0200\n@@ -92,6 +92,8 @@\n\n   protected long m_start;\n\n+  private final java.util.Map<java.lang.Class<? extends org.testng.IExecutionListener>, org.testng.IExecutionListener> m_executionListeners;\n+\n</code></pre>\n <p>\n  (No, its declaration did not just move around, it's gone.)\n </p>\n <p>\n  So I thought it could be some kind of compiler optimization. But it is actually referenced and accessed two times. This is one access:\n </p>\n <pre><code>public void addListener(ITestNGListener listener) {\n   if (listener == null) {\n     return;\n   }\n   if (listener instanceof ISuiteListener) {\n     ISuiteListener suite = (ISuiteListener) listener;\n     maybeAddListener(m_suiteListeners, suite.getClass(),  suite);\n   }\n   // ...\n   if (listener instanceof IExecutionListener) {\n     IExecutionListener execution = (IExecutionListener) listener;\n     maybeAddListener(m_executionListeners, execution.getClass(), execution);\n   }\n   // ...\n }\n</code></pre>\n <p>\n  <a href=\"https://github.com/cbeust/testng/blob/6.11/src/main/java/org/testng/TestNG.java#L723\" rel=\"nofollow noreferrer\">\n   See the source\n  </a>\n </p>\n <p>\n  All other fields that run through the\n  <code>\n   instanceof\n  </code>\n  check, type cast and\n  <code>\n   maybeAddListener()\n  </code>\n  call are still present.\n </p>\n <p>\n  Am I right, with my conclusion, that the binary has not been built from the (supposed-to-be) related source? Or what it going on here?\n </p>\n</div>\n</body></html>",
    "votes": "2",
    "answers": 1,
    "views": "142",
    "tags": [
        "java",
        "bin-diffing"
    ],
    "user": "try-catch-finally",
    "time": "Jun 4, 2017 at 14:23",
    "comments": [],
    "answers_data": [
        {
            "content": "<html><body><div class=\"s-prose js-post-body\" itemprop=\"text\">\n <p>\n  You are correct that the binary does not match the tagged source. It does, however, match the changes made in commit\n  <a href=\"https://github.com/cbeust/testng/commit/6cfc6b4a403f8487d9fa96aa3d42db7848c8755a\" rel=\"noreferrer\">\n   6cfc6b4a403f8487d9fa96aa3d42db7848c8755a\n  </a>\n  , which was made on February 25, one day after the most recent commit tagged 6.11 and before the most recent merge commit in 6.11.\n </p>\n <p>\n  I can only speculate, but it seems likely that their local version of 6.11 includes an extra commit or two that they accidentally left out of the tag on Github.\n </p>\n</div>\n</body></html>",
            "votes": "4",
            "user": "Antimony",
            "time": "Jun 5, 2017 at 3:23",
            "is_accepted": true,
            "comments": []
        }
    ]
}