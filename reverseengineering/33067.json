{
    "title": "Extract flag from .exe file",
    "link": "https://reverseengineering.stackexchange.com/questions/33067/extract-flag-from-exe-file",
    "content": "<div class=\"s-prose js-post-body\" itemprop=\"text\">\n<p>I have to extract a flag from a test.exe file. The respective flag is run as an argument for the test.exe file =&gt; \"test.exe FlagName\" and in this way I will reach the next flag.</p>\n<p>I determined type of test.exe file:</p>\n<p>Base address: 00400000\nEntry point: 0041200a</p>\n<p>MSDOS</p>\n<pre><code>Operation system: MS-DOS[8086, 16-bit, EXE]\n</code></pre>\n<p>PE32</p>\n<pre><code>Operation system: Windows(95)[I386, 32-bit, Console]\nLinker: Microsoft Linker\nLanguage: C#\nLibrary: .NET(v4.0.30319)\nProtector: Confuser(1.X)\nProtection: Obfuscation(Heuristic)[Modified EP + Strange EP position + Strange sections + Anti-ILDASM + Ctrl flow + Watermark]\nProtection: Anti analysis(Heuristic)[Anti-dump]\nPacker: Packer detected(Heuristic)[Last section EP + Section 0 (\"Ih?|(0\") compressed]\n</code></pre>\n<p>IDA Interactive Disassembler, the only information</p>\n<p><a href=\"https://i.sstatic.net/1YvkAv3L.png\" rel=\"nofollow noreferrer\"><img alt=\"IDA Interactive Disassembler, the only information\" src=\"https://i.sstatic.net/1YvkAv3L.png\"/></a></p>\n<p>Output of Ghidra decompiler:</p>\n<p>void entry(void)</p>\n<p>{</p>\n<p>/* WARNING: Could not recover jumptable at 0x0041200a. Too many branches */</p>\n<p>/* WARNING: Treating indirect jump as call */</p>\n<p>_CorExeMain();</p>\n<p>return;</p>\n<p>}</p>\n<p>undefined __fastcall FUN_00405d00(undefined4 param_1,undefined2 param_2)</p>\n<p>{</p>\n<p>undefined uVar1;</p>\n<p>int in_EAX;</p>\n<p>byte in_CF;</p>\n<p>*(int *)(in_EAX + -0x2693f8e2) = *(int *)(in_EAX + -0x2693f8e2) + 0x6f + (uint)in_CF;</p>\n<p>uVar1 = in(param_2);</p>\n<p>return uVar1;</p>\n<p>}</p>\n<p>Output of Ghidra for each Ghidra decompiled function, assembly lines:</p>\n<pre><code>                         //\n                         // SECTION.4 \n                         // ram:00412000-ram:004121ff\n                         //\n                         **************************************************************\n                         *                POINTER to EXTERNAL FUNCTION                *\n                         **************************************************************\n                         undefined _CorExeMain()\n         undefined         AL:1           &lt;RETURN&gt;\n                         0  _CorExeMain  &lt;&lt;not bound&gt;&gt;\n                         PTR__CorExeMain_00412000                        XREF[3]:     00400158(*), 00400224(*), \n                                                                                      entry:0041200a  \n    00412000 90 88 00 00     addr       MSCOREE.DLL::_CorExeMain\n    00412004 00              ??         00h\n    00412005 00              ??         00h\n    00412006 00              ??         00h\n    00412007 00              ??         00h\n    00412008 00              ??         00h\n    00412009 00              ??         00h\n                         **************************************************************\n                         *                       THUNK FUNCTION                       *\n                         **************************************************************\n                         thunk undefined entry()\n                           Thunked-Function: MSCOREE.DLL::_CorExeMain\n         undefined         AL:1           &lt;RETURN&gt;\n                         entry                                           XREF[2]:     Entry Point(*), 004000a8(*)  \n    0041200a ff 25 00        JMP        dword ptr [-&gt;MSCOREE.DLL::_CorExeMain]\n             20 41 00\n    00412010 00 00 00        align      align(496)\n             00 00 00 \n             00 00 00 \n\n\n\n\n\n                         **************************************************************\n                         *                          FUNCTION                          *\n                         **************************************************************\n                         undefined __fastcall FUN_00405d00(undefined4 param_1, un\n         undefined         AL:1           &lt;RETURN&gt;\n         undefined4        ECX:4          param_1\n         undefined2        DX:2           param_2\n                         FUN_00405d00                                    XREF[1]:     Entry Point(*)  \n    00405d00 83 90 1e        ADC        dword ptr [EAX + 0xd96c071e],0x6f\n             07 6c d9 6f\n    00405d07 8e e4           MOV        FS,SP\n    00405d09 1f              POP        DS\n    00405d0a ec              IN         AL,param_2\n    00405d0b cb              RETF\n    00405d0c dc              ??         DCh\n    00405d0d 05              ??         05h\n    00405d0e a3              ??         A3h\n    00405d0f b0              ??         B0h\n</code></pre>\n<p>From what I understand, there are 2 options:</p>\n<ol>\n<li>Patching the program modifying Assembly code.</li>\n<li>Reversing the algorithm.</li>\n</ol>\n<p>In both situations I don't understand anything, I need help and solving the problem, to receive the 2nd flag. If it is possible, I would like the solution for both of the 2 options.</p>\n<p>Many thanks</p>\n</div>",
    "votes": "0",
    "answers": 0,
    "views": "162",
    "tags": [
        "assembly",
        "decompilation",
        "c++",
        "ghidra"
    ],
    "user": "RandomUser",
    "time": "Jul 8, 2024 at 9:25",
    "comments": [
        {
            "user": "Robert",
            "text": "<span class=\"comment-copy\">The output <code>Library: .NET(v4.0.30319)</code> may indicate that the binary contains .Net byte code. have you tried to load it in a Dot.Net decompiler like IlSpy? IDA and Ghidra may only recognize the native launcher and ignore the attached .Net byte code.</span>",
            "time": null
        },
        {
            "user": "RandomUser",
            "text": "<span class=\"comment-copy\">I tried DNsSPy and IlSpy, but the output is more confusing like the output of the Ghidra, as example:   internal class \\u200e\\u202c\\u202d\\u206e\\u200e\\u206c\\u200e\\u206c\\u200d\\u200b\\u206b\\u206f\\u206b\\u206e\\u202b   Maybe the code is protected by some \"obfuscated method\". Today I read about that, I saw my output :   Protector: Confuser(1.X) Protection: Obfuscation(Heuristic)[Modified EP + Strange EP position + Strange sections + Anti-ILDASM + Ctrl flow + Watermark]   So...now I am searching about a of how to revert \"obfuscated \" technique</span>",
            "time": null
        },
        {
            "user": "Виолетта",
            "text": "<span class=\"comment-copy\">give link to exe file, you neeed try use x64dbg, and try dump, use ScyllaHide</span>",
            "time": null
        }
    ],
    "answers_data": []
}