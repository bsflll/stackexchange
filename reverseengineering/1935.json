{
    "title": "How to handle stripped binaries with GDB? No source, no symbols and GDB only shows addresses?",
    "link": "https://reverseengineering.stackexchange.com/questions/1935/how-to-handle-stripped-binaries-with-gdb-no-source-no-symbols-and-gdb-only-sho",
    "content": "<div class=\"s-prose js-post-body\" itemprop=\"text\">\n<p>I have GDB but the binary I want to reverse engineer dynamically has no symbols. That is, when I run the <a href=\"https://www.man7.org/linux/man-pages/man1/file.1.html\" rel=\"nofollow noreferrer\"><code>file</code></a> utility it shows me <strong>stripped</strong>:</p>\n<pre><code>ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.18, stripped\n</code></pre>\n<p>What options do I have if the environment in which this runs doesn't allow a remote IDA Pro instance to connect to <code>gdbserver</code>? In short: the environment you have is limited in what it allows you to do, but you do have trusty old <code>gdb</code> and a binary to reverse engineer.</p>\n</div>",
    "votes": "123",
    "answers": 2,
    "views": "101k",
    "tags": [
        "tools",
        "dynamic-analysis",
        "linux",
        "debuggers",
        "gdb"
    ],
    "user": "0xC0000022L",
    "time": "May 4, 2023 at 11:56",
    "comments": [
        {
            "user": "Mellowcandle",
            "text": "<span class=\"comment-copy\">unstrip is a tool that can try to restore lost symbol names of known library calls.</span>",
            "time": null
        },
        {
            "user": "Jichao",
            "text": "<span class=\"comment-copy\"><code>b __libc_start_main</code></span>",
            "time": null
        },
        {
            "user": "0xC0000022L",
            "text": "<span class=\"comment-copy\">@Jichao doesn't that make the assumption that 1.) a specific implementation of a C runtime is being used and b.) that the binary isn't statically linked? Perhaps I am missing something here. But if I recall correctly no symbols are required for an ELF to find its entry point at load time.</span>",
            "time": null
        }
    ],
    "answers_data": [
        {
            "content": "<div class=\"s-prose js-post-body\" itemprop=\"text\">\n<h1>Conventions used plus preliminary remarks</h1>\n<p>I am trimming the output of GDB for brevity since it usually shows the copyright and other information at the beginning of every session (use <code>-q</code> to suppress). When I reproduce the output I'll start at the first <code>(gdb)</code> prompt line, or in case or auto-executed commands from the first genuine output line.</p>\n<p>In order to distinguish commands entered at the GDB prompt, these will have a leading <code>(gdb) </code> just like in the real world. For shell command this will either be no prefix at all or <code>$ </code> as it appears to be the convention on most unixoid systems.</p>\n<p>When I use a particular command, such as <code>vim</code> as my editor, you are free to use your own favorite editor of course. Be it <a href=\"http://xkcd.com/378/\" rel=\"noreferrer\"><code>emacs</code></a> or <code>nano</code>, I won't judge ya ;)</p>\n<h1>Getting started</h1>\n<p>This section is about setting up your <code>gdb</code> environment and starting the process. I'll also include a few tidbits for the complete newcomers.</p>\n<h2>Tricks you should know</h2>\n<p>GDB has a nice prompt at which your cursor will stop after the program breaks or whenever you are stepping or some such.</p>\n<ul>\n<li>Pressing <kbd>RETURN</kbd> (aka <kbd>ENTER</kbd>) after you ran a GDB command will run the same command again. This is useful when you are stepping through code with <code>step</code> or <code>next</code> and simply want to continue one by one.</li>\n<li>Commands can be abbreviated as long as they are unambiguous. For some oft used commands a particular shorthand exists that takes precedence despite ambiguity:\n<ul>\n<li><code>b</code> for <code>break</code> (despite <code>bt</code> and <code>backtrace</code>)</li>\n<li><code>c</code> or <code>cont</code> for <code>continue</code> (despite <code>catch</code>, <code>call</code> and so on)</li>\n<li><code>n</code> for <code>next</code> (despite <code>ni</code> and <code>nexti</code>)</li>\n</ul>\n</li>\n<li>You can call actual library functions or even functions from within the debugged program using the command <code>call</code>. This means you can try out behavior or force behavior.</li>\n<li>You can start GDB with <code>gdbtui</code> or <code>gdb -tui</code> to get a - supposedly more convenient - more visual text user interface. It shows the source code at the top and the <code>(gdb)</code> prompt below. You can also switch to this layout by executing the command <code>layout src</code> at the <code>(gdb)</code> prompt.</li>\n<li>GDB has a command line completion feature much like many shells, so use <kbd>Tab</kbd> to your advantage and also make sure to use <code>help</code> or <code>help [keyword|command]</code> whenever you are in need of help.</li>\n<li><code>shell</code> allows you to execute commands in the shell, so that you can run commands from within your GDB session. During development an example would be <code>shell make</code>.</li>\n<li><code>print</code>, <code>examine</code> and <code>display</code> know various formats (<code>/FMT</code>) which you can use to make the output more readable.</li>\n<li>When source-level debugging you can use C type casts to display values. Imagine a C string behind a <code>void *</code> (which GDB knows thanks to the symbols in such case). Simply cast to <code>(char*)</code> and print it: <code>print (char*)variable</code>.</li>\n</ul>\n<h2>Getting the process to run</h2>\n<p>Since we want to dynamically analyze the binary, we need to start it first.</p>\n<h3>Command line</h3>\n<p>We can do that straight from the command line by passing not only the path to the binary, but also the arguments we want to start it with. The whole process then looks like this:</p>\n<pre><code>$ gdb --args ./exe argument1 argument2\n</code></pre>\n<p>Easy enough. From the <code>(gdb)</code> prompt you can then issue the <code>run</code> command (shorthand <code>r</code>) to run <code>./exe</code> with the parameters given on the command line. I prefer this method, but your mileage may vary.</p>\n<p><img alt=\"Starting a process using the described method\" src=\"https://i.sstatic.net/1IOfY.png\"/></p>\n<h3>GDB prompt</h3>\n<p>Fire up GDB and at the <code>(gdb)</code> prompt use the <code>file</code> command to load the binary and then use the <code>run</code> command to start it with the arguments you want to pass:</p>\n<pre><code>$ gdb\n(gdb) file exe\n(gdb) run argument1 argument2\n</code></pre>\n<p>an alternative to the above would be the use of <code>set args</code> like this:</p>\n<pre><code>$ gdb\n(gdb) file exe\n(gdb) set args argument1 argument2\n(gdb) run\n</code></pre>\n<p><img alt=\"Starting a process using the described method\" src=\"https://i.sstatic.net/GVG6G.png\"/></p>\n<p>You can also see in any case which arguments <code>run</code> would pass to the started process by issuing a:</p>\n<pre><code>(gdb) show args\n</code></pre>\n<p>btw: if you were wondering about environment variables, use GDB's built-in <code>help</code> command as <code>help set</code> and <code>help show</code>. Pointers: <code>set environment VARNAME=VALUE</code> and <code>show environment [VARNAME]</code> and <code>unset environment VARNAME</code>.</p>\n<h2>Phew, but why does the program stop with a <code>SIGSEGV</code> (segment fault)?</h2>\n<p>Well, we don't know yet, but it looks like this little beasty wants <strong>the proper treatment</strong>. Since we practice defensive computing, we don't want to run anything we don't know much about, right? So let's start over. If this would have been malware we'd have to flush the machine and reinstall or restore a snapshot if it's a VM guest.</p>\n<p>First we'll want to run the <code>info</code> command as follows:</p>\n<pre><code>(gdb) info file\n</code></pre>\n<p>Observe:</p>\n<p><img alt=\"info file command in GDB\" src=\"https://i.sstatic.net/4VTkn.png\"/></p>\n<p>There are two important pieces of information, the most relevant for us being the line stating:</p>\n<pre><code>Entry point: 0x400710\n</code></pre>\n<p>alright, so we can set a break point on that one and then <code>run</code> the process with the arguments we fancy.</p>\n<h2><code>.gdbinit</code> for the win</h2>\n<p>But wait, this is getting tedious already. No easy method to automate these steps in some way? As a matter of fact there is. A file named <code>.gdbinit</code> can be used to issue commands to GDB upon startup. You can also pass a file with GDB commands using the <code>-x</code> argument on the (shell) command line. If I have a number of projects, usually they are in subfolders with a <code>.gdbinit</code> file each.</p>\n<p><strong>Side-note:</strong> <code>-nx</code> prevents the <code>.gdbinit</code> contents from being executed upon startup.</p>\n<p>So we know which arguments we want to pass and we know the address of the break point, this translates to the following <code>.gdbinit</code> file:</p>\n<pre><code>file exe\nbreak *0x400710\nrun argument1 argument2\n</code></pre>\n<p>The output I get when I start <code>gdb</code> without any other arguments is:</p>\n<pre><code>Breakpoint 1 at 0x400710\n\nBreakpoint 1, 0x0000000000400710 in ?? ()\n(gdb) \n</code></pre>\n<p>Nice! But this looks different ...</p>\n<h1>Assembly and GDB</h1>\n<p>So you're used to see the next line you're going to execute and then your trusty old <code>(gdb)</code> prompt. But no such thing. We have no source for this binary and furthermore symbols. Doh! So we contemplate the blinking caret at the <code>(gdb)</code> prompt and wonder what to do. Don't fret, GDB can also handle assembly code. Only problem, it defaults to the - in my opinion - inconvenient AT&amp;T assembly syntax. I prefer the Intel flavor and the following command tells GDB to do just that:</p>\n<pre><code>(gdb) set disassembly-flavor intel\n</code></pre>\n<h2>Showings the assembly code</h2>\n<p>And how is it going to show us the assembly code? Well, similar to the TUI mode (check the tag wiki for <a aria-label=\"show questions tagged 'gdb'\" aria-labelledby=\"gdb-container\" class=\"post-tag\" href=\"/questions/tagged/gdb\" rel=\"tag\" title=\"show questions tagged 'gdb'\">gdb</a>) by using the following command:</p>\n<pre><code>(gdb) layout asm\n</code></pre>\n<p>and if you are so inclined, also:</p>\n<pre><code>(gdb) layout regs\n</code></pre>\n<p>which will also show you the contents of the registers in an overview.</p>\n<h2>Let's run it again</h2>\n<p>So we end up with the following <code>.gdbinit</code> for our purposes:</p>\n<pre><code>file exe\nbreak *0x400710\nset disassembly-flavor intel\nlayout asm\nlayout regs\nrun argument1 argument2\n</code></pre>\n<p>And when we start <code>gdb</code> without arguments we end up with this:</p>\n<p><img alt=\"GDB with asm and regs layout\" src=\"https://i.sstatic.net/nrirU.png\"/></p>\n<p>Sweet. So we can see the disassembly while we step through the code. We could conclude this here, but of course there are more tricks to be learned, so why not go a little further.</p>\n<p><strong>NOTE:</strong> the registers with white/gray background show that a value has changed. Not too meaningful when we just started the program, but mighty useful when stepping through code later on.</p>\n<h3>btw, if you prefer to save screen estate</h3>\n<p>... and have it less visual, starting with GDB 7.0 you can use:</p>\n<pre><code>set disassemble-next-line on\n</code></pre>\n<p>on GDB versions before that you can emulate the behavior by settings an <a href=\"http://sourceware.org/gdb/current/onlinedocs/gdb/Auto-Display.html#Auto-Display\" rel=\"noreferrer\">automatic <code>display</code></a>:</p>\n<pre><code>display/i $pc\n</code></pre>\n<p>or shorter <code>disp/i $pc</code> where <code>/i</code> is the format, you can remember it best by thinking \"instruction\" and <code>$pc</code> being the instruction pointer, also known as program counter - hence <code>pc</code>.</p>\n<h3>Also good to know</h3>\n<p>Sometimes when stepping through assembly the <code>regs</code> and <code>asm</code> views will get borked. Simply execute the respective <code>layout</code> commands again to restore them to their old glory:</p>\n<pre><code>(gdb) layout asm\n(gdb) layout regs\n</code></pre>\n<h1>\"Debugging\" at assembly level</h1>\n<p>Turns out when you are in assembly mode some of the commands you are used to from source-level debugging simply won't work. That makes sense, because a single source line means usually a dozen instructions or more. The <code>next</code> and <code>step</code> commands, however, have <a href=\"http://sourceware.org/gdb/onlinedocs/gdb/Continuing-and-Stepping.html\" rel=\"noreferrer\">instruction-level counterparts</a>:</p>\n<ul>\n<li><code>nexti</code> (shorthand <code>ni</code> ... anyone else thinking of shrubbery?)</li>\n<li><code>stepi</code> (shorthand <code>si</code>)</li>\n</ul>\n<p>From our disassembly above we know:</p>\n<pre><code>0x40072d        mov    rdi,0x40f961\n</code></pre>\n<p>and for all practical purposes this is the <code>main</code> function. Of course if you were to reverse engineer malware you should be more careful, but in this case it is. So let's add a breakpoint to this address (<code>0x40f961</code>) instead of the entry point:</p>\n<pre><code>break *0x40f961\n</code></pre>\n<p>If we <code>examine</code> (shorthand <code>x</code>) the code at which we are currently, we can see:</p>\n<pre><code>(gdb) x/5i $pc\nx/5i $pc\n=&gt; 0x40f961:    push   rbp\n   0x40f962:    mov    rbp,rsp\n   0x40f965:    mov    eax,0x0\n   0x40f96a:    call   0x40911f\n   0x40f96f:    pop    rbp\n</code></pre>\n<p>Okay, the <code>call</code> is what we want to follow, so let's step inside of it using <code>si</code>. We get to see another <code>call</code> immediately at the instruction pointer when entering the function:</p>\n<pre><code>(gdb) x/5i $pc\nx/5i $pc\n=&gt; 0x40911f:    call   0x400b8c\n   0x409124:    push   rbp\n   0x409125:    mov    rbp,rsp\n   0x409128:    push   r10\n   0x40912a:    push   r11\n</code></pre>\n<p>The <code>call</code> leads us to a function which calls <a href=\"http://linux.die.net/man/2/ptrace\" rel=\"noreferrer\"><code>ptrace(PTRACE_TRACEME, ...)</code></a>, now why would it do that?</p>\n<pre><code>0x400bab        call   0x4006b8 &lt;ptrace@plt&gt;\n</code></pre>\n<p>Well, it's an old anti-debugger trick which Mellowcandle has described in another Q&amp;A here:</p>\n<ul>\n<li><a href=\"https://reverseengineering.stackexchange.com/questions/1930/detecting-tracing-in-linux\">Detecting tracing in Linux</a></li>\n</ul>\n<p>But how do we get around it? We'd have to overwrite the <code>call</code> to the function which calls <code>ptrace()</code> with <code>nop</code> or something along those lines.</p>\n<p>This is where GDB becomes a little unwieldy. But we can use <code>set</code> so do the magic for us. Let's first inspect the instruction bytes:</p>\n<pre><code>(gdb) x/10b $pc\nx/10b $pc\n0x40911f:       0xe8    0x68    0x7a    0xff    0xff    0x55    0x48    0x89\n0x409127:       0xe5    0x41\n</code></pre>\n<p>The <code>0xe8</code> is a call instruction and we know now that it is 5 bytes long. So let's <code>nop</code> this out. (<code>x/10b $pc</code> means examine 10 bytes at program counter - default format is hex already).</p>\n<p>So we do while stopped at <code>0x40911f</code>:</p>\n<pre><code>(gdb) set write\n(gdb) set {unsigned int}$pc = 0x90909090\n(gdb) set {unsigned char}($pc+4) = 0x90\n(gdb) set write off\n</code></pre>\n<p>and verify the patched location:</p>\n<pre><code>(gdb) x/10i $pc\nx/10i $pc\n=&gt; 0x40911f:    nop\n   0x409120:    nop\n   0x409121:    nop\n   0x409122:    nop\n   0x409123:    nop\n   0x409124:    push   rbp\n   0x409125:    mov    rbp,rsp\n   0x409128:    push   r10\n   0x40912a:    push   r11\n   0x40912c:    push   rbx\n</code></pre>\n<p>Excellent. We can now execute it.</p>\n<h2>Alternatives to the given method</h2>\n<ol>\n<li>alternative for patching: <code>set {unsigned int}0x40911f = 0x90909090</code> followed by <code>set {unsigned char}0x409123 = 0x90</code></li>\n<li>Manipulate the program counter (instruction pointer) instead:</li>\n</ol>\n<ul>\n<li><code>set $pc+=5</code> or the more explicit <code>set $pc=$pc+5</code></li>\n<li><code>jump *$pc+5</code></li>\n</ul>\n<h2>Better ways yet to manipulate/patch the running program</h2>\n<p>There are alternative (and way superior) methods like <a href=\"http://my.opera.com/taviso/blog/show.dml/248232\" rel=\"noreferrer\">this one by Tavis Ormandy</a>. I'm reproducing the <code>assemble</code> macro below (in case it goes offline from the other place):</p>\n<pre><code>define assemble\n # dont enter routine again if user hits enter\n dont-repeat\n if ($argc)\n  if (*$arg0 = *$arg0)\n    # check if we have a valid address by dereferencing it,\n    # if we havnt, this will cause the routine to exit.\n  end\n  printf \"Instructions will be written to %#x.\\n\", $arg0\n else\n  printf \"Instructions will be written to stdout.\\n\"\n end\n printf \"Type instructions, one per line.\\n\"\n printf \"End with a line saying just \\\"end\\\".\\n\"\n if ($argc)\n  # argument specified, assemble instructions into memory\n  # at address specified.\n  shell nasm -f bin -o /dev/stdout /dev/stdin \\\n    &lt;&lt;&lt; \"$( echo \"BITS 32\"; while read -ep '&gt;' r &amp;&amp; test \"$r\" != end; \\\n                do echo -E \"$r\"; done )\" | hexdump -ve \\\n        '1/1 \"set *((unsigned char *) $arg0 + %#2_ax) = %#02x\\n\"' \\\n            &gt; ~/.gdbassemble\n  # load the file containing set instructions\n  source ~/.gdbassemble\n  # all done.\n  shell rm -f ~/.gdbassemble\n else\n  # no argument, assemble instructions to stdout\n  shell nasm -f bin -o /dev/stdout /dev/stdin \\\n    &lt;&lt;&lt; \"$( echo \"BITS 32\"; while read -ep '&gt;' r &amp;&amp; test \"$r\" != end; \\\n                do echo -E \"$r\"; done )\" | ndisasm -i -b32 /dev/stdin\n end\nend\ndocument assemble\nAssemble instructions using nasm.\nType a line containing \"end\" to indicate the end.\nIf an address is specified, insert instructions at that address.\nIf no address is specified, assembled instructions are printed to stdout.\nUse the pseudo instruction \"org ADDR\" to set the base address.\nend\n</code></pre>\n<p>Again the above script snippet wasn't written by me, but by Tavis Ormandy - see the link above.</p>\n<p>This concludes this little Q&amp;A.</p>\n</div>",
            "votes": "197",
            "user": "0xC0000022L",
            "time": "Jan 29, 2023 at 20:50",
            "is_accepted": true,
            "comments": [
                {
                    "user": "0xea",
                    "text": "<span class=\"comment-copy\">great writeup! just one note: -q as a cmd arg gets rid of the copyright stuff</span>",
                    "time": null
                },
                {
                    "user": "perror",
                    "text": "<span class=\"comment-copy\">I though I knew <code>gdb</code> pretty well, but I learned a lot. Thanks !</span>",
                    "time": null
                },
                {
                    "user": "Hackndo",
                    "text": "<span class=\"comment-copy\">This <b>AWESOME</b> answer saved my life more than once. Thank you, and thanks again.</span>",
                    "time": null
                },
                {
                    "user": "RichieHH",
                    "text": "<span class=\"comment-copy\">Best gdb intro I have seen.. Excellent.</span>",
                    "time": null
                },
                {
                    "user": "ramrunner",
                    "text": "<span class=\"comment-copy\">Oh, what sad times are these when passing ruffians can say ni at will to old debuggers...(seriously great answer though! XD)</span>",
                    "time": null
                }
            ]
        },
        {
            "content": "<div class=\"s-prose js-post-body\" itemprop=\"text\">\n<p>I used to use <a href=\"https://github.com/gdbinit/Gdbinit\" rel=\"nofollow noreferrer\">https://github.com/gdbinit/Gdbinit</a> for tuning GDB but it's getting a bit dated, so I'd recommend <a href=\"https://github.com/hugsy/gef\" rel=\"nofollow noreferrer\">https://github.com/hugsy/gef</a> now as a modern alternative.</p>\n</div>",
            "votes": "2",
            "user": "Mega Tonnage",
            "time": "Jan 30, 2023 at 9:45",
            "is_accepted": false,
            "comments": []
        }
    ]
}