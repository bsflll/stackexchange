{
    "title": "How to disassemble SPC572L assembler code?",
    "link": "https://reverseengineering.stackexchange.com/questions/31288/how-to-disassemble-spc572l-assembler-code",
    "content": "<div class=\"s-prose js-post-body\" itemprop=\"text\">\n<p>I have a binary file with code for the SPC572L64 processor from ST.</p>\n<p>The Datasheet can be downloaded <a href=\"https://www.st.com/content/ccc/resource/technical/document/reference_manual/d4/c7/37/2b/3b/f9/42/0e/DM00180298.pdf/files/DM00180298.pdf/jcr:content/translations/en.DM00180298.pdf\" rel=\"nofollow noreferrer\">here</a> and the Programmers Manual <a href=\"https://www.st.com/content/ccc/resource/technical/document/reference_manual/8b/6f/4e/d6/72/82/45/78/CD00164807.pdf/files/CD00164807.pdf/jcr:content/translations/en.CD00164807.pdf\" rel=\"nofollow noreferrer\">here</a>. All documents for this processor are listed <a href=\"https://www.st.com/content/st_com/en/search.html#q=SPC572L-t=resources-page=1\" rel=\"nofollow noreferrer\">here</a>.</p>\n<p>The documents say:</p>\n<ul>\n<li>One main 32-bit Power ArchitectureÂ® VLE\nCompliant CPU core, single issue</li>\n<li>There is one e200z215An3 processor core on the SPC572Lx device.</li>\n<li>The e200z215An3 is a single-issue 32-bit PowerISA 2.06 VLE compliant design with 32-bit\ngeneral-purpose registers (GPRs). The e200z215An3 core implements the VLE (variable-\nlength encoding) ISA, providing improved code density.</li>\n<li>Instruction set enhancement allowing variable length encoding (VLE), encoding a\nmix of 16-bit and 32-bit instructions, for code size footprint reduction.</li>\n</ul>\n<p>Wikipedia says:</p>\n<ul>\n<li>Power ISA is an evolution of the PowerPC ISA, created by the mergers of the core PowerPC ISA and the optional Book E for embedded applications.</li>\n</ul>\n<p>All this confuses me more than it helps.</p>\n<p>I tried to disassemble the code with Ghidra trying all PowerPC options. But what comes out is garbage. Every few lines a \"??\" appears instead of valid code:</p>\n<pre><code>    0108003c 73 e0 e0 00     andi.      r0,r31,0xe000\n    01080040 70 68 e0 00     andi.      r8,r3,0xe000\n    01080044 18              ??         18h\n    01080045 63              ??         63h    c\n    01080046 d1 a0 70 80     stfs       f13,0x7080(0)\n    0108004a 00              ??         00h\n    0108004b bf              ??         BFh\n    0108004c 7c 89 03 a6     mtspr      CTR,r4\n    01080050 1a              ??         1Ah\n    01080051 03              ??         03h\n    01080052 09 00 1c 63     tdgti      r0,0x1c63\n    01080056 00              ??         00h\n    01080057 40              ??         40h    @\n    01080058 7a              ??         7Ah    z\n    01080059 20              ??         20h     \n    0108005a ff              ??         FFh\n    0108005b f8              ??         F8h\n    0108005c 70 68 e0 00     andi.      r8,r3,0xe000\n    01080060 70 79 c7 c0     andi.      r25,r3,0xc7c0\n    01080064 48 c4 7c 89     bl         SUB_01cc7cec\n</code></pre>\n<p>And the decompiler outputs:</p>\n<pre><code>void UndefinedFunction_01080000(void)\n{\n  /* WARNING: Bad instruction - Truncating control flow here */\n  halt_baddata();\n}\n</code></pre>\n<p>Can anybody give me a step by step instruction what settings I need to disassemble this processor?</p>\n</div>",
    "votes": "4",
    "answers": 1,
    "views": "376",
    "tags": [
        "assembler"
    ],
    "user": "Elmue",
    "time": "Dec 22, 2022 at 16:19",
    "comments": [],
    "answers_data": [
        {
            "content": "<div class=\"s-prose js-post-body\" itemprop=\"text\">\n<p>Based on the <a href=\"https://github.com/NationalSecurityAgency/ghidra/issues/127\" rel=\"nofollow noreferrer\">link</a> provided by rce, Ghidra needs extra help to disassemble this code correctly.</p>\n<p>I select Language = \"PowerISA-VLE-64-32addr\" in the Ghidra project editor: Then to start the disassembly it will <strong>ONLY</strong> work by pressing the F12 key:</p>\n<p><a href=\"https://i.sstatic.net/71biA.png\" rel=\"nofollow noreferrer\"><img alt=\"Ghidra PowerPC VLE code\" src=\"https://i.sstatic.net/71biA.png\"/></a></p>\n<p>Also with <strong>IDA pro 7.5</strong> I can disassemble my binary file. IDA pro has only two options for PowerPC: Big endian and Little endian. I selected Big Endian. When loading I chose that all the code is VLE and I get a successful disassembly:</p>\n<p><a href=\"https://i.sstatic.net/kiRV0.png\" rel=\"nofollow noreferrer\"><img alt=\"IDA pro disassembly of PowerPC VLE code\" src=\"https://i.sstatic.net/kiRV0.png\"/></a></p>\n<p>After loading the file you must press \"C\" to start the disassembly which is done very fast.</p>\n<p>To see also the hex bytes (blue) in the disassembly you must edit the file <strong>ida.cfg</strong> and set</p>\n<p>OPCODE_BYTES            = 4</p>\n<p>because these bytes are disabled by default.</p>\n</div>",
            "votes": "5",
            "user": "Elmue",
            "time": "Jan 16, 2023 at 0:48",
            "is_accepted": true,
            "comments": []
        }
    ]
}