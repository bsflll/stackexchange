{
    "title": "Reverse engineer checksum algorithm",
    "link": "https://reverseengineering.stackexchange.com/questions/12592/reverse-engineer-checksum-algorithm",
    "content": "<div class=\"s-prose js-post-body\" itemprop=\"text\">\n<p>I am trying to reverse-engineer the protocol used between my Air-conditioner and the wired control unit on my wall.  (In order to have my home automation be able to monitor and control the A/C.)</p>\n<p>The electrical interface is simple open-collector bus with either end sending bytes using 100-baud UART timing (very slow, probably to tolerate electrical noise on this un-balanced bus).</p>\n<p>I have captured communication between the two ends, and found that they always send 13-byte packets, of which the last byte seems to be some sort of checksum.  I am confident that I can figure out where in the 12-byte payload to find the temperature setpoint, on/off bits, etc.  However, I cannot figure out how the checksum is calculated, and if I do not get that right, then I will not be able to inject commands to the A/C unit (other than re-playing known commands, which could work, but would not give me the satisfaction of complete reverse engineering.)</p>\n<p>Below, I have copied the packets that I have captured so far.  It is clear that the checksum is not a CRC, since often one bit flip in the data results in only one or a few adjacent bits in the checksum being flipped.</p>\n<p>Studying how the checksum changes as the 8th byte is incremented reveals a clear pattern of differences: -1 +3 -1 -5 -1 +3 -1 -21 -1 +3 -1 -5 -1...\nThe above sequence is part of what is generated by the formula y = (x &amp; 0xAA) - (x &amp; 0x55), so I think that it would somehow form part of the checksum algorithm.</p>\n<p>I have not been able to figure out how overall to mix together the input bytes, though, which is why I ask the expert reverse engineers in this forum.  Any observations are welcome, even if not a complete solution.</p>\n<p>The air conditioner is Friedrich M09CJ, and the wall mounted \"thermostat\" DWC1 can interface with a number of other Friedrich air conditioners, so it is a reasonable guess that those would also use the same protocol.</p>\n<blockquote>\n<p>The line numbers have been added later and do not belong to the data.</p>\n</blockquote>\n<pre><code>   1        A8 00 00 00 00 00 09 17 00 00 00 00 9D\n   2        A8 00 00 00 00 00 09 18 00 00 00 00 9C\n   3        A8 00 00 00 00 00 09 19 00 00 00 00 9F\n   4        A8 00 00 00 00 00 09 1A 00 00 00 00 9E\n   5        A8 00 00 00 00 00 09 1B 00 00 00 00 99\n   6        A8 00 00 00 00 00 09 1C 00 00 00 00 98\n   7        A8 00 00 00 00 00 09 1D 00 00 00 00 9B\n   8        A8 00 00 00 00 00 09 1E 00 00 00 00 9A\n   9        A8 00 00 00 00 00 09 1F 00 00 00 00 85\n  10        A8 00 00 00 00 00 09 20 00 00 00 00 84\n  11        A8 00 00 00 00 00 09 20 00 00 40 00 44\n  12        A8 00 00 00 00 00 09 21 00 00 00 00 87\n  13        A8 00 00 00 00 00 09 22 00 00 00 00 86\n  14        A8 00 00 00 00 00 09 23 00 00 00 00 81\n  15        A8 00 00 00 00 00 09 23 00 00 40 00 41\n  16        A8 00 00 00 00 00 09 24 00 00 00 00 80\n  17        A8 01 00 00 00 00 09 23 40 00 80 00 C0\n  18        A8 01 00 00 00 00 09 24 40 00 80 00 C3\n  19        A8 02 00 00 00 00 09 1E 00 00 00 00 84\n  20        A8 02 00 00 00 00 09 20 00 00 00 00 86\n  21        A8 02 00 00 00 04 05 1E 00 00 00 00 84\n  22        A8 02 00 00 00 04 07 1F 00 00 00 00 81\n  23        A8 02 00 00 00 04 09 1F 00 00 00 00 83\n  24        A8 02 00 00 00 04 09 20 00 00 00 00 82\n  25        A8 02 00 00 00 04 0A 20 00 00 00 00 8D\n  26        A8 02 00 00 00 04 0E 1F 00 00 00 00 8E\n  27        A8 02 00 00 00 04 0E 20 00 00 00 00 89\n  28        A8 03 00 00 00 00 09 20 00 00 00 00 81\n  29        A8 03 00 00 00 00 0A 20 00 00 00 00 80\n  30        A8 03 00 00 00 00 0B 20 00 00 00 00 83\n  31        A8 41 00 00 00 00 01 00 40 00 80 00 FF\n  32        A8 41 00 00 00 00 01 1F 40 00 80 00 9C\n  33        A8 42 00 00 00 00 09 1F 00 00 00 00 47\n  34        A8 60 40 00 00 00 09 1F 00 00 00 00 25\n  35        A8 60 40 00 00 00 09 20 00 00 00 00 24\n  36        A8 60 40 00 00 00 09 21 00 00 00 00 27\n  37        A8 60 40 00 00 00 09 22 00 00 00 00 26\n  38        A8 60 40 00 00 00 09 23 00 00 00 00 21\n  39        A8 62 00 00 00 00 09 1F 00 00 00 00 67\n  40        A8 62 00 00 00 00 09 20 00 00 00 00 66\n  41        A8 62 40 00 00 00 09 20 00 00 00 00 26\n  42        A8 62 40 00 00 00 09 21 00 00 00 00 21\n  43        A8 62 40 00 00 04 09 1D 00 00 00 00 21\n  44        A8 62 40 00 00 04 09 1E 00 00 00 00 20\n  45        A8 62 40 00 00 04 09 1F 00 00 00 00 23\n  46        A8 62 40 00 00 04 09 20 00 00 00 00 22\n  47        A8 62 40 00 00 04 09 21 00 00 00 00 2D\n  48        C8 00 00 00 00 00 09 17 00 00 00 00 BD\n  49        C8 00 00 00 00 00 09 18 00 00 00 00 BC\n  50        C8 00 00 00 00 00 09 19 00 00 00 00 BF\n  51        C8 00 00 00 00 00 09 1A 00 00 00 00 BE\n  52        C8 00 00 00 00 00 09 1B 00 00 00 00 B9\n  53        C8 00 00 00 00 00 09 1D 00 00 00 00 BB\n  54        C8 00 00 00 00 00 09 1E 00 00 00 00 BA\n  55        C8 00 00 00 00 00 09 1F 00 00 00 00 A5\n  56        C8 00 00 00 00 00 09 20 00 00 00 00 A4\n  57        C8 00 00 00 00 00 09 21 00 00 00 00 A7\n  58        C8 00 00 00 00 00 09 21 00 00 40 00 67\n  59        C8 00 00 00 00 00 09 22 00 00 00 00 A6\n  60        C8 00 00 00 00 00 09 22 00 00 40 00 66\n  61        C8 02 00 00 00 00 09 21 00 00 00 00 A1\n  62        C8 02 00 00 00 04 09 20 00 00 00 00 A2\n  63        C8 03 00 00 00 00 09 20 00 00 00 00 A1\n  64        C8 03 00 00 00 00 09 21 00 00 00 00 A0\n  65        C8 03 00 00 00 00 09 22 00 00 00 00 A3\n  66        C8 03 00 00 00 00 0A 20 00 00 00 00 A0\n  67        C8 03 00 00 00 00 0A 21 00 00 00 00 A3\n  68        C8 03 00 00 00 00 0A 22 00 00 00 00 A2\n  69        C8 03 00 00 00 00 0C 20 00 00 00 00 A2\n  70        C8 03 00 00 00 00 0C 21 00 00 00 00 AD\n  71        C8 03 00 00 00 00 0D 21 00 00 00 00 AC\n  72        C8 03 00 00 00 00 0E 21 00 00 00 00 AF\n  73        C8 03 00 00 00 00 0F 20 00 00 00 00 AF\n  74        C8 03 00 00 00 00 0F 21 00 00 00 00 AE\n  75        C8 03 00 00 00 04 03 20 00 00 00 00 A7\n  76        C8 03 00 00 00 04 04 20 00 00 00 00 A6\n  77        C8 03 00 00 00 04 05 20 00 00 00 00 A1\n  78        C8 03 00 00 00 04 06 20 00 00 00 00 A0\n  79        C8 03 00 00 00 04 07 20 00 00 00 00 A3\n  80        C8 03 00 00 00 04 08 20 00 00 00 00 A2\n  81        C8 03 00 00 00 04 09 20 00 00 00 00 AD\n  82        C8 03 00 00 00 04 09 21 00 00 00 00 AC\n  83        C8 03 00 00 00 04 0A 20 00 00 00 00 AC\n  84        C8 03 00 00 00 04 0A 22 00 00 00 00 AE\n  85        C8 03 00 00 00 04 0B 20 00 00 00 00 AF\n  86        C8 03 00 00 00 04 0B 22 00 00 00 00 A9\n  87        C8 03 00 00 00 04 0C 20 00 00 00 00 AE\n  88        C8 03 00 00 00 04 0C 22 00 00 00 00 A8\n  89        C8 03 00 00 00 04 0D 20 00 00 00 00 A9\n  90        C8 03 00 00 00 04 0D 22 00 00 00 00 AB\n  91        C8 03 00 00 00 04 0E 20 00 00 00 00 A8\n  92        C8 03 00 00 00 04 0E 22 00 00 00 00 AA\n  93        C8 03 00 00 00 04 0F 20 00 00 00 00 AB\n  94        C8 03 00 00 00 04 0F 21 00 00 00 00 AA\n  95        C8 03 00 00 00 04 0F 22 00 00 00 00 55\n  96        C8 03 80 00 00 00 09 20 00 00 00 00 21\n  97        C8 23 00 00 00 00 09 1F 00 00 00 00 46\n  98        C8 23 00 00 00 00 09 20 00 00 00 00 41\n  99        C8 43 00 00 00 00 09 1F 00 00 00 00 66\n 100        C8 43 00 00 00 00 09 20 00 00 00 00 61\n 101        C8 60 40 00 00 00 09 1B 00 00 00 00 D9\n 102        C8 60 40 00 00 00 09 1C 00 00 00 00 D8\n 103        C8 60 40 00 00 00 09 1D 00 00 00 00 DB\n 104        C8 60 40 00 00 00 09 1E 00 00 00 00 DA\n 105        C8 62 40 00 00 04 09 1E 00 00 00 00 C0\n 106        C8 62 40 00 00 04 09 1F 00 00 00 00 C3\n 107        C8 63 00 00 00 00 09 1F 00 00 00 00 06\n 108        C8 63 00 00 00 00 09 20 00 00 00 00 01\n 109        C8 63 40 00 00 00 09 1F 00 00 00 00 C6\n 110        C8 63 40 00 00 04 09 1F 00 00 00 00 C2\n 111        C9 C4 D0 1F 80 31 00 40 02 00 00 00 3A\n 112        CA 00 00 00 00 00 00 00 00 02 F1 21 8B\n 113        CB 00 00 FF FF 70 00 00 00 00 00 00 6C\n 114        CB 00 00 FF FF 7C 00 00 00 00 00 00 10\n 115        CB 00 00 FF FF 7D 00 00 00 00 00 00 13\n</code></pre>\n</div>",
    "votes": "4",
    "answers": 1,
    "views": "1k",
    "tags": [
        "encodings",
        "protocol",
        "crc"
    ],
    "user": "Jes Klinke",
    "time": "May 5, 2016 at 0:28",
    "comments": [
        {
            "user": "Guntram Blohm",
            "text": "<span class=\"comment-copy\">I would, normally, vote to close this question as duplicate of #8429. But as this question has more content than the other one, and might get even better if the OP includes the brand/model name of the AC unit, i think we should close the other one as duplicate of this, even when the other one is older.</span>",
            "time": null
        }
    ],
    "answers_data": [
        {
            "content": "<div class=\"s-prose js-post-body\" itemprop=\"text\">\n<p>You seem to have the same air conditioner like the guy who asked <a href=\"https://reverseengineering.stackexchange.com/questions/8429/reverse-engineering-a-8-bit-crc-checksum\">this question</a>. Add up bytes 0-11, <code>xor</code> with <code>0x55</code> to get byte 12.</p>\n<p>It could help if you stated the brand and model number of your AC unit, that makes it easier for other people who want to do the same thing.</p>\n</div>",
            "votes": "3",
            "user": "Community",
            "time": "Apr 13, 2017 at 12:49",
            "is_accepted": true,
            "comments": [
                {
                    "user": "Jes Klinke",
                    "text": "<span class=\"comment-copy\">Thanks, this is exactly it. My air conditioner is Friedrich M09CJ, the wall mounted \"thermostat\" DWC1 can interface with a number of other Friedrich air conditioners, so it is a reasonable guess that those would also use the same protocol.</span>",
                    "time": null
                },
                {
                    "user": "Jes Klinke",
                    "text": "<span class=\"comment-copy\">I have edited my question to include make and model of the A/C unit.</span>",
                    "time": null
                }
            ]
        }
    ]
}