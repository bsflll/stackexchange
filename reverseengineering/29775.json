{
    "title": "How to print custom name of an operand in IDA Python?",
    "link": "https://reverseengineering.stackexchange.com/questions/29775/how-to-print-custom-name-of-an-operand-in-ida-python",
    "content": "<div class=\"s-prose js-post-body\" itemprop=\"text\">\n<p>I'm starting to work on a plugin to port symbols(stack variable names, operand names, comments, etc) from functions in one database to functions in another database when function names match.</p>\n<p>I'm getting familiar with IDA api and now I can't find out how to get a custom name of an operand in IDA Python.</p>\n<p>Here's my main function:\n<a href=\"https://i.sstatic.net/uR3om.png\" rel=\"nofollow noreferrer\"><img alt=\"enter image description here\" src=\"https://i.sstatic.net/uR3om.png\"/></a></p>\n<p>For now I'd just like to be able to print information I want, I'd like to print operand names: normal names when custom name is not defined, and the custom name when I set the custom name for the operand(Alt+F1 shortcut key by default).</p>\n<p>Here's what I came up with for my main function:</p>\n<pre><code>import idautils\n\n\nfor functionItem in idautils.FuncItems(0x140012400):\n    if ida_bytes.is_code(ida_bytes.get_full_flags(functionItem)):\n        instruction = idautils.DecodeInstruction(functionItem)\n        print(idc.print_operand(instruction.ip, 0))\n</code></pre>\n<p>And I expect it to print this at the end:</p>\n<pre><code>rsp\nrdi\nrbp:myCustomName\n</code></pre>\n<p>This code prints:</p>\n<pre><code>rsp\nrdi\nrbp\n</code></pre>\n<p>I tried to google but I can't find how to show custom operand name. I could only find these 2 related links:</p>\n<ul>\n<li><a href=\"https://hex-rays.com/products/ida/support/idadoc/552.shtml\" rel=\"nofollow noreferrer\">https://hex-rays.com/products/ida/support/idadoc/552.shtml</a></li>\n<li><a href=\"https://hex-rays.com/products/ida/support/idadoc/477.shtml\" rel=\"nofollow noreferrer\">https://hex-rays.com/products/ida/support/idadoc/477.shtml</a></li>\n</ul>\n</div>",
    "votes": "1",
    "answers": 1,
    "views": "485",
    "tags": [
        "idapython"
    ],
    "user": "Revester",
    "time": "Dec 25, 2021 at 10:29",
    "comments": [],
    "answers_data": [
        {
            "content": "<div class=\"s-prose js-post-body\" itemprop=\"text\">\n<p>After doing a bunch of searches like <code>operand</code>, <code>manual</code>, <code>manual operand</code> on hex-rays's <a href=\"https://hex-rays.com/wp-content/static/products/ida/support/idapython_docs/\" rel=\"nofollow noreferrer\">IDA Python docs website</a>, I finally managed to find the appropriate APIs needed to achieve what I want.</p>\n<pre><code>import idautils\n\n\nfor functionItem in idautils.FuncItems(0x140012400):\n    if ida_bytes.is_code(ida_bytes.get_full_flags(functionItem)):\n        instruction = idautils.DecodeInstruction(functionItem)\n        if(ida_bytes.is_forced_operand(instruction.ip, 0)):\n            print(ida_bytes.get_forced_operand(instruction.ip, 0))\n        else:\n            print(idc.print_operand(instruction.ip, 0))\n</code></pre>\n<p>This code above prints the desired result on IDA 7.6 with Python 3.9 installed:</p>\n<pre><code>rsp\nrdi\nrbp:myCustomName\n</code></pre>\n<p>The functions for the manual strings on instructions and operands are:</p>\n<ul>\n<li><a href=\"https://hex-rays.com/wp-content/static/products/ida/support/idapython_docs/ida_bytes.html#ida_bytes.is_manual_insn\" rel=\"nofollow noreferrer\">ida_bytes.is_manual_insn</a></li>\n<li><a href=\"https://hex-rays.com/wp-content/static/products/ida/support/idapython_docs/ida_bytes.html#ida_bytes.get_manual_insn\" rel=\"nofollow noreferrer\">ida_bytes.get_manual_insn</a></li>\n<li><a href=\"https://hex-rays.com/wp-content/static/products/ida/support/idapython_docs/ida_bytes.html#ida_bytes.set_manual_insn\" rel=\"nofollow noreferrer\">ida_bytes.set_manual_insn</a></li>\n<li><a href=\"https://hex-rays.com/wp-content/static/products/ida/support/idapython_docs/ida_bytes.html#ida_bytes.is_forced_operand\" rel=\"nofollow noreferrer\">ida_bytes.is_forced_operand</a></li>\n<li><a href=\"https://hex-rays.com/wp-content/static/products/ida/support/idapython_docs/ida_bytes.html#ida_bytes.get_forced_operand\" rel=\"nofollow noreferrer\">ida_bytes.get_forced_operand</a></li>\n<li><a href=\"https://hex-rays.com/wp-content/static/products/ida/support/idapython_docs/ida_bytes.html#ida_bytes.set_forced_operand\" rel=\"nofollow noreferrer\">ida_bytes.set_forced_operand</a></li>\n</ul>\n</div>",
            "votes": "2",
            "user": "Revester",
            "time": "Dec 25, 2021 at 10:15",
            "is_accepted": false,
            "comments": []
        }
    ]
}