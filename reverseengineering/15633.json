{
    "title": "Debugging MIPS Binaries on Ubuntu 64-bit (version 14.04)",
    "link": "https://reverseengineering.stackexchange.com/questions/15633/debugging-mips-binaries-on-ubuntu-64-bit-version-14-04",
    "content": "<div class=\"s-prose js-post-body\" itemprop=\"text\">\n<p>I have a MIPS 32-bit MSB binary and I can disassemble the code with IDA Pro and decompile it successfully with ReTargetable Decompiler.</p>\n<p>In order to understand the binary much better, I need to debug the binary to understand a few subroutines.</p>\n<p>I am using Ubuntu 64-bit (version 14.04). I have followed the instructions provided here: <a href=\"https://reverseengineering.stackexchange.com/a/8917/2673\">https://reverseengineering.stackexchange.com/a/8917/2673</a> for installing qemu, binfmt, gdb-multiarch, MIPS libraries and cross compiling tool chain.</p>\n<p><strong>cross compiler installation error:</strong></p>\n<p>I get an error while trying to install gcc-4.4-mipsel-linux-gnu on Ubuntu 14.04</p>\n<p>gcc-4.4-mipsel-linux-gnu depends on cpp-4.4-mipsel-linux-gnu.</p>\n<p>When I try to install cpp-4.4-mipsel-linux-gnu, I get an error that libgmp32c2 is not installed. And when I try to install libgmp3c2 using apt-get, it doesn't find the package.</p>\n<p>I can find several other packages like libgmp3c2-* however, cannot find the specific, libgmp3c2 package which cpp-4.4-mipsel-linux-gnu needs. And I have even added the recommended repositories to /etc/apt/sources.list</p>\n<p>However, I thought we need to install the cross platform compiling tools only if I need to compile the program for the target architecture.</p>\n<p><strong>Error in Execution of MIPS Binary</strong></p>\n<p>So, I tried to execute the MIPS binary and it crashes. When I run strace on it, I get the following error:</p>\n<pre><code>NeonFlash:~$ qemu-mips -strace ./test \n61294 brk(NULL) = 0x00412000\n61294 mmap(NULL,4096,PROT_READ|PROT_WRITE,MAP_PRIVATE|MAP_ANONYMOUS,-1,0) = 0x767ca000\n61294 uname(0x76ffeae8) = 0\n61294 access(\"/etc/ld.so.nohwcap\",F_OK) = -1 errno=2 (No such file or directory)\n61294 access(\"/etc/ld.so.preload\",R_OK) = -1 errno=2 (No such file or directory)\n61294 open(\"/etc/ld.so.cache\",O_RDONLY) = 3\n61294 fstat64(3,0x76ffe6d0) = 0\n61294 mmap(NULL,104789,PROT_READ,MAP_PRIVATE,3,0) = 0x767b0000\n61294 close(3) = 0\nqemu: uncaught target signal 11 (Segmentation fault) - core dumped\nSegmentation fault (core dumped)\n</code></pre>\n<p>Below are the details when I tried to use gdb with the binary:</p>\n<pre><code>NeonFlash$ qemu-mips -g 12345 ./test &amp;\n[1] 60181\nNeonFlash$ gdb-multiarch ./test \nGNU gdb (Ubuntu 7.7.1-0ubuntu5~14.04.2) 7.7.1\nCopyright (C) 2014 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"x86_64-linux-gnu\".\nType \"show configuration\" for configuration details.\nFor bug reporting instructions, please see:\n&lt;http://www.gnu.org/software/gdb/bugs/&gt;.\nFind the GDB manual and other documentation resources online at:\n&lt;http://www.gnu.org/software/gdb/documentation/&gt;.\nFor help, type \"help\".\nType \"apropos word\" to search for commands related to \"word\"...\nReading symbols from ./test...(no debugging symbols found)...done.\n(gdb) set arch mips\nThe target architecture is assumed to be mips\n(gdb) target remote localhost:12345\nRemote debugging using localhost:12345\nwarning: Unable to find dynamic linker breakpoint function.\nGDB will be unable to debug shared library initializers\nand track explicitly loaded dynamic code.\n0x767cb880 in ?? ()\n(gdb) x/i $pc\n=&gt; 0x767cb880:  move    t9,ra\n</code></pre>\n<p>I even tried remote debugging the binary using IDA Pro by running qemu-mips as shown below:</p>\n<pre><code>qemu-mips -E REMOTE_ADDR=&lt;IP_address_of_machine_with_IDA_PRO&gt; -g 12345 ./test &amp;\n</code></pre>\n<p>However, if I set a breakpoint on the main function, it crashes.</p>\n<p>Do I need to install qemu-system or qemu-user should be enough for debugging MIPS binaries?</p>\n</div>",
    "votes": "1",
    "answers": 0,
    "views": "1k",
    "tags": [
        "mips",
        "qemu"
    ],
    "user": "Neon Flash",
    "time": "Jun 23, 2017 at 4:02",
    "comments": [
        {
            "user": "Sigtran",
            "text": "<span class=\"comment-copy\">libgmp3c2 was removed from both debian and ubuntu.Its probably best to fix up the environment before jumping into debugging. Gcc-6 is out, libgmp10 is the current i think.</span>",
            "time": null
        }
    ],
    "answers_data": []
}