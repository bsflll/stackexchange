{
    "title": "Radare2: How to Create a Custom Scripted Panel?",
    "link": "https://reverseengineering.stackexchange.com/questions/31937/radare2-how-to-create-a-custom-scripted-panel",
    "content": "<div class=\"s-prose js-post-body\" itemprop=\"text\">\n<p><strong>TLDR: How do I get a panel in radare2 to correctly show the output of a radare2 command piped to an external script?</strong></p>\n<p><strong>e.g. <code>afvd | python var_displayer.py</code></strong></p>\n<ul>\n<li>This is my current view. Multiple panels, using radare2's <code>v</code> command. Note the <code>afvd</code> and RegisterRefs (<code>drr</code>) panels.</li>\n</ul>\n<p><a href=\"https://i.sstatic.net/lw7Vq.png\" rel=\"nofollow noreferrer\"><img alt=\"enter image description here\" src=\"https://i.sstatic.net/lw7Vq.png\"/></a></p>\n<ul>\n<li>I love RegisterRefs (<code>drr</code>) because it shows values at addresses. I love <code>afvd</code> because it shows all var values.</li>\n<li><strong>Problem: <code>afvd</code> only shows var values as decimal.</strong></li>\n<li>Sometimes, it makes more sense to see it as hex.</li>\n<li>Sometimes, it makes more sense to see it as ASCII.</li>\n<li><strong>I want to create something like <code>afvdr</code> that shows var values in different formats + refstr,</strong> like <code>drr</code> does for registers.</li>\n<li>I want to replace my current <code>afvd</code> panel with this new tool.</li>\n</ul>\n<p>What do I have so far?</p>\n<ul>\n<li>I know that if I take a var's value (e.g. <code>var_8h</code> = <code>4287356032</code>) and run the r2 command <code>? &lt;expr&gt;</code>, it will evaluate the expression and show me different representations!</li>\n</ul>\n<p><a href=\"https://i.sstatic.net/zatfH.png\" rel=\"nofollow noreferrer\"><img alt=\"enter image description here\" src=\"https://i.sstatic.net/zatfH.png\"/></a></p>\n<ul>\n<li>I developed a python script, called <code>var_displayer.py</code> that will read the output from <code>avfd</code> and calculate and neatly display the <code>hex</code> and <code>string</code> representations the same as the <code>? &lt;expr&gt;</code> command would. I run it within r2 using <code>afvd | python scripts/var_displayer.py</code>. Here's the output:</li>\n</ul>\n<p><a href=\"https://i.sstatic.net/YByld.png\" rel=\"nofollow noreferrer\"><img alt=\"enter image description here\" src=\"https://i.sstatic.net/YByld.png\"/></a></p>\n<ul>\n<li>This is awesome! I don't have the dereference functionality (treat var value as an address and show the value underlying), which would be useful like <code>drr</code>, but this is great for me!</li>\n<li>However, a problem occurs when I try to replace the <code>afvd</code> panel with <code>afvd | python scripts/var_displayer.py</code>.</li>\n</ul>\n<p><a href=\"https://i.sstatic.net/QcrI5.png\" rel=\"nofollow noreferrer\"><img alt=\"enter image description here\" src=\"https://i.sstatic.net/QcrI5.png\"/></a></p>\n<ul>\n<li>Note how the panel only shows the output of <code>afvd</code>, and note how the string generated by my python script is awkwardly appended to the entire radare2 panels output in the bottom left.</li>\n<li>My python script builds the output string in one variable named <code>output_string</code> and then outputs this string with a call to <code>sys.stdout.write(out_string)</code>. <strong>Unfortunately, radare2 doesn't seem to expect this for a panel's display.</strong></li>\n</ul>\n<p>THANKS FOR READING SO FAR!!!</p>\n<p><strong>My Questions Are:</strong></p>\n<ol>\n<li><strong>Is it possible to configure a radare2 panel to neatly show the output of an external script/program?</strong></li>\n<li><strong>Is there a better way to achieve the evaluate functionality (<code>? &lt;expr&gt;</code>) and dereference evaluate functionality (<code>drr</code> refstr column) for vars that is native to radare2?</strong></li>\n</ol>\n<p>I'm falling in love with radare2 for it's customizability and elegance and slick CLI feel, but I'm pretty surprised to find custom script --&gt; panel is not working. I feel like there must be a way to achieve this that I haven't figured out yet.</p>\n</div>",
    "votes": "2",
    "answers": 0,
    "views": "76",
    "tags": [
        "debugging",
        "radare2",
        "python",
        "script",
        "visualization"
    ],
    "user": "Khalid",
    "time": "Jun 4, 2023 at 15:11",
    "comments": [],
    "answers_data": []
}