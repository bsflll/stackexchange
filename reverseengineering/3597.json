{
    "title": "What is the meaning of this code generated by IDA Pro?",
    "link": "https://reverseengineering.stackexchange.com/questions/3597/what-is-the-meaning-of-this-code-generated-by-ida-pro",
    "content": "<div class=\"s-prose js-post-body\" itemprop=\"text\">\n<p>Test platform is Linux 32 bit.</p>\n<p>I use IDA Pro to disassembly the basename from coreutils 8.5\n compiled by gcc 4.6.3</p>\n<p>Here is a code snippet generated by IDA Pro</p>\n<pre><code>           call    _i686_get_pc_thunk_bx                                 \n           add     ebx, 292Eh\n           sub     esp, 18h\n           mov     eax, ds:(__dso_handle_ptr - 804DFF4h[ebx]\n           test    eax, eax\n           jz      short loc_804B6F8\n           mov     eax, [eax]\n\n     loc_804B6DB:\n           mov     [esp+1Ch+var_14], eax\n           mov     eax, [esp+1Ch+arg_0]\n           mov     dword [esp+1Ch+var_18], 0\n           mov     [esp+1Ch+var_1C], eax\n           call    __cxa_atexit\n           add     esp, 18h\n           pop     ebx\n           retn\n\n     loc_804B6F8:\n           xor     eax, eax\n           jmp     short loc_804B6DB\n</code></pre>\n<p>I don't understand this line:</p>\n<pre><code>mov     eax, ds:(__dso_handle_ptr - 804DFF4h[ebx]\n</code></pre>\n<p>and after searching the code, I can only find this:</p>\n<pre><code>        __dso_handle    dd 0\n</code></pre>\n<p>in the .data section.</p>\n<p>So my questions are:</p>\n<ol>\n<li>What is the meaning of this line..?  Is it like a version checking stuff..?</li>\n<li>Can I just safely remove this line without affecting the functionality of the code..?</li>\n</ol>\n</div>",
    "votes": "3",
    "answers": 1,
    "views": "2k",
    "tags": [
        "ida",
        "disassembly",
        "assembly",
        "disassemblers",
        "nasm"
    ],
    "user": "lllllllllllll",
    "time": "Feb 7, 2014 at 21:12",
    "comments": [
        {
            "user": "0xC0000022L",
            "text": "<span class=\"comment-copy\">You should <i>really</i> add more context!</span>",
            "time": null
        },
        {
            "user": "PhoeniX",
            "text": "<span class=\"comment-copy\">Can you please post at least the whole <code>main</code> of basename?</span>",
            "time": null
        },
        {
            "user": "lllllllllllll",
            "text": "<span class=\"comment-copy\">@ph0sec Thank you and I can modify the question later. But basically I modify my IDC scripts to directly generate nasm syntax asm, then this problem gone....</span>",
            "time": null
        }
    ],
    "answers_data": [
        {
            "content": "<div class=\"s-prose js-post-body\" itemprop=\"text\">\n<p>You are looking at binary that is compiled as position-independent code. The <code>call    _i686_get_pc_thunk_bx</code> and the following addition to <code>ebx</code> shows just that. If you take a look at the disassembly, you'll see that the address of the <code>add ebx, 292Eh</code> plus 0x292E will result in the first address of the GOT. That why in the next line, _dso_handle_ptr is addressed in such a \"funny\" way.</p>\n<p>IDA however is nice enough to show you this in the disassembly as you would normally only see 0xSOMEADDR[ebx]. </p>\n<p>In terms of the second question: that line retrieves a global variable, puts it into <code>eax</code> and then checks if it is zero or not. So, you should not just \"delete\" that line since then the <code>test eax, eax</code> would use some old value of <code>eax</code> (which I am sure you will not like all that much).</p>\n</div>",
            "votes": "8",
            "user": "sqrtsben",
            "time": "Feb 6, 2014 at 23:13",
            "is_accepted": true,
            "comments": []
        }
    ]
}