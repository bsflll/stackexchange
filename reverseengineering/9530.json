{
    "title": "Detection of OllyDbg - INT3? [closed]",
    "link": "https://reverseengineering.stackexchange.com/questions/9530/detection-of-ollydbg-int3",
    "content": "<div class=\"s-prose js-post-body\" itemprop=\"text\">\n<div>\n<aside class=\"s-notice s-notice__info post-notice js-post-notice mb16\" role=\"status\">\n<div class=\"d-flex fd-column fw-nowrap\">\n<div class=\"d-flex fw-nowrap\">\n<div class=\"flex--item wmn0 fl1 lh-lg\">\n<div class=\"flex--item fl1 lh-lg\">\n<div>\n<b>Closed</b>. This question needs <a href=\"/help/closed-questions\">details or clarity</a>. It is not currently accepting answers.\n                                \n                            </div>\n</div>\n</div>\n</div>\n</div>\n<hr class=\"my12 outline-none baw0 bb bc-blue-400\"/>\n<div class=\"fw-nowrap fc-black-500\">\n<div class=\"d-flex fd-column lh-md\">\n<div class=\"mb0 d-flex\">\n<div class=\"flex--item mr8\">\n<svg aria-hidden=\"true\" class=\"svg-icon iconLightbulb\" height=\"18\" viewbox=\"0 0 18 18\" width=\"18\"><path d=\"M15 6.38A6.5 6.5 0 0 0 7.78.04h-.02A6.5 6.5 0 0 0 2.05 5.6a6.3 6.3 0 0 0 2.39 5.75c.49.39.76.93.76 1.5v.24c0 1.07.89 1.9 1.92 1.9h2.75c1.04 0 1.92-.83 1.92-1.9v-.2c0-.6.26-1.15.7-1.48A6.3 6.3 0 0 0 15 6.37M4.03 5.85A4.5 4.5 0 0 1 8 2.02a4.5 4.5 0 0 1 5 4.36 4.3 4.3 0 0 1-1.72 3.44c-.98.74-1.5 1.9-1.5 3.08v.1H7.2v-.14c0-1.23-.6-2.34-1.53-3.07a4.3 4.3 0 0 1-1.64-3.94M10 18a1 1 0 0 0 0-2H7a1 1 0 1 0 0 2z\"></path></svg>\n</div>\n<p><b>Want to improve this question?</b> Add details and clarify the problem by <a href=\"/posts/9530/edit\">editing this post</a>.</p>\n</div>\n<div class=\"mb0 mt6 d-flex\">\n<p class=\"ml24 pl2\">Closed <span class=\"relativetime\" title=\"2015-08-07 22:18:08Z\">9 years ago</span>.</p>\n</div>\n<div class=\"ml24 pl2\">\n</div>\n</div>\n</div>\n<div class=\"mt24 d-flex gsx gs8\">\n<a class=\"s-btn s-btn__outlined flex--item js-post-notice-edit-post\" href=\"/posts/9530/edit\">\n                        Improve this question\n                    </a>\n</div>\n</aside>\n</div>\n<p>I am trying to catch anti debugging routines, and I don't quite understand what INT3 does, and I have read that it can be used to detect debuggers and mask calls.  The program eventually sends me into a nonsensical loop if I am stepping, and if I am running, it will notify me that a debugger has been found.  </p>\n<pre><code>77BE0000   8B4424 04        MOV EAX,DWORD PTR SS:[ESP+4]\n77BE0004   CC               INT3\n77BE0005   C2 0400          RETN 4\n77BE0008 &gt; CC               INT3\n77BE0009   90               NOP\n77BE000A   C3               RETN\n77BE000B   90               NOP\n77BE000C &gt; CC               INT3\n77BE000D   C3               RETN\n</code></pre>\n<p>I think INT3 might be something going on here.  Since my intel instruction set reference (<a href=\"http://faydoc.tripod.com/cpu/index_i.htm\" rel=\"nofollow\">http://faydoc.tripod.com/cpu/index_i.htm</a>) says this has something to do with a debugger interrupt.  I also read something about how these can be used to mask debugger detection from reverse engineers.</p>\n<p>Am I barking up the wrong tree or is there something in this line of code questionable?</p>\n</div>",
    "votes": "2",
    "answers": 1,
    "views": "3k",
    "tags": [
        "disassembly",
        "anti-debugging"
    ],
    "user": "Chemistpp",
    "time": "9 years ago",
    "comments": [],
    "answers_data": [
        {
            "content": "<div class=\"s-prose js-post-body\" itemprop=\"text\">\n<p>This technique uses the fact that when the interrupt instructions INT3 (breakpoint) and INT1 \n(single-step) are stepped thru inside a debugger, by default, the exception handler will not be \ninvoked since debuggers typically handle the exceptions generated by these interrupts. Thus, \na packer can set flags inside the exception handler, and if these flags are not set after the INT \ninstruction, it means that the process is being debugged. Additionally, kernel32!DebugBreak() \ninternally invokes an INT3 and some packers use the said API instead. </p>\n<p><a href=\"https://www.blackhat.com/presentations/bh-usa-07/Yason/Whitepaper/bh-usa-07-yason-WP.pdf\" rel=\"nofollow\">Reference</a></p>\n</div>",
            "votes": "4",
            "user": "RCECoder",
            "time": "Aug 2, 2015 at 11:09",
            "is_accepted": true,
            "comments": [
                {
                    "user": "Chemistpp",
                    "text": "<span class=\"comment-copy\">Thank you very much for the link!  If you have any other tips or data regarding catching non-trivial anti-debugging code, I'd love to read it.  I'm still reading all the info (as this links out to several others), hopefully I get to the part it discusses circumventing it.</span>",
                    "time": null
                }
            ]
        }
    ]
}