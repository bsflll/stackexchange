{
    "title": "What's the format of Mediatek MRE VXP file and how to create a workable VXP binary?",
    "link": "https://reverseengineering.stackexchange.com/questions/30490/whats-the-format-of-mediatek-mre-vxp-file-and-how-to-create-a-workable-vxp-bina",
    "content": "<div class=\"s-prose js-post-body\" itemprop=\"text\">\n<h1>Background</h1>\n<p><a href=\"https://web.archive.org/web/20150922183623/http://mre.mediatek.com/\" rel=\"nofollow noreferrer\">Mediatek's MRE</a> (MAUI Runtime Environment) <a href=\"https://en.wikipedia.org/wiki/Series_30%2B#:%7E:text=Many%20S30%2B%20devices%20only%20support%20MAUI%20Runtime%20Environment%20(MRE)%2C%5B1%5D%5B2%5D%20developed%20by%20MediaTek%2C%5B3%5D%5B4%5D%20but%20some%20later%20devices%20have%20included%20support%20for%20J2ME%20applications.\" rel=\"nofollow noreferrer\">is the default runtime</a> on <a href=\"https://en.wikipedia.org/wiki/Series_30%2B\" rel=\"nofollow noreferrer\">Nokia S30+ platform</a>, replacing the J2ME platform on older Nokia. From <a href=\"https://web.archive.org/web/20151104094204/http://mre.mediatek.com/en/start/what\" rel=\"nofollow noreferrer\">MRE's page</a>:</p>\n<blockquote>\n<p>MRE (MAUI Runtime Environment) is a phone application development platform similar to JVM and Brew. On the MRE platform, you can realize solutions for smart featuer phones on feature\nphones. Meanwhile, MediaTek also provides devlopers and end suppliers with highly efficient\ndevelopment tools (MRE SDK) and compilation environment for applications, allowing developers to develop applications more quickly and effectively.</p>\n</blockquote>\n<p>MRE's executable file has the extension <code>vxp</code> (I don't know that it stands for).</p>\n<p>The problem is, MRE SDK isn't supported anymore (people have claim <a href=\"https://news.ycombinator.com/item?id=14288221#:%7E:text=across%20multiple%20devices.-,As%20for%20the%20Series%2030%2B%2C%20the%20MRE%20was%20a%20market%20failure%2C%20never%20reaching%20a%20fraction%20of%20J2ME%2C%20Mediatek%20doesn%27t%20even%20support%20the%20SDK%20anymore.,-bitmapbrother%20on%20May\" rel=\"nofollow noreferrer\">here</a> that it's a market failure on S30+ platform), and the website, including the SDK, documentation, forum, disscussion and other things were totally deleted from the Internet (Wayback Machine archived some of the pages but not all).</p>\n<p>I myself got a Nokia 220 and a Nokia 225, both are S30+ platform and run MRE VXP (I tried with J2ME jar file and it cannot run, says <code>can't open this file type</code>)</p>\n<p>Luckily, using <a href=\"https://github.com/UstadMobile/ustadmobile-mre/issues/2#issuecomment-561627649\" rel=\"nofollow noreferrer\">this man's copy</a> of MRE SDK 3.0, and using <a href=\"https://developer.arm.com/downloads/-/rvds-and-ads\" rel=\"nofollow noreferrer\">ARM RVDS</a>, I was able to compile a simple 'Hello World' application for MRE (you can download it <a href=\"https://transfer.sh/rFF5Rx/Default.vxp\" rel=\"nofollow noreferrer\">here</a>).</p>\n<h1>Problems</h1>\n<p>I copy the <code>vxp</code> file to my SD card, plug it in the phone, then open the vxp file. The application refused to run, says <code>can't open this app at the moment</code>. I tried other resolution in the SDK, other SDK version (they have SDK 1.0, 2.0 and 3.0), using different compiler (GCC), and it still doesn't run.</p>\n<p>Check my vxp file with <code>file</code>, it outputs <code>Default.vxp: ELF 32-bit LSB shared object, ARM, EABI5 version 1 (SYSV), dynamically linked, interpreter /usr/lib/ld.so.1, not stripped</code>, but I don't know how to make it statically linked, even passing <code>-static</code> option to GCC doesn't work. (Maybe the problem is here)</p>\n<h1>Other <code>vxp</code> apps</h1>\n<p>I found there are some <code>vxp</code> store online (most are <code>*.xtgem.com</code>, I don't know why), for example <a href=\"http://shifat100.xtgem.com\" rel=\"nofollow noreferrer\">http://shifat100.xtgem.com</a>. I tried downloading some vxp files, put it onto my SD card and run it. Some apps work, while some don't. Some apps work for Nokia 220 but not work on Nokia 225, for example the <a href=\"http://www.shifat100.xtgem.com/avengers.vxp\" rel=\"nofollow noreferrer\">Advengers VXP</a> works on Nokia 220 but not on Nokia 225 (Nokia 225 has bigger screen, so I think app resolution is the problem)</p>\n<p>Anyway, MRE SDK has an <code>Auto adaptable</code> option for screen resolution.</p>\n<p><a href=\"https://i.sstatic.net/L3Ir8.png\" rel=\"nofollow noreferrer\"><img alt=\"mre\" src=\"https://i.sstatic.net/L3Ir8.png\"/></a></p>\n<p><a href=\"http://blacklove.wapamp.com/files/OperaMini4.4.V32206.vxp\" rel=\"nofollow noreferrer\">The Opera Mini VXP</a> works on both of my phones.</p>\n<p>I noticed that most of the VXP for Nokia are made by Gameloft - a game company.</p>\n<h1>File format</h1>\n<p>I tried opening the <a href=\"http://shifat100.xtgem.com/files/Asphalt%206%20Full%20Version.vxp\" rel=\"nofollow noreferrer\">Asphalt VXP</a> and that Opera Mini VXP on HxD editor and to my surprise, they are in different formats:\n<a href=\"https://i.sstatic.net/G4WWk.png\" rel=\"nofollow noreferrer\"><img alt=\"vxp\" src=\"https://i.sstatic.net/G4WWk.png\"/></a></p>\n<p>On the left is the Opera Mini VXP, which is in ELF format, on the right is the Asphalt VXP (developed by Gameloft) in unknown format, but the <code>x</code> at the beginning tells me it might be compressed by zlib.</p>\n<p>Tried with <code>file</code>: <code>Asphalt 6 Full Version.vxp: zlib compressed data</code>\nTried with <code>7z l</code>: <code>ERROR: Asphalt 6 Full Version.vxp : Can not open the file as archive</code></p>\n<p>Using <code>strings</code> shows <a href=\"https://gist.githubusercontent.com/raspiduino/3d7ec65a47272f023048a36d05aac4fd/raw/a126f4d204530b54fd2f106ee4e5c15237f5b2a0/asphalt.txt\" rel=\"nofollow noreferrer\">some interesting result</a></p>\n<p>Using <code>binwalk</code>:</p>\n<pre><code>python -m binwalk -B \"Asphalt 6 Full Version.vxp\"\n\nDECIMAL       HEXADECIMAL     DESCRIPTION\n--------------------------------------------------------------------------------\n0             0x0             Zlib compressed data, best compression\n123284        0x1E194         Zlib compressed data, best compression\n278441        0x43FA9         GIF image data, version \"89a\", 45 x 45\n281257        0x44AA9         GIF image data, version \"89a\", 45 x 45\n</code></pre>\n<p>After extracting the files, I got 2 icon files, which seems correct for that game</p>\n<p><a href=\"https://i.sstatic.net/b55HG.png\" rel=\"nofollow noreferrer\"><img alt=\"icon files\" src=\"https://i.sstatic.net/b55HG.png\"/></a></p>\n<p>and 2 files extracted from 2 <code>Zlib compressed data</code>, using <code>file</code> on 2 files output the file type <code>data</code>. Using <code>python -m binwalk -B -A</code> for the first file at offset 0 shows many ARM instructions (which seems to be reasonable since the phone was based on Mediatek ARM chip).</p>\n<p>I tried loaded it into IDA, but since I don't know the start address, it's really hard to get where the entry point is.</p>\n<p>Using <code>strings</code> also shows <a href=\"https://gist.githubusercontent.com/raspiduino/3d7ec65a47272f023048a36d05aac4fd/raw/ed4a2fea70d644a2220cfd9eec733f77bc7c9749/0.txt\" rel=\"nofollow noreferrer\">interesting things</a>. Things start with <code>vm_</code> like</p>\n<pre><code>vm_app_log\nvm_cell_open\nvm_cell_close\nvm_cell_get_cur_cell_info\nvm_cell_get_nbr_cell_info\nvm_cell_get_nbr_num\n</code></pre>\n<p>are some standart MRE API calls while things like</p>\n<pre><code>Unknown signal\nInvalid Operation\nDivide By Zero\nOverflow\nUnderflow\nInexact Result\n: Heap memory corrupted\nAbnormal termination\nArithmetic exception: \nIllegal instruction\nInterrupt received\nIllegal address\nTermination request\nStack overflow\nRedirect: can't open: \nOut of heap memory\nUser-defined signal 1\nUser-defined signal 2\nPure virtual fn called\nC++ library exception\n</code></pre>\n<p>seems to be runtime error messages.</p>\n<p>Using <code>strings</code> on the file at <a href=\"https://gist.github.com/raspiduino/3d7ec65a47272f023048a36d05aac4fd/raw/c233fd7ad01ec8bf93146f047b08a4ea918389b2/1E194.txt\" rel=\"nofollow noreferrer\">1E194</a> suggests that this might be a resource file, but note that strings in that file are also existed in the original VXP file without extracting (is binwalk wrong?)</p>\n<p>Back to Opera Mini VXP, this is an ELF file, shows by <code>file</code>: <code>OperaMini4.4.V32206.vxp: ELF 32-bit LSB executable, ARM, version 1 (SYSV), statically linked, stripped</code>.</p>\n<p>Try loading it into IDA, it seems unreasonable since the main function goes nowhere. I also not sure what is <code>supervisor call</code></p>\n<p><a href=\"https://i.sstatic.net/GXbQF.png\" rel=\"nofollow noreferrer\"><img alt=\"ida\" src=\"https://i.sstatic.net/GXbQF.png\"/></a></p>\n<p>If I patch any path of the file, for example change a character in a resource string (but still remains the same size as the original), it will output <code>can't open this app at the moment</code>.</p>\n<p>I have read <a href=\"https://answers.microsoft.com/en-us/mobiledevices/forum/all/nokia-s30-development-signing-support-in-mre/25c9ad93-644d-4543-9c0d-f539aad27c59\" rel=\"nofollow noreferrer\">here</a> that the applications which runs on Nokia S30+ will need to be signed. If that's true, that will explain why patching doesn't work.</p>\n<p>Can you figure out informations about the MRE VXP format, how to get it signed, and how to run self developed MRE app on Nokia phones? Thanks!</p>\n<h1>Notes</h1>\n<p>I am also trying reversing the phone's firmware to find out how <code>vxp</code> file loaded and executed. After doing some Google Search I found some example firmware source code for the MAUI platform (you can think of it like an OS), like <a href=\"https://github.com/hyperion70/HSPA_MOLY.WR8.W1449.MD.WG.MP.V16\" rel=\"nofollow noreferrer\">this</a> repo, but I cannot find out how it load vxp files.</p>\n<p>If anyone is also interested in reversing this firmware, tell me and I will open a new post :)</p>\n</div>",
    "votes": "6",
    "answers": 1,
    "views": "4k",
    "tags": [
        "arm",
        "elf"
    ],
    "user": "raspiduino",
    "time": "Jun 21, 2022 at 8:39",
    "comments": [
        {
            "user": "raspiduino",
            "text": "<span class=\"comment-copy\"><a href=\"https://stackoverflow.com/questions/72519240/how-to-get-nokia-s30s-mre-vxp-file-to-run-on-nokia-225\">Here</a> is my question of StackOverflow about this topic</span>",
            "time": null
        },
        {
            "user": "sudhackar",
            "text": "<span class=\"comment-copy\">Nice! This is how a good question looks like - just has the right information to follow through!</span>",
            "time": null
        },
        {
            "user": "raspiduino",
            "text": "<span class=\"comment-copy\">But no one answer it :)) Thanks for taking a look at this question anyway</span>",
            "time": null
        },
        {
            "user": "sudhackar",
            "text": "<span class=\"comment-copy\">Its a pretty niche area. Its only been 11 days and 26 views. I'll start a bounty to get more visibility on this.</span>",
            "time": null
        },
        {
            "user": "raspiduino",
            "text": "<span class=\"comment-copy\">Ok I'm reversing the Phone's firmware to see how the vxp loaded and executed :))</span>",
            "time": null
        }
    ],
    "answers_data": [
        {
            "content": "<div class=\"s-prose js-post-body\" itemprop=\"text\">\n<p>First I want to say thanks to people at 4pda forum. See their thread <a href=\"https://4pda.to/forum/index.php?showtopic=1041371&amp;st=0\" rel=\"nofollow noreferrer\">here</a>.</p>\n<blockquote>\n<p>Can you figure out informations about the MRE VXP format</p>\n</blockquote>\n<p>Well I haven't found yet, need further research</p>\n<blockquote>\n<p>how to get it signed</p>\n</blockquote>\n<p>Short answer:</p>\n<p>Step 1: Get your <b>SIM 1</b>'s <strong>IMSI</strong> number (<strong>NOT</strong> IMEI, they are <strong>DIFFERENT!</strong>)</p>\n<p>You can do this in multiple ways, but the easiest way is to plug the SIM 1 in to an Android phone and read. I personally <a href=\"https://stackoverflow.com/questions/14813875/how-to-get-imsi-number-in-android-using-command-line\">use ADB to read IMSI</a> (worked on Android 6+ without root):</p>\n<pre><code>adb shell service call iphonesubinfo 7\n</code></pre>\n<p>Step 2: Go to <a href=\"https://vxpatch.luxferre.top/\" rel=\"nofollow noreferrer\">https://vxpatch.luxferre.top/</a> and input the IMSI number you got in step 1. Then select your VXP file, click 'Patch' and you should be able to download a patched version.</p>\n<p>or</p>\n<p>You can enter the IMSI number in the project setting, but <strong>REMEMBER TO ADD 9 BEFORE THE IMSI NUMBER</strong></p>\n<p><a href=\"https://i.sstatic.net/1QFTC.png\" rel=\"nofollow noreferrer\"><img alt=\"imsi\" src=\"https://i.sstatic.net/1QFTC.png\"/></a></p>\n<p>Step 3: Move the patched version into a SD card and plug it in your phone\nStep 4: Find the vxp file and click open, your app should run now!</p>\n<p>Long answer:\nSome apps doesn't require specify the IMSI, they just work on any devices. That's because they use another way of signing, using RSA key.</p>\n<p>If you are interested, read <a href=\"https://4pda.to/forum/index.php?showtopic=1041371&amp;st=20#:%7E:text=%D0%A2%D0%B0%D0%BC%20%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0%20%D1%86%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%BE%D0%B9%20%D0%BF%D0%BE%D0%B4%D0%BF%D0%B8%D1%81%D0%B8%20%D0%BD%D0%B0%20RSA%20%D0%BA%D0%BB%D1%8E%D1%87%D0%B0%D1%85%20(%D1%83%20%D0%BC%D0%B5%D0%B4%D0%B8%D0%B0%D1%82%D0%B5%D0%BA%20%D0%B7%D0%B0%D0%BA%D1%80%D1%8B%D1%82%D1%8B%D0%B9%20%D0%BA%D0%BB%D1%8E%D1%87%2C%20%D0%B0%20%D0%B2%20%D0%BF%D0%B0%D0%BC%D1%8F%D1%82%D0%B8%20%D1%82%D0%B5%D0%BB%D0%B5%D1%84%D0%BE%D0%BD%D0%B0%20%D0%BE%D1%82%D0%BA%D1%80%D1%8B%D1%82%D1%8B%D0%B9)%0A%D0%9F%D0%BE%D0%B4%D1%80%D0%BE%D0%B1%D0%BD%D0%B5%D0%B5%20%D1%82%D1%83%D1%82%20%D0%9A%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3%20%D0%B8%D0%B3%D1%80%20%D0%B8%20%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%20%D0%B4%D0%BB%D1%8F%20%D0%BA%D0%B8%D1%82%D0%B0%D0%B9%D1%81%D0%BA%D0%B8%D1%85%20%D1%82%D0%B5%D0%BB%D0%B5%D1%84%D0%BE%D0%BD%D0%BE%D0%B2%20(%D0%9F%D0%BE%D1%81%D1%82%20Ximik_Boda%20%23111714051)%0A%D0%B8%20%D1%82%D1%83%D1%82%20%D0%9A%D0%B0%D1%82%D0%B0%D0%BB%D0%BE%D0%B3%20%D0%B8%D0%B3%D1%80%20%D0%B8%20%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%20%D0%B4%D0%BB%D1%8F%20%D0%BA%D0%B8%D1%82%D0%B0%D0%B9%D1%81%D0%BA%D0%B8%D1%85%20%D1%82%D0%B5%D0%BB%D0%B5%D1%84%D0%BE%D0%BD%D0%BE%D0%B2%20(%D0%9F%D0%BE%D1%81%D1%82%20Ximik_Boda%20%23107895102)\" rel=\"nofollow noreferrer\">here</a>. The text is in Russian, so use Google Translate if you want to.</p>\n<p>I have tested with ADS 1.2 compiler (I cracked myself, if you want it then tell me) and GCC (Smaller size + work very well) and Nokia 225, will continue to test further!</p>\n<p>The apps in S30+ platform are written in C (and optionally C++), so you can port many apps to S30+</p>\n<p>Again, a great thanks to people at 4pda forum!</p>\n<p>An image of the app running after signing:</p>\n<p><a href=\"https://i.sstatic.net/N2VRx.png\" rel=\"nofollow noreferrer\"><img alt=\"image of the app\" src=\"https://i.sstatic.net/N2VRx.png\"/></a></p>\n</div>",
            "votes": "1",
            "user": "raspiduino",
            "time": "Jul 18, 2022 at 14:43",
            "is_accepted": true,
            "comments": [
                {
                    "user": "raspiduino",
                    "text": "<span class=\"comment-copy\">The code loading VXP app is <a href=\"https://github.com/adasngle/testmywatch/blob/master/media/mre/engine/framework/vmcermng.c\" rel=\"nofollow noreferrer\">here</a></span>",
                    "time": null
                }
            ]
        }
    ]
}