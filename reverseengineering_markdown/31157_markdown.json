{
  "title": "Assistance with dumped firmware image",
  "link": "https://reverseengineering.stackexchange.com/questions/31157/assistance-with-dumped-firmware-image",
  "content": "I need some assistance in reverse engineering this dumped nor flash image.\nbinwalk yields this after norflash has been dumped (removed the flash chip, dumped it with CH341a and flashrom)\n\n```\nDECIMAL       HEXADECIMAL     DESCRIPTION\n--------------------------------------------------------------------------------\n154192        0x25A50         CRC32 polynomial table, big endian\n245762        0x3C002         PEM certificate\n249501        0x3CE9D         PEM certificate\n250882        0x3D402         PEM RSA private key\n251906        0x3D802         PEM certificate\n256542        0x3EA1E         PEM certificate\n258050        0x3F002         PEM RSA private key\n262144        0x40000         JFFS2 filesystem, big endian\n9849380       0x964A24        JFFS2 filesystem, big endian\n9863608       0x9681B8        JFFS2 filesystem, big endian\n9863852       0x9682AC        Zlib compressed data, compressed\n9864052       0x968374        JFFS2 filesystem, big endian\n9865340       0x96887C        Zlib compressed data, compressed\n9870836       0x969DF4        JFFS2 filesystem, big endian\n9876384       0x96B3A0        Zlib compressed data, compressed\n9878400       0x96BB80        Zlib compressed data, compressed\n9880236       0x96C2AC        Zlib compressed data, compressed\n9881684       0x96C854        Zlib compressed data, compressed\n9882988       0x96CD6C        Zlib compressed data, compressed\n9883992       0x96D158        Zlib compressed data, compressed\n9885124       0x96D5C4        Zlib compressed data, compressed\n9886064       0x96D970        Zlib compressed data, compressed\n9887200       0x96DDE0        Zlib compressed data, compressed\n9887672       0x96DFB8        Zlib compressed data, compressed\n9893276       0x96F59C        Zlib compressed data, compressed\n9894424       0x96FA18        JFFS2 filesystem, big endian\n9894896       0x96FBF0        JFFS2 filesystem, big endian\n9895936       0x970000        JFFS2 filesystem, big endian\n10028120      0x990458        JFFS2 filesystem, big endian\n10041496      0x993898        Zlib compressed data, compressed\n10044320      0x9943A0        JFFS2 filesystem, big endian\n10048664      0x995498        JFFS2 filesystem, big endian\n10049940      0x995994        JFFS2 filesystem, big endian\n21233664      0x1440000       uImage header, header size: 64 bytes, header CRC: 0xD3221C35, created: 2018-04-09 21:38:35, image size: 1399199 bytes, Data Address: 0x80002000, Entry Point: 0x80224EB0, data CRC: 0x296FC3A7, OS: Linux, CPU: MIPS, image type: OS Kernel Image, compression type: gzip, image name: \"Linux Kernel Image\"\n21233728      0x1440040       gzip compressed data, maximum compression, has original file name: \"vmlinux.bin\", from Unix, last modified: 2018-04-09 21:38:35\n\n```\nFrom the above, it appears that between the RSA key, and the uImage, there's a filesystem.\nWhy it is split into smaller parts, I don't know.\n\nI logged in via the serial port using \"admin\" and got the following:\n\n```\nrooter # cat /proc/mtd \ndev:    size   erasesize  name\nmtd0: 00040000 00010000 \"u-boot\"\nmtd1: 01400000 00010000 \"rootfs\"\nmtd2: 00400000 00010000 \"uImage\"\nmtd3: 007b0000 00010000 \"reserved\"\nmtd4: 00010000 00010000 \"caldata\"\n\nrooter # ls /dev/ | grep mtdblock\nmtdblock0\nmtdblock1\nmtdblock2\nmtdblock3\nmtdblock4\nmtdblock5\nmtdblock6\n\nrooter # mount\nrootfs on / type rootfs (rw)\n/dev/root on / type jffs2 (rw,relatime)\n/proc on /proc type proc (rw,relatime)\ndevpts on /dev/pts type devpts (rw,relatime,mode=622)\nnone on /tmp type ramfs (rw,relatime)\nsysfs on /sys type sysfs (rw,relatime)\n\n```\nFrom the mtdblock info, I can probably safely assume that the \"rootfs\" filesystem is on the second block.\n\nI also dumped the \"mtdblocks\" one by one using tftp, and binwalk yields this on the \"rootfs\" mtdblock:\n\n```\nDECIMAL       HEXADECIMAL     DESCRIPTION\n--------------------------------------------------------------------------------\n0             0x0             JFFS2 filesystem, big endian\n9587236       0x924A24        JFFS2 filesystem, big endian\n9601464       0x9281B8        JFFS2 filesystem, big endian\n9601708       0x9282AC        Zlib compressed data, compressed\n9601908       0x928374        JFFS2 filesystem, big endian\n9603196       0x92887C        Zlib compressed data, compressed\n9608692       0x929DF4        JFFS2 filesystem, big endian\n9614240       0x92B3A0        Zlib compressed data, compressed\n9616256       0x92BB80        Zlib compressed data, compressed\n9618092       0x92C2AC        Zlib compressed data, compressed\n9619540       0x92C854        Zlib compressed data, compressed\n9620844       0x92CD6C        Zlib compressed data, compressed\n9621848       0x92D158        Zlib compressed data, compressed\n9622980       0x92D5C4        Zlib compressed data, compressed\n9623920       0x92D970        Zlib compressed data, compressed\n9625056       0x92DDE0        Zlib compressed data, compressed\n9625528       0x92DFB8        Zlib compressed data, compressed\n9631132       0x92F59C        Zlib compressed data, compressed\n9632280       0x92FA18        JFFS2 filesystem, big endian\n9632752       0x92FBF0        JFFS2 filesystem, big endian\n9633792       0x930000        JFFS2 filesystem, big endian\n9765976       0x950458        JFFS2 filesystem, big endian\n9779352       0x953898        Zlib compressed data, compressed\n9781400       0x954098        JFFS2 filesystem, big endian\n9782176       0x9543A0        JFFS2 filesystem, big endian\n\n```\nI tried to get the rootfs mtdblock converted to a jffs2 image, but does show \"empty\" on the terminal, after using this script to mount it:\nhttps://reverseengineering.stackexchange.com/a/22433\n\nAny assistance to get it to show some contents?\n\nI am trying to use this dumped nor flash image, for use to create a OpenWRT image for a router.\n\n",
  "votes": "2",
  "answers": 0,
  "views": "157",
  "tags": [
    "binwalk",
    "router"
  ],
  "user": "MisterZZ",
  "time": "Nov 19, 2022 at 19:20",
  "comments": [],
  "answers_data": []
}