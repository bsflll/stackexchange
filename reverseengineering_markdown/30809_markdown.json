{
  "title": "c000001d (Illegal instruction)",
  "link": "https://reverseengineering.stackexchange.com/questions/30809/c000001d-illegal-instruction",
  "content": "My Windows crashed, don't understand it shows 'Illegal instruction' on a simple 'strlen' instruction:\n\n```\n*******************************************************************************\n*                                                                             *\n*                        Bugcheck Analysis                                    *\n*                                                                             *\n*******************************************************************************\n\nSYSTEM_THREAD_EXCEPTION_NOT_HANDLED (7e)\nThis is a very common BugCheck.  Usually the exception address pinpoints\nthe driver/function that caused the problem.  Always note this address\nas well as the link date of the driver/image that contains this address.\nArguments:\nArg1: ffffffffc000001d, The exception code that was not handled\nArg2: fffff80666bd1151, The address that the exception occurred at\nArg3: ffff9e8e84a36708, Exception Record Address\nArg4: ffff9e8e84a35f40, Context Record Address\n\nDebugging Details:\n------------------\n\n\nKEY_VALUES_STRING: 1\n\n    Key  : Analysis.CPU.mSec\n    Value: 1656\n\n    Key  : Analysis.DebugAnalysisManager\n    Value: Create\n\n    Key  : Analysis.Elapsed.mSec\n    Value: 1710\n\n    Key  : Analysis.Init.CPU.mSec\n    Value: 608\n\n    Key  : Analysis.Init.Elapsed.mSec\n    Value: 5677\n\n    Key  : Analysis.Memory.CommitPeak.Mb\n    Value: 107\n\n    Key  : Bugcheck.Code.DumpHeader\n    Value: 0x7e\n\n    Key  : Bugcheck.Code.KiBugCheckData\n    Value: 0x7e\n\n    Key  : Bugcheck.Code.Register\n    Value: 0x7e\n\n    Key  : WER.OS.Branch\n    Value: vb_release\n\n    Key  : WER.OS.Timestamp\n    Value: 2019-12-06T14:06:00Z\n\n    Key  : WER.OS.Version\n    Value: 10.0.19041.1\n\n\nFILE_IN_CAB:  MEMORY_20220819.DMP\n\nBUGCHECK_CODE:  7e\n\nBUGCHECK_P1: ffffffffc000001d\n\nBUGCHECK_P2: fffff80666bd1151\n\nBUGCHECK_P3: ffff9e8e84a36708\n\nBUGCHECK_P4: ffff9e8e84a35f40\n\nEXCEPTION_RECORD:  ffff9e8e84a36708 -- (.exr 0xffff9e8e84a36708)\nExceptionAddress: fffff80666bd1151 (nt!strlen+0x0000000000000031)\n   ExceptionCode: c000001d (Illegal instruction)\n  ExceptionFlags: 00000000\nNumberParameters: 0\n\nCONTEXT:  ffff9e8e84a35f40 -- (.cxr 0xffff9e8e84a35f40)\nrax=ffffa086f1dd9cc8 rbx=ffffa086f1dd9c10 rcx=00005f790e2263f0\nrdx=0000000000000000 rsi=ffffa086f1e10078 rdi=0000000000000000\nrip=fffff80666bd1151 rsp=ffff9e8e84a36948 rbp=ffff9e8e84a36a29\n r8=7efefefefefefeff  r9=eb636d60672c6b60 r10=ffffffff00000003\nr11=8101010101010100 r12=ffff9e8e84a36d98 r13=0000000000000001\nr14=ffffa086f1dd9c10 r15=ffffa086efab1028\niopl=0         nv up ei pl zr na po nc\ncs=0010  ss=0018  ds=002b  es=002b  fs=0053  gs=002b             efl=00050246\nnt!strlen+0x31:\nfffff806`66bd1151 488b10          mov     rdx,qword ptr [rax] ds:002b:ffffa086`f1dd9cc8=392c303037313d65\nResetting default scope\n\nBLACKBOXBSD: 1 (!blackboxbsd)\n\n\nBLACKBOXNTFS: 1 (!blackboxntfs)\n\n\nBLACKBOXPNP: 1 (!blackboxpnp)\n\n\nBLACKBOXWINLOGON: 1\n\nPROCESS_NAME:  System\n\nERROR_CODE: (NTSTATUS) 0xc000001d - {   ~}       T     O           @     T     O C\n\nEXCEPTION_CODE_STR:  c000001d\n\nEXCEPTION_STR:  0xc000001d\n\nFAILED_INSTRUCTION_ADDRESS: \nnt!strlen+31\nfffff806`66bd1151 488b10          mov     rdx,qword ptr [rax]\n\nSTACK_TEXT:  \nffff9e8e`84a36948 fffff807`311fe7b7     : ffffa086`ffe2fd50 00000000`00000000 ffffa086`f1dd9c10 fffff807`311fe347 : nt!strlen+0x31\nffff9e8e`84a36950 fffff807`311fe477     : fffff807`312bb710 00000000`00000000 ffffa086`f61c9470 00000000`f1e10078 : acpis!AgentSetState+0x76e7\nffff9e8e`84a36980 fffff807`311fe0e2     : d3e7328e`00020008 ffffa086`ffe2e440 ffffa086`efab1028 ffff9e8e`84a36b90 : acpis!AgentSetState+0x73a7\nffff9e8e`84a36a90 fffff807`312008ad     : 00000000`ffffffff 00000000`00000000 ffffa087`0a011808 ffffa086`f1dd9c10 : acpis!AgentSetState+0x7012\nffff9e8e`84a36ac0 fffff807`31200fea     : ffffa086`fb2f9228 ffff9e8e`84a36bc0 ffffa086`fb0e94a0 ffffa086`f1dd9c10 : acpis!sd_StrToUnicode+0x1335\nffff9e8e`84a36b00 fffff807`311fc6d0     : ffff9e8e`84a36d98 fffff807`312054b2 ffffa086`f61c9470 ffffa086`f1dd9c10 : acpis!ag_CacheReleaseEx2+0xe\nffff9e8e`84a36b30 fffff807`3113d20e     : ffffa086`fb2f9228 ffffa086`fb0e94a0 ffffa086`fb0e94a0 00000000`00000000 : acpis!AgentSetState+0x5600\nffff9e8e`84a36b60 fffff807`3113ca60     : ffff9e8e`84a36c38 00000000`00000000 ffffa086`f61c9470 ffff9e8e`84a36cf0 : acpis!sd_CommandRegister+0x1956\nffff9e8e`84a36bf0 fffff807`3113db0d     : 00000000`00000001 fffff807`31136327 ffff9e8e`84a36f10 ffff9e8e`84a36ef8 : acpis!sd_CommandRegister+0x11a8\nffff9e8e`84a36d10 fffff807`3113c71a     : 00000000`00000001 00000000`00000000 ffffa086`f61e24e8 ffffa086`f9d6ec68 : acpis!sd_CommandRegister+0x2255\nffff9e8e`84a36d50 fffff807`3113db0d     : 00000000`00000001 fffff807`3113693b ffff9e8e`84a37080 00000000`00020e7d : acpis!sd_CommandRegister+0xe62\nffff9e8e`84a36e70 fffff807`3113cb36     : 00000000`00000000 00000000`00000000 00000000`88963d99 ffffa086`f59ff288 : acpis!sd_CommandRegister+0x2255\nffff9e8e`84a36eb0 fffff807`3113db0d     : ffffa086`f72e2c50 ffffa087`2cc1b340 00000000`00000004 00000000`00000001 : acpis!sd_CommandRegister+0x127e\nffff9e8e`84a36fd0 fffff807`3113da79     : 00000000`00000000 ffffa086`f6153ca8 ffffa087`15025758 fffff807`311fdd16 : acpis!sd_CommandRegister+0x2255\nffff9e8e`84a37010 fffff807`3113bbc8     : 00000000`0000000a fffff807`311fe098 00000000`00020001 ffffa087`15025758 : acpis!sd_CommandRegister+0x21c1\nffff9e8e`84a37050 fffff807`3113bda9     : 00000000`00000000 ffffa086`f61c9208 ffffa086`f6153ca8 ffff9e8e`84a371e0 : acpis!sd_CommandRegister+0x310\nffff9e8e`84a370c0 fffff807`311481fd     : 00000000`00000000 ffffa087`038fc5e0 00000000`00000000 00000000`00000000 : acpis!sd_CommandRegister+0x4f1\nffff9e8e`84a37150 fffff807`311fdc31     : ffffa086`00000001 ffffa086`f3a56308 ffffa086`f3a56308 ffffa086`f3a56338 : acpis!sd_ShouldGenerateEvent+0x2131\nffff9e8e`84a372f0 fffff807`311fe3f5     : ffffa086`0002000f ffffa086`f5ffb030 ffff9e8e`84a373c0 00000000`00000000 : acpis!AgentSetState+0x6b61\nffff9e8e`84a37360 fffff807`31200dca     : ffffa086`f1e10780 fffff807`3114056d 00000000`00000000 00000000`ffffffff : acpis!AgentSetState+0x7325\nffff9e8e`84a373a0 fffff807`31147b92     : ffffa086`f7339b68 00000000`ffffffff 00000000`00000000 ffffa086`f6e0f190 : acpis!ag_CacheHandleIterateByKey+0x22\nffff9e8e`84a373e0 fffff807`31143b35     : ffffa086`f5ffb030 ffffa086`f6e0f190 ffffa087`097d1c30 ffffffff`00000001 : acpis!sd_ShouldGenerateEvent+0x1ac6\nffff9e8e`84a37450 fffff807`31143f8d     : ffffa086`f5ffb030 00000000`00000080 ffffa087`0a02bde8 00000000`000000fa : acpis!sd_PackageLookup+0x799\nffff9e8e`84a37480 fffff807`31143df2     : 00000000`000001f5 fffff807`3131fc78 00000000`00000080 fffff807`3131fc78 : acpis!sd_PackageLookup+0xbf1\nffff9e8e`84a374b0 fffff807`31201af7     : 00000000`00020008 ffffa086`f5fb8040 00000000`00000000 40200000`00020001 : acpis!sd_PackageLookup+0xa56\nffff9e8e`84a374e0 fffff806`66b58235     : ffffa086`00000001 ffffa086`f5fb8040 fffff807`31201a5c fffff807`3131fc78 : acpis!ag_CacheReleaseEx2+0xb1b\nffff9e8e`84a37510 fffff806`66bfff48     : ffffb681`de266180 ffffa086`f5fb8040 fffff806`66b581e0 40200000`00000000 : nt!PspSystemThreadStartup+0x55\nffff9e8e`84a37560 00000000`00000000     : ffff9e8e`84a38000 ffff9e8e`84a31000 00000000`00000000 00000000`00000000 : nt!KiStartSystemThread+0x28\n\n\nSYMBOL_NAME:  acpis!AgentSetState+76e7\n\nMODULE_NAME: acpis\n\nIMAGE_NAME:  acpis.sys\n\nSTACK_COMMAND:  .cxr 0xffff9e8e84a35f40 ; kb\n\nBUCKET_ID_FUNC_OFFSET:  76e7\n\nFAILURE_BUCKET_ID:  0x7E_C000001D_BAD_IP_acpis!AgentSetState\n\nOS_VERSION:  10.0.19041.1\n\nBUILDLAB_STR:  vb_release\n\nOSPLATFORM_TYPE:  x64\n\nOSNAME:  Windows 10\n\nFAILURE_ID_HASH:  {5e9d13b4-b1d6-a821-2e66-355ff6907131}\n\nFollowup:     MachineOwner\n---------\n\n7: kd> !blackboxpnp\n    PnpActivityId      : {00000000-0000-0000-0000-000000000000}\n    PnpActivityTime    : 133053779797965442\n    PnpEventInformation: 3\n    PnpEventInProgress : 0\n    PnpProblemCode     : 24\n    PnpVetoType        : 0\n    DeviceId           : HID\\{00001812-0000-1000-8000-00805f9b34fb}_Dev_VID&02046d_PID&b030_REV&0004_d34174814fef&Col02\\9&1a638cbc&0&0001\n    VetoString         : \n\n```\n",
  "votes": "1",
  "answers": 0,
  "views": "711",
  "tags": [
    "windows",
    "windbg"
  ],
  "user": "GreenTea",
  "time": "Aug 23, 2022 at 2:24",
  "comments": [
    {
      "user": "Robert",
      "text": "AFAIK acpis.sys is not a standard Windows 10 driver. Have you checked it's signature where it comes from. You also forgot to mention your Windows version and CPU. May be the driver is simply designed for a CPU that has more/other CPU instructions than yours?",
      "time": null
    },
    {
      "user": "GreenTea",
      "text": "I thought it is BIOS ACPI driver, but it was signed by GoSecure Inc. A network security software in our office.",
      "time": null
    },
    {
      "user": "Robert",
      "text": "I would upload the file to Virustotal just to see if it is known at all and even if the signer seems to indicate that it comes from a security company.",
      "time": null
    },
    {
      "user": "GreenTea",
      "text": "it is not malware, but I can't delete it, and I don't know how to unload it.",
      "time": null
    },
    {
      "user": "Robert",
      "text": "If it really belongs to a security software it will be hard to uninstall (because the software usually protects itself from being uninstalled). best way is to boot into a different OS like a WindowsPE/RE and rename the file and potentially load registry and rename the entries that load it. Make sure you don't delete anything in case your system refuses to boot after making the changes.",
      "time": null
    }
  ],
  "answers_data": []
}