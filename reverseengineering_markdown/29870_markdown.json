{
  "title": "How to load shellcode into Ghidra",
  "link": "https://reverseengineering.stackexchange.com/questions/29870/how-to-load-shellcode-into-ghidra",
  "content": "I'm trying to learn more about reverse engineering, and I've found some shellcode embedded in a C program:\n\n```\n   unsigned char shellcode[] =\n        \"\\x48\\x83\\xEC\\x28\\x48\\x83\\xE4\\xF0\\x48\\x8D\\x15\\x66\\x00\\x00\\x00\"\n        \"\\x48\\x8D\\x0D\\x52\\x00\\x00\\x00\\xE8\\x9E\\x00\\x00\\x00\\x4C\\x8B\\xF8\"\n        \"\\x48\\x8D\\x0D\\x5D\\x00\\x00\\x00\\xFF\\xD0\\x48\\x8D\\x15\\x5F\\x00\\x00\"\n        \"\\x00\\x48\\x8D\\x0D\\x4D\\x00\\x00\\x00\\xE8\\x7F\\x00\\x00\\x00\\x4D\\x33\"\n        \"\\xC9\\x4C\\x8D\\x05\\x61\\x00\\x00\\x00\\x48\\x8D\\x15\\x4E\\x00\\x00\\x00\"\n        \"\\x48\\x33\\xC9\\xFF\\xD0\\x48\\x8D\\x15\\x56\\x00\\x00\\x00\\x48\\x8D\\x0D\"\n        \"\\x0A\\x00\\x00\\x00\\xE8\\x56\\x00\\x00\\x00\\x48\\x33\\xC9\\xFF\\xD0\\x4B\"\n        \"\\x45\\x52\\x4E\\x45\\x4C\\x33\\x32\\x2E\\x44\\x4C\\x4C\\x00\\x4C\\x6F\\x61\"\n        \"\\x64\\x4C\\x69\\x62\\x72\\x61\\x72\\x79\\x41\\x00\\x55\\x53\\x45\\x52\\x33\"\n        \"\\x32\\x2E\\x44\\x4C\\x4C\\x00\\x4D\\x65\\x73\\x73\\x61\\x67\\x65\\x42\\x6F\"\n        \"\\x78\\x41\\x00\\x48\\x65\\x6C\\x6C\\x6F\\x20\\x77\\x6F\\x72\\x6C\\x64\\x00\"\n        \"\\x4D\\x65\\x73\\x73\\x61\\x67\\x65\\x00\\x45\\x78\\x69\\x74\\x50\\x72\\x6F\"\n        \"\\x63\\x65\\x73\\x73\\x00\\x48\\x83\\xEC\\x28\\x65\\x4C\\x8B\\x04\\x25\\x60\"\n        \"\\x00\\x00\\x00\\x4D\\x8B\\x40\\x18\\x4D\\x8D\\x60\\x10\\x4D\\x8B\\x04\\x24\"\n        \"\\xFC\\x49\\x8B\\x78\\x60\\x48\\x8B\\xF1\\xAC\\x84\\xC0\\x74\\x26\\x8A\\x27\"\n        \"\\x80\\xFC\\x61\\x7C\\x03\\x80\\xEC\\x20\\x3A\\xE0\\x75\\x08\\x48\\xFF\\xC7\"\n        \"\\x48\\xFF\\xC7\\xEB\\xE5\\x4D\\x8B\\x00\\x4D\\x3B\\xC4\\x75\\xD6\\x48\\x33\"\n        \"\\xC0\\xE9\\xA7\\x00\\x00\\x00\\x49\\x8B\\x58\\x30\\x44\\x8B\\x4B\\x3C\\x4C\"\n        \"\\x03\\xCB\\x49\\x81\\xC1\\x88\\x00\\x00\\x00\\x45\\x8B\\x29\\x4D\\x85\\xED\"\n        \"\\x75\\x08\\x48\\x33\\xC0\\xE9\\x85\\x00\\x00\\x00\\x4E\\x8D\\x04\\x2B\\x45\"\n        \"\\x8B\\x71\\x04\\x4D\\x03\\xF5\\x41\\x8B\\x48\\x18\\x45\\x8B\\x50\\x20\\x4C\"\n        \"\\x03\\xD3\\xFF\\xC9\\x4D\\x8D\\x0C\\x8A\\x41\\x8B\\x39\\x48\\x03\\xFB\\x48\"\n        \"\\x8B\\xF2\\xA6\\x75\\x08\\x8A\\x06\\x84\\xC0\\x74\\x09\\xEB\\xF5\\xE2\\xE6\"\n        \"\\x48\\x33\\xC0\\xEB\\x4E\\x45\\x8B\\x48\\x24\\x4C\\x03\\xCB\\x66\\x41\\x8B\"\n        \"\\x0C\\x49\\x45\\x8B\\x48\\x1C\\x4C\\x03\\xCB\\x41\\x8B\\x04\\x89\\x49\\x3B\"\n        \"\\xC5\\x7C\\x2F\\x49\\x3B\\xC6\\x73\\x2A\\x48\\x8D\\x34\\x18\\x48\\x8D\\x7C\"\n        \"\\x24\\x30\\x4C\\x8B\\xE7\\xA4\\x80\\x3E\\x2E\\x75\\xFA\\xA4\\xC7\\x07\\x44\"\n        \"\\x4C\\x4C\\x00\\x49\\x8B\\xCC\\x41\\xFF\\xD7\\x49\\x8B\\xCC\\x48\\x8B\\xD6\"\n        \"\\xE9\\x14\\xFF\\xFF\\xFF\\x48\\x03\\xC3\\x48\\x83\\xC4\\x28\\xC3\";\n\n```\nThis shellcode is then written into process memory and executed.\n\nHow do I convert the shellcode into something to where I can load it into Ghidra? Everything I read online says \"Open the shellcode in a disassembler\", but the disassembler doesn't recognize it as a valid program if I just save the data to a file. What do I need to do to see what this shellcode actually does?\n\n",
  "votes": "3",
  "answers": 2,
  "views": "1k",
  "tags": [
    "ghidra",
    "shellcode"
  ],
  "user": "dcom-launch",
  "time": "Jan 13, 2022 at 16:01",
  "comments": [],
  "answers_data": [
    {
      "content": "you have a string you cant load a string as is into a disassembler\nyou may need to un-escape them into binary\nfor example\n\"\\x48\" is \"H\"\n\nif you have a compiler compile and call it via a function pointer\nuse a scripting language like python make a binary blob and load it as raw into disassembler\n\nuse a disassembling framework like capstone combined with python to disassemble\n\n```\n>>> list(Cs(CS_ARCH_X86, CS_MODE_32).disasm(b\"\\x48\\x83\\xEC\\x28\\x48\\x83\\xE4\\xF0\\x48\\x8D\\x15\\x66\\x00\\x00\\x00\",0))\n    [\n<CsInsn 0x0 [48]:           dec eax>, \n<CsInsn 0x1 [83ec28]:       sub esp, 0x28>, \n<CsInsn 0x4 [48]:           dec eax>, \n<CsInsn 0x5 [83e4f0]:       and esp, 0xfffffff0>, \n<CsInsn 0x8 [48]:           dec eax>, \n<CsInsn 0x9 [8d1566000000]: lea edx, [0x66]>\n]\n\n```\nuse an online service like shell storm to simply paste and disassemble\n\n\n\n",
      "votes": "4",
      "user": "blabb",
      "time": "Jan 13, 2022 at 20:55",
      "is_accepted": true,
      "comments": []
    },
    {
      "content": "Compile and load:\n\n```\n#include <stdio.h>\n\nchar shellcode[] =\n        \"\\x48\\x83\\xEC\\x28\\x48\\x83\\xE4\\xF0\\x48\\x8D\\x15\\x66\\x00\\x00\\x00\"\n        \"\\x48\\x8D\\x0D\\x52\\x00\\x00\\x00\\xE8\\x9E\\x00\\x00\\x00\\x4C\\x8B\\xF8\"\n        \"\\x48\\x8D\\x0D\\x5D\\x00\\x00\\x00\\xFF\\xD0\\x48\\x8D\\x15\\x5F\\x00\\x00\"\n        \"\\x00\\x48\\x8D\\x0D\\x4D\\x00\\x00\\x00\\xE8\\x7F\\x00\\x00\\x00\\x4D\\x33\"\n        \"\\xC9\\x4C\\x8D\\x05\\x61\\x00\\x00\\x00\\x48\\x8D\\x15\\x4E\\x00\\x00\\x00\"\n        \"\\x48\\x33\\xC9\\xFF\\xD0\\x48\\x8D\\x15\\x56\\x00\\x00\\x00\\x48\\x8D\\x0D\"\n        \"\\x0A\\x00\\x00\\x00\\xE8\\x56\\x00\\x00\\x00\\x48\\x33\\xC9\\xFF\\xD0\\x4B\"\n        \"\\x45\\x52\\x4E\\x45\\x4C\\x33\\x32\\x2E\\x44\\x4C\\x4C\\x00\\x4C\\x6F\\x61\"\n        \"\\x64\\x4C\\x69\\x62\\x72\\x61\\x72\\x79\\x41\\x00\\x55\\x53\\x45\\x52\\x33\"\n        \"\\x32\\x2E\\x44\\x4C\\x4C\\x00\\x4D\\x65\\x73\\x73\\x61\\x67\\x65\\x42\\x6F\"\n        \"\\x78\\x41\\x00\\x48\\x65\\x6C\\x6C\\x6F\\x20\\x77\\x6F\\x72\\x6C\\x64\\x00\"\n        \"\\x4D\\x65\\x73\\x73\\x61\\x67\\x65\\x00\\x45\\x78\\x69\\x74\\x50\\x72\\x6F\"\n        \"\\x63\\x65\\x73\\x73\\x00\\x48\\x83\\xEC\\x28\\x65\\x4C\\x8B\\x04\\x25\\x60\"\n        \"\\x00\\x00\\x00\\x4D\\x8B\\x40\\x18\\x4D\\x8D\\x60\\x10\\x4D\\x8B\\x04\\x24\"\n        \"\\xFC\\x49\\x8B\\x78\\x60\\x48\\x8B\\xF1\\xAC\\x84\\xC0\\x74\\x26\\x8A\\x27\"\n        \"\\x80\\xFC\\x61\\x7C\\x03\\x80\\xEC\\x20\\x3A\\xE0\\x75\\x08\\x48\\xFF\\xC7\"\n        \"\\x48\\xFF\\xC7\\xEB\\xE5\\x4D\\x8B\\x00\\x4D\\x3B\\xC4\\x75\\xD6\\x48\\x33\"\n        \"\\xC0\\xE9\\xA7\\x00\\x00\\x00\\x49\\x8B\\x58\\x30\\x44\\x8B\\x4B\\x3C\\x4C\"\n        \"\\x03\\xCB\\x49\\x81\\xC1\\x88\\x00\\x00\\x00\\x45\\x8B\\x29\\x4D\\x85\\xED\"\n        \"\\x75\\x08\\x48\\x33\\xC0\\xE9\\x85\\x00\\x00\\x00\\x4E\\x8D\\x04\\x2B\\x45\"\n        \"\\x8B\\x71\\x04\\x4D\\x03\\xF5\\x41\\x8B\\x48\\x18\\x45\\x8B\\x50\\x20\\x4C\"\n        \"\\x03\\xD3\\xFF\\xC9\\x4D\\x8D\\x0C\\x8A\\x41\\x8B\\x39\\x48\\x03\\xFB\\x48\"\n        \"\\x8B\\xF2\\xA6\\x75\\x08\\x8A\\x06\\x84\\xC0\\x74\\x09\\xEB\\xF5\\xE2\\xE6\"\n        \"\\x48\\x33\\xC0\\xEB\\x4E\\x45\\x8B\\x48\\x24\\x4C\\x03\\xCB\\x66\\x41\\x8B\"\n        \"\\x0C\\x49\\x45\\x8B\\x48\\x1C\\x4C\\x03\\xCB\\x41\\x8B\\x04\\x89\\x49\\x3B\"\n        \"\\xC5\\x7C\\x2F\\x49\\x3B\\xC6\\x73\\x2A\\x48\\x8D\\x34\\x18\\x48\\x8D\\x7C\"\n        \"\\x24\\x30\\x4C\\x8B\\xE7\\xA4\\x80\\x3E\\x2E\\x75\\xFA\\xA4\\xC7\\x07\\x44\"\n        \"\\x4C\\x4C\\x00\\x49\\x8B\\xCC\\x41\\xFF\\xD7\\x49\\x8B\\xCC\\x48\\x8B\\xD6\"\n        \"\\xE9\\x14\\xFF\\xFF\\xFF\\x48\\x03\\xC3\\x48\\x83\\xC4\\x28\\xC3\";\n\n\nint main()\n{\n    int (*function)() = shellcode;\n    function();\n    return 1;\n}\n\n```\n",
      "votes": "4",
      "user": "dcom-launch",
      "time": "Jan 13, 2022 at 17:15",
      "is_accepted": false,
      "comments": []
    }
  ]
}