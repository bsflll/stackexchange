{
  "title": "Radare2 - \"/c pointer; offset\" command not giving expected response to search instances of the same pair of similar instructions",
  "link": "https://reverseengineering.stackexchange.com/questions/27316/radare2-c-pointer-offset-command-not-giving-expected-response-to-search-in",
  "content": "I am trying to find an offset IOSURFACEROOTUSERCLIENT_VTAB from an iOS kext(IOSurface) using radare2 and there is a need to use the command \"/c pointer; offset\" as per the instructions in this gist. On performing the command the expected out put is a list of locations where the specific instruction occurs.\n\nBut when i try to run, the previous commands do work as expected. Except for the above command which gives the following output:\n\n```\n[0xfffffff00688b0d4]> \"/c 0xfffffff007622000; 0x898\"\nUsage: /c   Search for crypto materials\n| /ca                 Search for AES keys expanded in memory\n| /cc[algo] [digest]  Find collisions (bruteforce block length values until given checksum is found)\n| /cd                 Search for ASN1/DER certificates\n| /cr                 Search for ASN1/DER private keys (RSA and ECC)\n\n```\nI'm getting the same response when the double quotes are dropped.\n\nPlease help me understand what is wrong here, or if the format for radare2 has changed over the course of time or if I missed something.\n\nI did read the radare2 docs and but could not find any format in this form: \"/c pointer; offset\"\n\nThanks!\n\n",
  "votes": "1",
  "answers": 1,
  "views": "136",
  "tags": [
    "radare2",
    "ios",
    "kernel",
    "offset"
  ],
  "user": "iSeeker",
  "time": "Mar 29, 2021 at 5:18",
  "comments": [
    {
      "user": "Paweł Łukasik",
      "text": "try dropping the \"\" ?",
      "time": null
    },
    {
      "user": "iSeeker",
      "text": "@PawełŁukasik Tried already, but didnt work. Getting the same response as above.",
      "time": null
    },
    {
      "user": "iSeeker",
      "text": "@PawełŁukasik Is there something else that i am missing here? I am a new to reversing. Please help me learn.",
      "time": null
    },
    {
      "user": "Paweł Łukasik",
      "text": "what version are you running?",
      "time": null
    },
    {
      "user": "iSeeker",
      "text": "@PawełŁukasik On running brew info radare2, it seems the version is radare2: stable 5.1.1 (bottled), HEAD",
      "time": null
    }
  ],
  "answers_data": [
    {
      "content": "The gist contains some old (create 3 yrs ago) r2 instructions and according to, also outdated, r2 book, it looks like /c command was responsible for \"search for asm code matching the given string\". Currently (radare2 5.2.0-git 26093 @ linux-x86-64 git.5.1.1) the similar instruction could be one from /a group\n\n```\nUsage: /a[?] [arg]  Search for assembly instructions matching given properties\n| /a push rbp           Assemble given instruction and search the bytes\n| /a1 [number]          Find valid assembly generated by changing only the nth byte\n| /aI                   Search for infinite loop instructions (jmp $$)\n| /aa mov eax           Linearly find aproximated assembly (case insensitive strstr)\n| /ac mov eax           Same as /aa, but case-sensitive\n| /ad[/*j] push;mov     Match ins1 followed by ins2 in linear disasm\n| /ad/ ins1;ins2        Search for regex instruction 'ins1' followed by regex 'ins2'\n| /ad/a instr           Search for every byte instruction that matches regexp 'instr'\n| /ae esil              Search for esil expressions matching substring\n| /af[l] family         Search for instruction of specific family (afl=list\n| /ai[j] 0x300 [0x500]  Find all the instructions using that immediate (in range)\n| /al                   Same as aoml, list all opcodes\n| /am opcode            Search for specific instructions of specific mnemonic\n| /ao instr             Search for instruction 'instr' (in all offsets)\n| /as[l] ([type])       Search for syscalls (See /at swi and /af priv)\n| /at[l] ([type])       Search for instructions of given type  \n\n```\nIt looks like especially /ad/ should work as it can find sections of code where two instructions are following each other matching some regexp.\n\nBased on this I think the following should work for you:\n\n```\n[0x00000000]>\"/ad/ 0xfffffff007622000;0x898\"\n\n```\n",
      "votes": "1",
      "user": "Paweł Łukasik",
      "time": "Apr 28, 2021 at 7:48",
      "is_accepted": true,
      "comments": [
        {
          "user": "iSeeker",
          "text": "I tried /ad/ with quotes, but resulted in error Error: /ci : Invalid range. So I dropped the quotes and it gave a bunch of locations. But not as expected in the gist, and is a longer list. I created a pastebin for it: pastebin.com/zwfJMSnM. I am not clear how to proceed with this.",
          "time": null
        },
        {
          "user": "Paweł Łukasik",
          "text": "without the quotes will find only the first bytes in the command. it should works with the quotes. Try w/o space between first and second value. I'm running this locally on some values that I know are consecutive and it works as expected ibb.co/KjzD9nY",
          "time": null
        },
        {
          "user": "iSeeker",
          "text": "Sorry for the delayed response, I was positive for the virus and was away. This worked as you said, with quotes but without the space. Thank you very much for your help! and I will accept this as the answer. I humbly suggest that you perform the edit on your answer so that it is clear to others who may look for this.",
          "time": null
        }
      ]
    }
  ]
}