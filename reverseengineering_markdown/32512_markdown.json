{
  "title": "Keycode from a serial PDA keyboard (iPAQ G750)",
  "link": "https://reverseengineering.stackexchange.com/questions/32512/keycode-from-a-serial-pda-keyboard-ipaq-g750",
  "content": "I have a folding PDA keyboard (model number iPAQ G750). It is using a proprietary serial protocol, I want to adapt it to Bluetooth using a micro controllers. The keyboard sends out a 2-byte keycode every time a key is pressed or released. Some effort of modding the keyboard is documented here: https://www.instructables.com/HP-Compaq-IPAQ-G750-Keyboard-to-USB/\n\nI can't figure out too much pattern from the keycodes, except the most significant bit encodes pressed/released. Can anybody look at the keycodes and find some patterns from it? Is it a keyscan code denoting the rows and columns? Usually keycodes are 1-byte to allow more efficient processing. I can use the 2-byte keycodes with a hashmap but that is inefficient for micro controllers.\n\nHere is the mapping from keycode to the actual keys.\n\n```\nvoid keySetup() {\n  keyMapDown[0x16e9] = '1';\n  keyMapUp[0x96e9] = '1';\n  \n  keyMapDown[0x1ee1] = '2';\n  keyMapUp[0x9ee1] = '2';\n  \n  keyMapDown[0x26d9] = '3';\n  keyMapUp[0xa6d9] = '3';\n  \n  keyMapDown[0x25da] = '4';\n  keyMapUp[0xa5da] = '4';\n  \n  keyMapDown[0x2ed1] = '5';\n  keyMapUp[0xaed1] = '5';\n  \n  keyMapDown[0x36c9] = '6';\n  keyMapUp[0xb6c9] = '6';\n  \n  keyMapDown[0x3dc2] = '7';\n  keyMapUp[0xbdc2] = '7';\n  \n  keyMapDown[0x3ec1] = '8';\n  keyMapUp[0xbec1] = '8';\n  \n  keyMapDown[0x46b9] = '9';\n  keyMapUp[0xc6b9] = '9';\n  \n  keyMapDown[0x45ba] = '0';\n  keyMapUp[0xc5ba] = '0';\n\n  \n  //Letter keys\n  keyMapDown[0x1ce3] = 'a';\n  keyMapUp[0x9ce3] = 'a';\n  \n  keyMapDown[0x32cd] = 'b';\n  keyMapUp[0xb2cd] = 'b';\n  \n  keyMapDown[0x21de] = 'c';\n  keyMapUp[0xa1de] = 'c';\n  \n  keyMapDown[0x23dc] = 'd';\n  keyMapUp[0xa3dc] = 'd';\n  \n  keyMapDown[0x24db] = 'e';\n  keyMapUp[0xa4db] = 'e';\n  \n  keyMapDown[0x2bd4] = 'f';\n  keyMapUp[0xabd4] = 'f';\n  \n  keyMapDown[0x34cb] = 'g';\n  keyMapUp[0xb4cb] = 'g';\n  \n  keyMapDown[0x33cc] = 'h';\n  keyMapUp[0xb3cc] = 'h';\n  \n  keyMapDown[0x43bc] = 'i';\n  keyMapUp[0xc3bc] = 'i';\n  \n  keyMapDown[0x3bc4] = 'j';\n  keyMapUp[0xbbc4] = 'j';\n  \n  keyMapDown[0x42bd] = 'k';\n  keyMapUp[0xc2bd] = 'k';\n  \n  keyMapDown[0x4bb4] = 'l';\n  keyMapUp[0xcbb4] = 'l';\n  \n  keyMapDown[0x3ac5] = 'm';\n  keyMapUp[0xbac5] = 'm';\n  \n  keyMapDown[0x31ce] = 'n';\n  keyMapUp[0xb1ce] = 'n';\n  \n  keyMapDown[0x44bb] = 'o';\n  keyMapUp[0xc4bb] = 'o';\n  \n  keyMapDown[0x4db2] = 'p';\n  keyMapUp[0xcdb2] = 'p';\n  \n  keyMapDown[0x15ea] = 'q';\n  keyMapUp[0x95ea] = 'q';\n  \n  keyMapDown[0x2dd2] = 'r';\n  keyMapUp[0xadd2] = 'r';\n  \n  keyMapDown[0x1be4] = 's';\n  keyMapUp[0x9be4] = 's';\n  \n  keyMapDown[0x2cd3] = 't';\n  keyMapUp[0xacd3] = 't';\n  \n  keyMapDown[0x3cc3] = 'u';\n  keyMapUp[0xbcc3] = 'u';\n  \n  keyMapDown[0x2ad5] = 'v';\n  keyMapUp[0xaad5] = 'v';\n  \n  keyMapDown[0x1de2] = 'w';\n  keyMapUp[0x9de2] = 'w';\n  \n  keyMapDown[0x22dd] = 'x';\n  keyMapUp[0xa2dd] = 'x';\n  \n  keyMapDown[0x35ca] = 'y';\n  keyMapUp[0xb5ca] = 'y';\n  \n  keyMapDown[0x1ae5] = 'z';\n  keyMapUp[0x9ae5] = 'z';\n\n\n  //Symbol keys  \n  keyMapDown[0xef1] = '`';\n  keyMapUp[0x8ef1] = '`';\n  \n  keyMapDown[0x4eb1] = '-';\n  keyMapUp[0xceb1] = '-';\n  \n  keyMapDown[0x55aa] = '=';\n  keyMapUp[0xd5aa] = '=';\n  \n  keyMapDown[0x4cb3] = ';';\n  keyMapUp[0xccb3] = ';';\n  \n  keyMapDown[0x5da2] = '\\'';\n  keyMapUp[0xdda2] = '\\'';\n\n  // # key but mapping is wrong so has to be changed\n  keyMapDown[0x52ad] = 92;\n  keyMapUp[0xd2ad] = 92;\n  \n  keyMapDown[0x41be] = ',';\n  keyMapUp[0xc1be] = ',';\n  \n  keyMapDown[0x49b6] = '.';\n  keyMapUp[0xc9b6] = '.';\n  \n  keyMapDown[0x4ab5] = '/';\n  keyMapUp[0xcab5] = '/';\n\n  // \\ key but mapping is wrong so has to be changed\n  keyMapDown[0x748b] = 49;\n  keyMapUp[0xf48b] = 49;\n\n  keyMapDown[0x54ab] = '[';\n  keyMapUp[0xd4ab] = '[';\n\n  keyMapDown[0x5ba4] = ']';\n  keyMapUp[0xdba4] = ']';\n\n\n  //Special keys\n  keyMapDown[0x718e] = KEY_BACKSPACE;\n  keyMapUp[0xf18e] = KEY_BACKSPACE;\n  \n  keyMapDown[0x5ca3] = ' ';\n  keyMapUp[0xdca3] = ' '; \n  \n  keyMapDown[0x58a7] = KEY_CAPS_LOCK;\n  keyMapUp[0xd8a7] = KEY_CAPS_LOCK;\n  \n  keyMapDown[0x14eb] = KEY_LEFT_CTRL;\n  keyMapUp[0x94eb] = KEY_LEFT_CTRL;\n  \n  keyMapDown[0x12ed] = KEY_LEFT_SHIFT;\n  keyMapUp[0x92ed] = KEY_LEFT_SHIFT;\n  \n  keyMapDown[0x708f] = KEY_LEFT_ALT;\n  keyMapUp[0xf08f] = KEY_LEFT_ALT;\n  \n  keyMapDown[0x7f8] = KEY_LEFT_GUI;\n  keyMapUp[0x87f8] = KEY_LEFT_GUI;\n  \n  keyMapDown[0x738c] = KEY_RIGHT_CTRL;\n  keyMapUp[0xf38c] = KEY_RIGHT_CTRL;\n  \n  keyMapDown[0x59a6] = KEY_RIGHT_SHIFT;\n  keyMapUp[0xd9a6] = KEY_RIGHT_SHIFT;\n  \n  keyMapDown[0x11ee] = KEY_RIGHT_ALT;\n  keyMapUp[0x91ee] = KEY_RIGHT_ALT;\n  \n  keyMapDown[0x6699] = KEY_DELETE;\n  keyMapUp[0xe699] = KEY_DELETE;\n  \n  keyMapDown[0x5aa5] = KEY_RETURN;\n  keyMapUp[0xdaa5] = KEY_RETURN;\n  \n  keyMapDown[0xdf2] = KEY_TAB;\n  keyMapUp[0x8df2] = KEY_TAB;\n  \n  keyMapDown[0x28d7] = KEY_UP_ARROW;\n  keyMapUp[0xa8d7] = KEY_UP_ARROW;\n  \n  keyMapDown[0x609f] = KEY_DOWN_ARROW;\n  keyMapUp[0xe09f] = KEY_DOWN_ARROW;\n  \n  keyMapDown[0x5ea1] = KEY_LEFT_ARROW;\n  keyMapUp[0xdea1] = KEY_LEFT_ARROW;\n  \n  keyMapDown[0x2fd0] = KEY_RIGHT_ARROW;\n  keyMapUp[0xafd0] = KEY_RIGHT_ARROW;\n};\n\n```\n",
  "votes": "2",
  "answers": 1,
  "views": "83",
  "tags": [
    "embedded",
    "hex",
    "encodings",
    "protocol",
    "byte-code"
  ],
  "user": "Xinming Chen",
  "time": "Nov 23, 2023 at 19:07",
  "comments": [],
  "answers_data": [
    {
      "content": "I've figured it out:\n\n",
      "votes": "1",
      "user": "Xinming Chen",
      "time": "Dec 7, 2023 at 21:12",
      "is_accepted": false,
      "comments": []
    }
  ]
}